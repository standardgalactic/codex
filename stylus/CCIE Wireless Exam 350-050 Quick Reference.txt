













CCIE Wireless Exam (350-050) Quick Reference
Roger NobelFabian RiesenFederico ZiliottoFederico LovisonErik Vangrunderbeek
ciscopress.com







CCIE Wireless Exam (350-050) Quick Reference
Roger NobelFabian RiesenFederico ZiliottoFederico LovisonErik Vangrunderbeek
Copyright © 2012 Cisco Systems, Inc.
Published by:
Cisco Press
800 East 96th Street
Indianapolis, IN 46240 USA
All rights reserved. No part of this ebook shall be reproduced, stored in a retrieval system, or transmitted by any means, electronic, mechanical, photocopying, recording, or otherwise, without written permission from the publisher. No patent liability is assumed with respect to the use of the information contained herein. Although every precaution has been taken in the preparation of this book, the publisher and author assume no responsibility for errors or omissions. Nor is any liability assumed for damages resulting from the use of the information contained herein.
First Release April 2012
ISBN-10: 0-13-216817-0ISBN-13: 978-0-13-216817-5
Warning and DisclaimerThis book is designed to provide information about CCIE Wireless. Every effort has been made to make this book as complete and as accurate as possible, but no warranty or fitness is implied.
The information is provided on an "as is" basis. The authors, Cisco Press, and Cisco Systems, Inc. shall have neither liability nor responsibility to any person or entity with respect to any loss or damages arising from the information contained in this book or from the use of the discs or programs that may accompany it.
The opinions expressed in this book belong to the authors and are not necessarily those of Cisco Systems, Inc.
Trademark AcknowledgmentsAll terms mentioned in this book that are known to be trademarks or service marks have been appropriately capitalized. Cisco Press or Cisco Systems, Inc. cannot attest to the accuracy of this information. Use of a term in this book should not be regarded as affecting the validity of any trademark or service mark.
Feedback InformationAt Cisco Press, our goal is to create in-depth technical books of the highest quality and value. Each book is crafted with care and precision, undergoing rigorous development that involves the unique expertise of members from the professional technical community.
Readers' feedback is a natural continuation of this process. If you have any comments regarding how we could improve the quality of this book, or otherwise alter it to better suit your needs, you can contact us through email at feedback@ciscopress.com. Please make sure to include the book title and ISBN in your message.
We greatly appreciate your assistance.
Corporate and Government SalesCisco Press offers excellent discounts on this book when ordered in quantity for bulk purchases or specialsales. For more information, please contact:
U.S. Corporate and Government Sales 1-800-382-3419 corpsales@pearsontechgroup.com
For sales outside the United States, please contact: International Salesinternational@pearsoned.com


Americas HeadquartersCisco Systems. Inc.San Jose, CA
Asia Pacific HeadquartersCisco Systems (USA) Pte. Ltd.Singapore
Europe HeadquartersCisco Systems International BVAmsterdam, The Netherlands
Cisco has more than 200 offices worldwide. Addresses, phone numbers, and fax numbers are listed on the Cisco Website at www.cisco.com/go/offices.
GCDE, CCENT, Cisco Eos, Cisco HealthPresence, the Cisco logo, Cisco Lumin, Cisco Nexus, Cisco Stadium Vision, Cisco TelePresence, Cisco WebEx, DCE, and Welcome to the Human Network are trademarks; Changing the Way We Work. Live. Play, and Learn and Cisco Store are service marks: and Access Registrar Aironet. AsyncOS. Bringing the Meeting To You. Catalyst. CCDA, CCDP, CCIE, CCIP, CCNA, CCNP, CCSP, CCVP Cisca the Cisco Certified Internetwork Expert logo, Cisco IOS, Cisco Press, Cisco Systems, Cisco Systems Capital, the Cisco Systems logo, Cisco Unity, Collaboration Without Limitation, EtherFast, EtherSwitch, Event Center, Fast Step, Follow Me Browsing, FormShare, GigaDrive, HomeLink, Internet Quotient, IOS, Phone, iQuick Study, IronPort, the IronPort logo, LightStream, Linksys, MediaTone, MeetingPlace, MeetingPlace Chime Sound, MGX, Networkers, Networking Academy. Network Registrar PCNow. PIX. PowerPanels, ProConnect. ScriptShare. SenderBase. SMARTnet. Spectrum Expert. StackWise, The Fastest Way to Increase Your Internet Quotient TransPath. WebEx. and the WebEx logo are registered trademarks of Cisco Systems, Inc. and/or its affiliates in the United States and certain other countries.
All other trademarks mentioned in this document or website are the property of their respective owners. The use of the word partner does net imply a partnership relationship between Cisco and any other company. (0812R)







Table of Contents
Chapter 1 Planning and Designing 802.11 Wireless Technologies
Chapter 2 Configure and Troubleshoot L2/L3 Network Infrastructure to Support WLANs
Chapter 3 Configure and Troubleshoot Infrastructure Application Services
Chapter 4 Configure and Troubleshoot Autonomous Deployment Mode
Chapter 5 Configure and Troubleshoot the Cisco Unified Wireless Deployment Model
Chapter 6 Configure and Troubleshoot WCS
Chapter 7 Configure and Troubleshoot WLAN Services
Appendix A RF Troubleshooting







About the Authors
Roger Nobel is a customer support engineer at the Cisco Systems Technical Assistance Center (TAC) in Switzerland. He joined Cisco in 2000 as a project engineer. He owns a Swiss-Engineer degree from the University of Applied Sciences Winterthur/Zurich with specialization in software engineering and transmission technologies. He holds CCIE Wireless (#23679), CWNA, and CWSP (#400138).
Fabian Riesen is technical leader at the Cisco Systems Technical Assistance Center (TAC) in Switzerland. He joined Cisco in 1999 as a project engineer. He owns a Swiss-Engineer degree from the University of Applied Sciences Winterthur/Zurich with specialization in software engineering and transmission technologies. He holds CCIE ISP-Dial and CCIE Wireless (#6268). Fabian was a reviewer for the Cisco Press book Deploying and Troubleshooting Cisco Wireless LAN Controllers and is the author of one of the CCIE Wireless Written and Lab examinations.
Federico Ziliotto joined Cisco in 2007 as a customer support engineer (CSE) at the Technical Assistance Center (TAC) in Belgium, where he specialized in solving high severity issues for worldwide customers with particular focus on wireless networks, network admission control (NAC) setups, identity-based networking (IBN), and 802.1X, AAA solutions, and Cisco TrustSec. Federico owns an engineering degree from the University of Padova, Italy, with specialization in telecommunications. He is double CCIE #23280 in Wireless since January 2009 and Routing & Switching since April 2011. In June 2011 he moved to a new position as systems engineer in Cisco France, in the Solution and Technology Practice (STEP) team, where he currently collaborates with the pre-sales teams in security- and mobility-related projects.
Federico Lovison is a customer support engineer at the Cisco Systems Technical Assistance Center (TAC) in Belgium. He joined Cisco in 2007 as a CSE. He owns an engineering degree from the University of Padova with specialization in telecommunications. He holds CCIE Wireless (#23307).
Erik Vangrunderbeek is CCIE wireless product manager within Learning@Cisco. Based out of Brussels, Belgium, he is responsible for the exam design and content development process for both the CCIE Wireless written and lab exams. Erik joined Cisco in 1999 and holds CCIE #9145.







Chapter 1. Planning and Designing 802.11 Wireless Technologies
Wireless Introduction
To Be Wireless
With the introduction of wireless LAN (WLAN), IP networks are now also available for those applications on which wired technologies are not suitable or no wired connectivity is available at all. The following are a few wireless use cases:
• Home ISP connectivity: Consumer products
• Building-to-building connectivity: Point-to-point and multipoint
• "Last mile" ISP connectivity: Rural Internet access
• Mobility applications: Car rental returns and parcel deliveries
• Enterprise network extension: Reduce, move, add, and change/mobile office environment
Although WLAN appears to be "just another LAN type/protocol," the nature of wireless is to be a shared medium, and shared not only between a certain workgroup but also shared across the walls, across the building, and with your neighbor. On top of normal networking issues, WLAN adds a couple of new challenges, such as Layer 1 (radio frequency [RF]) issues; a set of L2 protocols, such as IEEE 802.11; and the need for agencies to regulate the use of this shared medium.
Layer 1: Radio Frequencies
Radio frequencies are high-frequency, alternating current (AC) signals that are radiated into the air through an antenna, creating radio waves. Radio waves propagate away from the antenna in a straight line in all directions at once, just like light rays from a bulb. More light bulbs spread around the room will provide better overall lighting. This translates into a stronger average signal for mobile clients. When radio waves hit a wall, door, or any obstruction, there is attenuation of the signal, which weakens the signal and can reduce throughput. The signal can also be reflected or refracted.
Industrial, Scientific, and Medical (ISM) Radio Bands
WLAN devices work in a frequency range (wavebands) that belongs to the industrial, scientific, and medical (ISM) radio bands. The ISM band was originally reserved internationally for the use of RF electromagnetic fields for industrial, scientific, and medical purposes other than communications. In general, communications equipment must accept any interference generated by ISM equipment.
Within the ISM band, WLAN devices use wavebands as follows:
• Bluetooth 2450-MHz band
• HIPERLAN 5800-MHz band
• IEEE 802.11/WiFi 2450-MHz and 5800-MHz bands
Cisco WLAN technologies use the IEEE 802.11 range, which is what this book focuses on.
WLAN Organizations and Regulations
You should be familiar with the following WLAN organizations and regulations:
• FCC (Federal Communications Commission), www.fcc.gov: Regulates the use of wireless devices in the United States.
• ETSI (European Telecommunications Standards Institute), www.etsi.org: Chartered to produce common standards in Europe.
• IEEE (Institute of Electrical and Electronic Engineers), www.ieee.org: Creates and maintains operational standards.
• Wi-Fi Alliance, www.wi-fi.com: Promotes and tests for WLAN interoperability.
• WLANA (WLAN Association), www.wlana.org: Educates and raises consumer awareness regarding WLANs.
• CCX (Cisco Compatible Extensions): The CCX specification is for makers of 802.11 wireless LAN chips to ensure compliance with the Cisco proprietary WLAN protocols. For example, Cisco Lightweight Extensible Authentication Protocol (LEAP) and Extensible Authentication Protocol-Flexible Authentication via Secure Tunneling (EAP-FAST) are part of CCX.
IEEE 802.11 Standards and Protocols
802.11 Alphabet Soup
In June 1997, the IEEE finalized the initial standard for WLANs: IEEE 802.11. Each amendment has been published with a letter in addition to the 802.11. Those letters are often used to name features, data rates, and so on.
Here is a typical example: IEEE 802.11a defined operations in the 5-GHz band. The radio interface operating at 5 GHz is therefore called the "A radio."
In 2007, the IEEE consolidated all amendments into a new 802.11 standard. Table 1-1 gives a summary of the standards in place at the time of this writing.
Table 1-1. IEEE 802.11 Standard Overview


802.11 Channels and Channel Wide
Starting at the center frequency of 2.412 MHz, IEEE 802.11 gives every 5 MHz a new channel number. The channel wide is 20 MHz and 40 MHz for channel bounding (introduced in the 802.11n amendment). If there are different/parallel WLAN setups, it is crucial to not run them in the same frequency range. Furthermore, a separation of at least one channel is mandatory to avoid cochannel interference.
Figure 1-1 illustrates a good example of channel separation using channels 3 and 8 (separation of one channel). Figure 1-2 shows a bad example with overlapping channels. Figure 1-3 illustrates the situation of "side/adjacent" channels, which should also be avoided because of lack of separation.

Figure 1-1. 802.11 Channel Separation

Figure 1-2. 802.11 Overlapping Channels

Figure 1-3. 802.11 Side/Adjacent Channels
Understanding IEEE 802.11 Components and Frame Types
Terms for components used in the IEEE standard are not commonly used. Some of these terms are defined in the following list:
• The basic building block of an IEEE 802.11 LAN is called a basic service set (BSS).
• A "wireless client" is called a station (STA).
• Two or more STAs can communicate with each other within the same BSS—that is, if two or more wireless clients are communicating with each other on the same RF channel, in the same range.
• If two or more STAs are communicating directly with each other, it is called an independent BSS (IBSS), which is often referred to as an ad hoc network.
• After an AP is in place, wireless clients (STAs) are no longer communicating directly with each other. The AP takes the role of the leader STA in a BSS, and every frame is sent from or to an STA through the AP-STA. The identifier of the BSS (BSSID) is the AP's MAC address. It is seen in every frame exchanged in the BSS.
• Adding several access points (AP) to the scenario, we can build an extended service set (ESS). This means that every AP serves its own BSS, and traffic between different BSSs is exchanged between the APs, which enables us to build a wireless network of arbitrary size. The identifier for an ESS is called the service set identifier (SSID). This is the most common scenario you will see in wireless networks: A set of APs are serving a certain area/range on a certain RF channel (different BSS). The common network identity of those different areas is the SSID we are configuring on the APs as well as on the wireless clients (STA).

Note
Look up the figure called "Complete IEEE 802.11 architecture" in the IEEE 802.11 standard and make sure that you understand those terms. When you become familiar with those terms, reading the 802.11 IEEE standards is much simpler.

IEEE 802.11 WLAN Operations
In the following sections, you get an overview of how STAs associate to a wireless network, how the connection is maintained, and how an STA roams between APs and leaves a wireless network.
Understanding IEEE 802.11 WLAN operations is crucial for troubleshooting wireless connectivity. This section gives only a first introduction. It is important to deepen your knowledge on this topic by analyzing sniffer traces and device debugs and studying IEEE 802.11 standards. Many books and trainings are available on this topic. The following are useful:
• IEEE 802.11 Handbook - A Designer's Companion, by Bob O'Hara and Al Petrick
• 802.11 Wireless Networks - The Definitive Guide, by Matthew S. Gast
• Analysing WLAN Networks, by Leutert NetServices (info@wireshark.ch)
IEEE 802.11 Passive Scanning: Beacons
An access point periodically sends a beacon. This beacon is used to synchronize all the stations and also includes a timestamp that the station within the BSS will use to update its internal clock. A beacon contains a huge amount of information about the BSS. One data point could be the SSID of the wireless network.
An STA might scan for all available SSIDs advertised in beacons. This operation is also called passive scanning. Whether the AP advertises the SSID through the beacon or not can be configured on the devices. More details can be found in Chapter 3, "Configure and Troubleshoot Infrastructure Application Services," and Chapter 4, "Configure and Troubleshoot Autonomous Deployment Mode."
IEEE 802.11 Active Scanning: Probes
With active scanning, the station is sending a probe request frame containing the SSID it wants to join. All access points within that SSID will answer with a probe response containing their BSS information.
If the probe request sent by the station contains a null SSID, all APs are supposed to answer with a probe response. This allows an STA to learn SSIDs that are not advertised in a beacon.

Note
Not every wireless client supports "null SSID" in a probe. Those clients won't be able to access a wireless network that is not advertising the SSID within its beacon.

IEEE 802.11 Authentication
When an STA decides to join a certain BSS, it triggers an 802.11 authentication toward the AP.
IEEE 802.11 authentication offers three different types, and Cisco introduced a fourth proprietary type:
• Auth code = 0: Open authentication; this is a null authentication algorithm.
• Auth code = 1: Shared authentication; this is old style and an unsecured shared key hash.
• Auth code = 2: Fast BSS Transition. This was introduced in amendment 802.11r-2008. It is a mechanism that allows fast transition between two BSSs (roaming between two APs) without the need for full authentication (key reuse).
• Auth code = 128: Network EAP authentication (Cisco-proprietary): A null authentication algorithm that indicates that an 802.1x authentication must follow.

Note
Do not mix this operation with an 802.1x authentication! 802.1x authentication doesn't belong to the 802.11 layer and happens—if enabled—after the STA is associated to the AP.

By today's security standards, it is common to implement the first (null) algorithm with following 802.1x authentications and/or already leveraging fast BSS transition.
IEEE 802.11 Association and Reassociation
From an 802.11 point of view, association is the last operation before an STA can transmit data. The STA sends in the association request its capability, such as supported rates, QoS, security capability, and so on. The AP confirms association along with certain parameters in its request.
If an STA roams from one AP to another AP within the same ESS (WLAN with same SSID), or if an STA reverts to the same AP after losing the coverage, it uses the reassociation frames instead. The reassociation exchange is almost the same as the association with a few additional parameters containing information about previous connections and authentication to the ESS. Because the additional information sent in those parameters is a reassociation, a following 802.1x authentication processes can be shortened. More details can be found in the section "The WLAN Security Five-Piece Puzzle," later in this chapter.
IEEE 802.11 Data Transmission
The operation of data transmission is simple: The STA or the AP is sending a data frame, and the other side is acknowledging successful receptions by sending an ACK frame. The following list highlights some key points on data transmission for analyzing sniffer traces:
• Successful transmission of a data frame is followed by an ACK frame.
• With the introduction of high-speed data rates (for example, MIMO), it is possible to aggregate multiple acknowledges in a block ACK (BlockAck) frame.
• If an STA sends a frame to an STA in the same BSS (on the same AP and SSID), the data frame is seen twice in the sniffer trace, once sent from the sender STA to the AP and then from the AP to the receiving STA.
• If the communication is encrypted, the source MAC address and the destination MAC address are visible in a sniffer trace. This enables you to correlate traces simultaneously captured on the wireless side of the AP and on the wired side, a very powerful method for figuring out whether the root cause of "bad connectivity" is on the wired or wireless side of the AP.
• Every data frame also contains the BSSID (MAC address of the AP), which enables you to figure out through which AP a certain frame was supposed to send.
• If you see the same data frame several times in a row, take a closer look at the flags of the frame control: If the Retry flag is set to 1, it is a retransmission because of a missing ACK.
As mentioned at the beginning of this section, this is just an entry point into the world of IEEE 802.11 WLAN operations. Exercise it by reading sniffer traces and mapping those findings to the IEEE standard. Also, get familiar with fragmentations, aggregation, Request to Send/Clear to Send (RTS/CTS), and other details of the 802.11 Layer 2 communication.
802.11 Media Access
Wireless media access adds additional challenges we already know from wired medium access. Wireless media access introduces the additional problem that not every STA can "hear" other STAs in the same BSS. A typical scenario is shown in Figure 1-4: STA-A, -B, and -C are in the same BSS, whereas STA-A hears STA-B but not STA-C, and STA-C hears STA-B but not STA-A. In such a situation, for example, STA-A might assume that the medium is free although STA-C is transmitting data to STA-B. This is called the hidden node problem.

Figure 1-4. Hidden Node Problem
If you read the 802.11 IEEE standards, you will find several media access mechanisms described, but only a few of them are actually implemented in a wireless infrastructure; this could become challenging when reading the standards. In the following section, you learn which of those mechanisms are implemented and are introduced to how 802.11 manages media access to the shared medium "wireless." Although for a network engineer this sounds as if it's close to the physical layer, basic understanding is necessary to understand how quality of service can work in a shared medium.
Basic Media Mechanism
The 802.11 protocol belongs to the "CSMA/CA with binary exponential backoff" family. This magic description contains the following three elements:
• Carrier Sense Multiple Access (CSMA) - Listen Before Talk (LBT): Listen means using a carrier-sensing mechanism provided by the physical layer.
• Binary Exponential Backoff: This mechanism makes sure that not all STAs that are waiting for transmission in the same BSS are sending immediately when the medium becomes available. This backoff time is calculated with a specific slot time multiplied by a random number. You learn more about those timing intervals in the following sections.
• Collision Avoidance (CA): Because transmitting and sending simultaneously is unusual for wireless devices, 802.11 uses CA rather than collision detection like we are used to from wired networks (for example, 802.3). This is also the reason why you will never see the counter of collisions increasing when executing a show interface dot11Radio... command on an AP.
The Concept of Using a Random Number and Exponential Backoff
As you will see throughout the following sections, random numbers are used to calculate the time between when the medium becomes available and an STA starts transmitting its frame. To reduce the probability of two STAs starting to send at the same time, a random value is chosen from a certain range of numbers. This range of numbers is defined by the Contention Window minimum (CWmin) and maximum (CWmax).
Varying the values of CWmin and CWmax influences the probability of collisions as well as the probability for an STA to get access to the media:
• If the range between CWmin and CWmax is large, the probability of two STAs determining the same random value—and therefore a causing a frame collision—is low.
• If we define CWmin for a certain traffic category A that is smaller than CWmin for another traffic category B, the probability that category A gets first access to the medium is higher.
• Every time a frame needs to be retransmitted, the value of CWmin gets increased according to a predefined exponential table until CWmax has been reached. This causes the STA to be less "aggressive" in the case of a busy medium on which collisions are happening.
Network Allocation Vector (NAV)
802.11 defines the Network Allocation Vector (NAV) to implement CA. The NAV is an indicator, maintained by each STA, that knows the amount of time that remains before the medium will become available. Each STA updates its NAV based on the duration field seen in a transmitted 802.11 frame. Note: This is the powerful feature in a WLAN used to circumvent the hidden node problem shown previously in Figure 1-4. It also allows an STA to "reserve" the medium for a certain time by setting the duration field accordingly. You will find many descriptions about its use by searching for "RTS/CTS exchange" or "CTS to itself."
Timing Intervals
The physical layer (data rate and speed) defines two timing intervals: the slot time and the Short Interframe Space (SIFS). All other time intervals between frames are calculated based on those two values and a random number. The following list gives you an overview of the time intervals you will read about in the IEEE 802.11 standards, as well a short description of how they are used along with their values:
• Slot time: Used to calculate the Binary Exponential Backoff, as discussed in an earlier section.
• Short Interframe Space (SIFS): The minimum time between two different frames. Used for "atomic" sequences, such as Data/ACK frames and RTS/CTS/Data/ACK frames.
• PCF Interframe Space (PIFS): Not used.
• DCF Interframe Space (DIFS): Used between two independent frames if QoS is not enabled. Its value is calculated based on SIFS + 2 * Slot-time.
• Arbitration Interframe Space (AIFS): Used between two independent frames if QoS is enabled. Its value varies per access category. Its value is calculated based on SIFS + N * Slot-time, where N is defined for each access category.
• Extended Interframe Space (EIFS): Used if a previously received frame contained errors. Its value is calculated based on SIFS + DIFS + ACKTxTime.
Figure 1-5 summarizes those timer intervals.

Figure 1-5. 802.11 Interframe Spaces

Note
The combination of different interframe spaces and varying the values of CWmin and CWmax are the key concepts you need to understand about IEEE 802.11 coordination functions and collision avoidance, as well how QoS is implemented in a WLAN.

802.11 Coordination Functions
A coordination function describes the rules of media access in a BSS. Normally, the function is located on the AP. IEEE 802.11 defines three different coordination functions, although not all of them have been implemented. Here is a summary of 802.11 coordination functions:
• Distributed Coordination Function (DCF): The first implementation of WLAN networks without QoS.
• Point Coordination Function (PCF): A proposal of the IEEE 802.11 standard that hasn't been implemented in the industry.
• Hybrid Coordination Function (HCF): Has been introduced by the IEEE 802.11e amendment with the focus on implementing QoS. It defines two mechanisms that can coexist with each other: HCF contention-based channel access (EDCA) and HCF controlled channel access (HCCA). Note that the latter hasn't been implemented in current WLAN devices.
Distributed Coordination Function (DCF)
DCF defines that an STA has to wait for DIFS plus its calculated backoff time before sending the frame.
Figure 1-6 illustrates three STAs waiting for medium access and the timeline of how those STAs are transmitting their frames:
• STA-A backoff time is 4 slot times.
• STA-B backoff time is 2 slot times.
• STA-C backoff time is 5 slot times.

Figure 1-6. 802.11 DCF Medium Access with Three STAs
If two STAs calculate the same backoff time, a collision occurs. The STA will realize this because of the missing ACK frame. Before retransmitting the frame, each STA selects the next CWmin value from the exponential table illustrated in Figure 1-7 and calculates a new backoff time. Because of the CWmin increase, the probability of a collision is reduced every time.

Figure 1-7. Example of an Exponential Increase of CW
802.11 QoS
Before getting into 802.11 QoS details, the following list gives you the different histories of the standards:
• IEEE 802.11e was the amendment that introduced QoS in WLAN. This amendment has been integrated into the latest IEEE 802.11 standard and is therefore obsolete.
• Wireless Multimedia Extension (WME), also known as Wi-Fi Multimedia (WMM), is a Wi-Fi Alliance interoperability certification based on the IEEE 802.11e standard.
• Enhanced Distributed Channel Access (EDCA): The current IEEE 802.11 access mechanism implemented and used by QoS STAs and APs. EDCA is one of the two mechanisms introduced by HCF and is also known as HCF contention-based channel access.
To differentiate an STA that supports QoS from one that doesn't, the IEEE 802.11 standard talks about QoS STA (QSTA) and STA, as well as about QoS AP (QAP) and AP.
HCF Contention-Based Channel Access (EDCA)
EDCA contention-based access is an extension of the legacy DCF mechanism we've discussed previously and includes priorities.
User Priorities and Access Categories
A total of eight user priorities (UP) are available, and each priority is mapped to an access category (AC) that corresponds to one of four transmit queues.
The key concept of the corresponding medium access prioritization is based on different interframe spaces and a different CWmin and CWmax per access category. The four defined ACs are as follows:
• Access category for background traffic (AC-BK)
• Access category for best-effort traffic (AC-BE)
• Access category for video traffic (AC-VI)
• Access category for voice traffic (AC-VO)
Arbitration Interframe Space Number (AIFSN)
As discussed in the section "Timing Intervals," earlier in this chapter, the interframe space varies among the different access categories. This value is called the arbitration interframe space number (AIFSN). The AIFSN indicates the number of slots after a SIFS duration that a non-AP STA should defer before either invoking a backoff or starting a transmission.
The default EDCA interframe spaces (AIFSN) for each class are as follows:
• AIFSN for AC-BK: 7
• AIFSN for AC-BE: 3
• AIFSN for AC-VI: 2
• AIFSN for AC-VO: 2
Per-Access Category Backoff Values
In addition to the different interframe spaces, EDCA also defines different backoff values for each access category. Figure 1-8 illustrates the different CWmin and CWmax values along the exponential backoff table. As described in earlier sections, the probability of transmitting a frame, for example, in AC-VO is therefore higher than a frame in AC-BE.

Figure 1-8. Example of Per-Traffic Category Varying Backoff Values
EDCA Parameters and Information Elements
The only difference between a WMM implementation, which was a snapshot of the 802.11e amendment, and the latest 802.11 standard is the use of different information element identifiers (IE-Id) used to advertise and exchange QoS parameters in management packets:
• WMM uses IE-Id 221.
• The current IEEE 802.11 standard uses IE-Id 12.
• A QAP advertises its QoS capability by sending the EDCA-Information-Element or EDCA-Parameter-Element within its beacon frames as well within probe response frames.
• In addition, the QoS capability from an STA gets negotiated during the association frame exchange. Whether a QoS-enabled AP accepts a non-QoS STA is a configured option available on both Cisco wireless platforms. More details can be found in Chapters 4 and 5.
EDCA Parameter and Transmit Opportunities (TXOP)
How long a QSTA is allowed to transmit is defined in the EDCA parameters and called transmit opportunities (TXOP). The STA that wins the EDCA contention is allowed using the medium for the time defined in the TXOP.
EDCA Admission Control
With all the capabilities just discussed, we have a working QoS queuing in place. Nevertheless, the control about the amount of STA joining the BSS is missing. Therefore, EDCA defines admission control. Whether admission control is required to join a certain QAP is advertised by the QAP in the EDCA parameter field. If admission control is enabled, a QSTA reserves and releases the bandwidth by sending the needed traffic stream specifications (TSPEC) through action management frames.
Support of EDCA admission control is mandatory at the QAP and optional at the QSTA. If a QSTA does not support admission control but admission control is mandatory (ACM), packets might get remarked to "best effort."
QBSS-Load-Element
QBSS stands for quality of service basic service set and can be found in the 802.11 IEEE standard under BSS load element. A QAP advertises the load (STA count, available admission capability, and so on) through the QBSS-Load-Element. This element is also sent within beacons and therefore allows a QSTA to determine its usage during the scanning process. Based on the standards evolution, three different implementations are in use. Although they are not fully aligned with the naming in the different standards, we differentiate them in this book by naming them using different versions, as described in the following sections.
QBSS v1 (AKA Cisco QBSSv1)
The oldest QBSS element is Cisco proprietary and uses the IEEE reserved Information Element 11. Its length is 4 bytes and it advertises STA count on the specific AP but no information about the actual state of the wireless medium (Clear Channel Assessment [CCA]). Because its IE-Id overlaps with the one from QBSSv2, it cannot be enabled in parallel.
QBSS v2 (AKA 802.11e CCA Version)
The 802.11-compliant QBSS-Load-Element Id 11 has a length of 5 bytes and contains CCA information in addition to STA count. Because its IE-Id overlaps with the one from QBSSv1, it cannot be enabled in parallel.
QBSS v3 (AKA Cisco/Aironet QBSSv2+)
Cisco introduced its proprietary QBSS, let's call it QBSS v3. Its values are transmitted using the vendor-specific QBSS-Load-Element Id 221 from Cisco. It has a length of 9 bytes and advertises the same information QBSS v2 does and also the Call Admission threshold. This threshold allows you to deploy a kind of admission control without the need for an EDCA-enabled network.
Table 1-2 summarizes all the different QoS wireless terms and features we have covered.
Table 1-2. 802.11 QoS Cheat Sheet

WLAN QoS Tagging
The user priorities (UP) defined by IEEE do not match with the packet marking on the IP level, nor do they match UP 802.1p defined by Architecture for Voice, Video, and Integrated Data (AVVID). This causes the need for a remapping on every AP when traffic is sent from wireless to wired and vice versa. How this conversion is implemented and needs to be configured is platform dependent. Correct tagging/marking is crucial to implementing time-critical applications such as voice.
Table 1-3 summarizes the conversion.
Table 1-3. QoS Frame Tagging and Packet Marking

Wireless Security Concepts and Protocols
Compare to wired networks, WLAN is also accessible from outside the building due to RF signal not ending at the walls. This fact required data encryption already in the early days of networking. In addition to encryption, WLAN mobility adds the fact that wireless clients (STAs) are roaming from one AP to another. Combine those two requirements with time-critical applications such as voice, and you have the need for fast and secure roaming.
Because WLAN security features and protocols have grown over the years, the diversity of naming has also grown over time. To configure a network correctly, it is crucial to understand the different naming in detail, especially because the naming conventions across different wireless devices are not consistent.
Table 1-4 lists terms used in the WLAN security world. Make sure that you understand the differences clearly.
Table 1-4. WLAN Security and Terminology

The WLAN Security Five-Piece Puzzle
WLAN security can be grouped into five different concept containers. This simplifies the understanding of new features as well as understanding the configuration parameters of WLAN devices. Last but not least, a clear differentiation also allows you to analyze wireless sniffer traces:
• Authentication: An STA first gets authenticated before it can transmit data.
• Encryption: Traffic over the shared-medium wireless needs to be encrypted to prevent exposure into and out of the building.
• Key distribution: To encrypt traffic between an STA and an AP, both need to have a secret key. This key can be distributed manually (pre-shared) or dynamically (as part of a mutual authentication).
• Key management: Adds the distribution of a group key to every STA associated with the same AP. This allows every STA to have a different key but to still deliver broadcast/multicast traffic using the group key. In addition, key management adds additional security robustness by ensuring that the keys are fresh; it also confirms the selection of cipher suites.
• Reuse of keys: Because STAs are mobile, roaming from one AP to another AP within the same ESS is common. For time-critical applications and scalability reasons, the reuse of keys from a previous authentication is important.
Authentication
The section "IEEE 802.11 Authentication," earlier in this chapter, lists the options of the 802.11 protocol. In addition, several WLAN platforms and solutions are offering security on other layers of the OSI model. It is important to remember that an 802.1x/EAP authentication always follows an 802.11 association operation. That said, 802.1x/EAP frames are transported through normal 802.11 data frames.
In an 802.1x/EAP-enabled network, the client device is called the supplicant. The device that triggers the EAP authentication and also intercepts the traffic until authentication is successfully completed is called the authenticator. The server that is doing the authentication is called the backend authentication server. To configure and troubleshoot authentication problems in WLAN networks, you need to be clear about which device is doing which function.
Consider the following example: The authenticator is an AP in a standalone autonomous network but is a WDS in a WDS setup and the wireless LAN controller (WLC) when using a unified wireless solution.
The authentication flow is as follows:
1. 802.11 association.
2. Authenticator triggers the EAP authentication by sending an EAP-Identity-Request within an 802.1x frame that is transported by an 802.11 data frame.
3. The supplicant responds with an EAP-Identity-Response.
4. The authenticator forwards this EAP-Identity-Response through attribute 79 within a radius request to the backend authentication server.
5. The backend authentication server responds with an EAP-Request and proposes an EAP-Type. The backend authentication server sends EAP packets within radius challenges.
6. From now on, several EAP-Requests and responses are exchanged between the backend authentication server and the supplicant.
7. Upon successful authentication, the backend authentication server sends an EAP-Success within attribute 79 of a Radius-Accept packet. The EAP authentication is complete, and the supplicant is now authenticated.
Figure 1-9 illustrates the flow and setup of an 802.1x/EAP-enabled network.

Figure 1-9. EAP Authentication Flow in a Wireless Network
Encryption
Table 1-5 shows wireless encryptions defined in the IEEE 802.11 standard. Counter Mode with Cipher Block Chaining Message Authentication Code Protocol (CCMP) (AES based) is the strongest and should be used whenever possible.
Table 1-5. Cipher Suite Selectors

Key Distribution
There are two options of distributing keys:
• Manual (pre-shared key [PSK])
• Dynamic key
A PSK has the advantage that an authentication server is needed. The big disadvantage of PSK is that when the key has been compromised on a single device, it must be reconfigured on all devices in the entire network.
The common implementation in an enterprise network is using dynamic keys based on a dot1x/EAP authentication. EAP authentication with EAP types such as PEAP, EAP-TLS, and EAP-FAST is doing two things:
• Mutual authentication (between supplicant and backend authentication server)
• Negotiation of a shared secret (between supplicant and backend authentication server)
That said, after successful authentication, the backend authentication server and the supplicant own a shared secret key. This key gets delivered within an attribute of the Radius-Accept packet from the backend authentication server to the authenticator and is used for wireless encryption. Figure 1-10 illustrates this exchange.

Figure 1-10. Key Distribution in an EAP-enabled Wireless Network
Key Management
Key management adds additional security robustness, such as key refresh and Pairwise Master Key (PMK) existence confirmation at a peer. In addition, key management allows the distribution of a group key to all STAs associated with a certain AP, which enables encryption of broadcast and multicast traffic.
Three different key managements are in use:
• RSNA key management using a six-way key handshake as defined initially in the 802.11i draft 3.0 and certified by the first Wi-Fi WPA certification
• RSNA key management using a four-way key handshake as defined initially in the 802.11i standard and the current IEEE 802.11 and certified by the second Wi-Fi WPA certification
• The Cisco-proprietary key management, which is part of Cisco Centralized Key Management (CCKM)
When an STA and an AP obtain a shared secret key (either through configuring a PSK manually or dynamically using dot1x/EAP), key management derives during the handshake the following set of four keys using two key hierarchies:
• Key Confirmation Key (KCK): Used to integrity-check an EAPOL-Key frame
• Key Encryption Key (KEK): Used to encrypt the Key Data field in an EAPOL-Key frame
• Temporal Key (TK): Used to encrypt unicast traffic between an STA and an AP
• Group Temporal Key (GTK): Used to encrypt broadcast/multicast traffic between STAs and APs
The IEEE 802.11 standard combines the authentication type (pre-shared key or dynamic using dot1x/EAP) with the key management type into Authentication and Key Management (AKM) suites. The suite type is what you see in sniffer traces. Table 1-6 summarizes the AKM suite types.
Table 1-6. AKM Suite Selectors

With this information, almost all 802.11 security interoperability issues can be located. Your main challenge is to figure out how the developers named the configuration options in the various WLAN devices.
Reuse Key
The last piece of the 802.11 security puzzle is the possibility to reuse key material from a previous authentication if an STA roams from one AP to another or reassociates to an AP within the same BSS. As mentioned previously, a full new authentication requires several interactions with the backend authentication server, which would cause unacceptable traffic interruption in, for example, a voice deployment. The following solutions are available:
• 802.11 PMKSA Caching: The AP and STA are caching the PMK from a previous authentication. Upon reassociating to the AP, the STA provides the corresponding PMKID to the AP within the reassociation request. If a match is found, a key handshake starts without triggering a full authentication.
• Proactive Key Caching (PKC): This is also known as Opportunistic Key Caching (OKC) and uses the function of 802.11 PMKSA caching. The smart difference: Without a previous authentication, PKC assumes that the new AP is already aware of the PMK and sends the PMKID anyway within the reassociation request. Because central systems, such as WLC, have the capability to share the PMKs among different APs, the new AP will find a match for the PMKID and the key handshake starts without triggering a full authentication.
• Cisco Centralized Key Management: This is Cisco proprietary and also leverages the powerful possibility that different APs can "share" the keys through their central system, such as WLC or WDS. During the reassociation exchange, the STA delivers needed information in the CCKM reassociation request element. This allows you to bypass a full authentication and also allows you to bypass a key handshake.
• 802.11i Pre-Authentication: This is an old IEEE 802.11 concept of proactively authenticating with every AP in the STA range, which is not scalable as well not implemented.
• 802.11r Fast BSS Transition: This is now the official the IEEE standard on how to do fast and secure roaming. Fast BSS transition is similar to CCKM; the only difference is that the information elements are exchanged in the authentication frames, whereas CCKM exchanges the information elements in the reassociation frames.
802.11 Robust Security Network Information Element (RSN-IE)
The RSN-IE contains all information about the security setup in the WLAN network. This field is your friend while analyzing a sniffer trace to troubleshoot a WLAN security problem. This IE is sent within
• Beacon frames
• Probe response frames
• Association request frames
• Reassociation request frames
In a wireless frame, the RSN-IE has the element ID 48. In an implementation certified by WPA(v1), which is based on 802.11i draft 3.0, you will find the RSN-IE with the element ID 221.
Plan and Design Wireless Solution Requirements
Before jumping into a site survey, it is important that you understand what your customers want to achieve for their wireless network and to understand how to achieve it while still leaving the solution open for future add-ons. According to your customer needs, you might want to deploy specific features, such as AP groups or AAA override, L2 or L3 roaming, or eventually specific Voice over WLAN (VoWLAN) recommendations.
When assessing the requirements for your wireless networks, it is also important to identify the gaps and the interoperability challenges between the already existing deployment, if any, and the new features that you would like to deploy on top. For example, adding VoWLAN on top of the data network could require a different site survey, whereas improving the security measures from passphrase to 802.1x would eventually require modifications for what concerns your RADIUS server, not in the physical layer.
According to what you would like to achieve and how scalable you would like your wireless network to be, you can choose to deploy either the Cisco Unified Wireless Network (CUWN) or an autonomous IOS (aIOS)-based system. The top three key differences are as follows:
• Centralized access points management: In the CUWN, the configuration is done through the wireless LAN controller (WLC) and pushed to the APs. In the aIOS system, you must configure the APs one by one.
• Radio resource management: In CUWN systems, the wireless LAN controller (WLC) integrates radio resource management and automatically adjusts channels and power levels of the access points. In the aIOS system, radio resource management can be achieved only with the addition of a wireless LAN service engine (WLSE).
• Layer 2 versus Layer 3 roaming: The aIOS system supports only Layer 2 roaming, whereas the CUWN system also supports Layer 3 roaming.
RF Planning
Define the Tasks/Goals for a Preliminary Site Survey
Before going on-site and starting to measure the RF environment, you might need to ask yourself which services you need to guarantee. A good rule of thumb is to first isolate requirements, such as the expected amount of users and throughput, the security policies, the mobility services (for example, client location tracking, VoWLAN, and so on), and the applications.
After identifying your requirements, it might then be advantageous to use a predictive RF planning tool to get an idea of what coverage you might expect by deploying your APs in certain areas and with certain power levels. A predictive RF planning tool, along with a preliminary walk-through of the premises, could give you an estimate of the coverage areas and of their problematic spots. You will see more details on predictive RF tools in Chapter 5, "Configure and Troubleshoot the Cisco Unified Wireless Deployment Model."
Conduct the Site Survey
When conducting the site survey, you might want to arm yourself with tools such as the Cisco Spectrum Expert, which enables you to analyze the Layer 1 radiating environment.
In addition to following the vendor's RF requirements for specific wireless products (for example, phones, scanners, and so on), after you come up with a first proposal of the AP's placement, it is also a good practice to test your deployment model with those wireless devices to pinpoint initial basic issues.
Determine AP Quantity and Placement
If no major interference threats are discovered through the spectrum analyzer, you could then start deploying your APs according to the predictive model of the RF planning tool. When the access points are in place, you can conduct further analysis through the spectrum analyzer again and through other tools, such as Airmagnet, which is widely deployed to validate coverage areas. As your common sense might suggest, it is a good idea to not start screwing your APs to the ceiling at the beginning, but rather to use some other temporary methods to hold them in place while you are still validating the final placement.
Then, according to the type of deployment, consider these main points:
• If reflective and/or metal surfaces are present, you might want to verify that diversity is enabled on your access points and that both antennas are mounted, especially for the 2.4-GHz radio.
• In the case of point-to-point bridge links, be aware that the Earth's curvature starts to become an important factor at a distance of six miles or more. Also, parabolic dish antennas might be preferred if a narrower first Fresnel zone and horizontal beam are needed.
• When hidden node issues are a concern, you might need to increase the power on your client stations and eventually consider increasing the number of APs.
Draft an RF Operational Model
At the end of the site survey, you should be able to compile a draft proposal covering the following main topics:
• Radio resource management: The report should include details about the configuration settings of Auto-RF—for example, whether to set it automatically, manually, or as a hybrid—and eventually consider the transmit power control (TPC) and Dynamic Channel Assignment Algorithm (DCA) values for manual configuration.
• Channel use: The site survey draft should include maps showing the channels' coverage and use in terms of potential interferences, such as radar and cochannel (that is, on the same channel as the receiver).
• Power level: Recommended power levels should also be mentioned according to the channel usage from the previous point. As a general guideline, you should consider that power levels for the 5-GHz radios should usually be higher than power levels for the 2.4-GHz radios to guarantee a similar cell coverage size.







Chapter 2. Configure and Troubleshoot L2/L3 Network Infrastructure to Support WLANs
This chapter covers concepts on the network infrastructure side that are crucial for successfully implementing an end-to-end enterprise wireless LAN (WLAN) solution.
Configure and Troubleshoot Wired Infrastructure to Support WLANs
VLANs
A virtual LAN (VLAN) operates at Layer 2 and groups hosts with a common set of requirements that communicate as if they were attached to the same broadcast domain, regardless of their physical location. In large networks, VLANs are implemented with the goal of reducing the size of the collision domain and thus improving performance. VLANs are usually associated with an IP subnetwork.
More information about configuring VLANs can be found in the following URLs:
Catalyst 3560-E Switch Software Configuration Guide, 12.2(55)SE: www.cisco.com/en/US/docs/switches/lan/catalyst3750x_3560x/software/release/12.2_55_se/configuration/guide/swvlan.html
Catalyst 6500 Release 12.2SX Software Configuration Guide: www.cisco.com/en/US/partner/docs/switches/lan/catalyst6500/ios/12.2SX/configuration/guide/vlans.html
A voice VLAN feature enables access ports to carry IP voice traffic from an IP phone. When the switch is connected to a Cisco IP Phone, the IP Phone sends voice traffic with Layer 3 IP precedence and Layer 2 class of service (CoS) values. Default values used are CoS 5 and DSCP 46. The switch can be configured to trust or override the traffic priority assigned by a Cisco IP Phone based on IEEE 802.1p CoS.
Catalyst 3560-E Switch Software Configuration Guide, 12.2(55)SE: www.cisco.com/en/US/docs/switches/lan/catalyst3750x_3560x/software/release/12.2_55_se/configuration/guide/swvoip.html
Ethernet Trunking
Trunks enable us to distribute VLAN connectivity throughout the network by carrying multiple VLANs on a single physical link. By default, traffic from all VLANs (1 to 4094) is allowed on the trunk. For security and performance purposes, it is good practice to specify traffic from which VLANs is allowed on the trunk and which is not, by adding and removing VLANs from the allowed VLAN list. The following are some important command-line interface (CLI) commands:
Click here to view code image
Switch(config-if)# switchport trunk allowed vlan <vlan number>Switch(config-if)# switchport trunk allowed vlan (add|remove) <vlan number>
Because a trunk can carry traffic, or frames, from multiple VLANs, the switch must have a method of identifying which VLAN a frame belongs to. Cisco supports different methods of frame identification. The main ones are Inter-Switch Link (ISL) and IEEE 802.1Q (see Table 2-1).
Table 2-1. Trunking Protocols: ISL Versus 802.1Q

Catalyst 3560-E Switch Software Configuration Guide, 12.2(55)SE: www.cisco.com/en/US/docs/switches/lan/catalyst3750x_3560x/software/release/12.2_55_se/configuration/guide/swvlan.html#wpxref33099
VTP
The VLAN Trunking Protocol (VTP) is a Layer 2 messaging protocol that maintains VLAN configuration consistency by managing the addition, deletion, and renaming of VLANs between switches in the same VTP domain.
• For VTP to work, the VTP domain, version, and password need to match on the participating switches. Also, the trunk(s) between these switches need to be up!
• When a switch receives a VTP update, it verifies whether it is from the same VTP domain and whether it has a higher configuration revision. If so, it will update the VLAN information in its VLAN database. If not, it will ignore the update.
• Different VTP modes exist: server/client and transparent mode:
• A switch in VTP server mode allows VLANs to be managed locally and saves VLAN information across reloads.
• A switch in VTP client mode does not allow VLANs to be managed locally and does not save VLAN information across reloads.
• A switch in VTP transparent mode passes VTP updates transparently if the domain name matches, allows VLANs to be managed locally, and saves VLAN information across reloads.
Catalyst 3560-E Switch Software Configuration Guide, 12.2(55)SE: www.cisco.com/en/US/docs/switches/lan/catalyst3750x_3560x/software/release/12.2_55_se/configuration/guide/swvtp.html
STP
The Spanning Tree Protocol (STP) is a Layer 2 link-management protocol that provides path redundancy while preventing undesirable loops in the network. For a Layer 2 Ethernet network to function properly, only one active path can exist between any two stations. STP operation is transparent to end stations, which cannot detect whether they are connected to a single LAN segment or a switched LAN of multiple segments.
• Bridges exchange STP information by means of bridge protocol data units (BPDU) every 2 seconds by default.
• BPDUs can be compared; we can say that a BPDU is better than another (a superior BPDU) or worse than (an inferior BPDU). A BPDU is superior than another if it has
• A lower root bridge ID
• A lower sending bridge ID
• A lower sending port ID (port number)
• Bridges keep a record of the best BPDU they receive on every port.
• Bridges age out received information.
• In a stable topology, each port, depending on its role, can either transmit or receive BPDUs, but not both.
Catalyst 3560-E Switch Software Configuration Guide, 12.2(55)SE: www.cisco.com/en/US/docs/switches/lan/catalyst3750x_3560x/software/release/12.2_55_se/configuration/guide/swstp.html
EtherChannel
An EtherChannel provides a fault-tolerant, high-speed link between switches, routers, and servers. You can use an EtherChannel to increase the bandwidth and provide fault tolerance anywhere in the network where bottlenecks are likely to occur. EtherChannels provide automatic recovery for the loss of a link by redistributing the load across the remaining links. All links that are part of the channel share the same Layer 2 (MAC) address and Layer 3 (IP) address, and as such, individual link status changes are transparent to the network applications and its users.
For Layer 2 EtherChannels:
• Assign all ports in the EtherChannel to the same VLAN, or configure them as trunks. Ports with different native VLANs cannot form an EtherChannel.
• If you configure an EtherChannel from trunk ports, verify that the trunking mode (ISL or 802.1Q) is the same on all the trunks. Inconsistent trunk modes on EtherChannel ports can have unexpected results.
• An EtherChannel supports the same allowed range of VLANs on all the ports in a trunking Layer 2 EtherChannel. If the allowed range of VLANs is not the same, the ports do not form an EtherChannel even when Port Aggregation Protocol (PAgP) is set to the auto or desirable mode.
• Ports with different spanning-tree path costs can form an EtherChannel if they are otherwise compatibly configured. Setting different spanning-tree path costs does not, by itself, make ports incompatible for the formation of an EtherChannel.
For Layer 3 EtherChannels, assign the Layer 3 address to the port-channel logical interface, not to the physical ports in the channel.
On the EtherChannel, you can configure load balancing using MAC addresses or IP addresses, source or destination addresses, or both source and destination addresses. The selected mode applies to all EtherChannels configured on the switch. The choice of a particular load-balancing method should be based on the position of the switch in the network and the traffic flow. The following are some important show commands from the CLI:
Switch# show etherchannel summarySwitch# show etherchannel load-balance
Catalyst 3560-E Switch Software Configuration Guide, 12.2(55)SE: www.cisco.com/en/US/docs/switches/lan/catalyst3750x_3560x/software/release/12.2_55_se/configuration/guide/swethchl.html
HSRP
Hot Standby Router Protocol (HSRP) is a Cisco-proprietary protocol used to provide redundancy by making two or more routers/switches share a single MAC/IP address that is used as a default gateway for end stations connected on the same segment. A group of routers/switches is configured as an HSRP group. Each router/switch in the group is configured with the group IP address and a priority. The router/switch with the highest priority is active and accepts all packets being forwarded to the group IP/MAC address. If the active router/switch fails, another router/switch in the same group becomes active and begins accepting the packets.
• HSRP can be configured on a maximum of 32 VLANs or routing interfaces.
• The interface on which you configure HSRP must be a Layer 3 interface, with an IP address assigned. This can be a routed port, a switch virtual interface (SVI), or an EtherChannel port (in Layer 3 mode).
Issue the following command from the CLI to check HSRP status:
Switch# show standby brief
Catalyst 3560-E Switch Software Configuration Guide, 12.2(55)SE: www.cisco.com/en/US/docs/switches/lan/catalyst3750x_3560x/software/release/12.2_55_se/configuration/guide/swhsrp.html
VSS
Virtual Switching Systems (VSS) combine a pair of switches into a single network element. An access switch connects to both chassis of the VSS using one logical port channel. The VSS manages redundancy and load balancing on the port channel. This capability enables a loop-free Layer 2 network topology. VSS also simplifies the Layer 3 network topology because the VSS reduces the number of routing peers in the network.
Release 12.2SX Software Configuration Guide: www.cisco.com/en/US/partner/docs/switches/lan/catalyst6500/ios/12.2SX/configuration/guide/vss.html
Configure and Troubleshoot Network Connectivity
WLAN Clients
The Cisco AnyConnect Secure Mobility client, with integrated Network Access Manager, provides Layer 2 device management and authentication for access to both wired and wireless networks.
Cisco AnyConnect Secure Mobility Client Administrator Guide, Release 3.0: www.cisco.com/en/US/partner/docs/security/vpn_client/anyconnect/anyconnect30/administration/guide/anyconnectadmin30.html
Standalone WLC
When the controller boots at factory defaults, the bootup script runs the configuration wizard, which prompts you for initial configuration settings. Settings directly related to providing connectivity from the WLC to the network infrastructure are as follows:
• The management interface, which is used for in-band management of the controller and connectivity to enterprise services.
• The service port (10/100-Mbps Ethernet interface), which is used for out-of-band management (not available on the 2106).
• Link aggregation (LAG), which is optional on the 4400 and the 5508, but not available on the 2106 to provide fault tolerance.
• The switchport that connects to the WLC is generally configured as an IEEE 802.1Q trunk port. Good practice is to allow only necessary VLANs on the trunk.
• If LAG is enabled on the WLC, you must create an EtherChannel on the switch.
Wireless LAN Controller (WLC) Configuration Best Practices: www.cisco.com/en/US/tech/tk722/tk809/technologies_tech_note09186a0080810880.shtml#
Cisco Wireless LAN Controller Configuration Guide, Release 7.0.116.0: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/wlc_cg70MR1.html
Integrated WLC (WiSM)
The Cisco Wireless Services Module (WiSM) is a WLAN controller services module for the Cisco Catalyst 6500 Series and the Cisco 7600 Series. It supports the same features as the Cisco 4400 Series Wireless LAN Controller. After the Cisco WiSM controller is installed in a slot and detected by the Supervisor, these configurations are made on the Supervisor engine to communicate with WiSM:
Troubleshoot and Configure Initial Wireless Services Module (WiSM) Setup: www.cisco.com/en/US/products/hw/modules/ps2706/products_tech_note09186a00808330a9.shtml#config
Access Points (AP)
The key to configuring an access point/bridge to connect to a specific VLAN is to configure its service set identifier (SSID) to recognize that VLAN. Because VLANs are identified by a VLAN ID or name, it follows that if the SSID on an access point/bridge is configured to recognize a specific VLAN ID or name, a connection to the VLAN is established. When this connection is made, associated wireless client devices having the same SSID can access the VLAN through the access point/bridge. The VLAN processes data to and from the clients the same way that it processes data to and from wired connections. You can configure up to 16 SSIDs on your access point/bridge, so you can support up to 16 VLANs. You can assign only one SSID to a VLAN.
Unified APs
In unified deployment models, both data and control traffic is tunneled between the AP and the WLC (except in HREAP mode), without tagging traffic being sent. As such, the port on the switch connecting to the AP is in most cases configured in access mode. See Example 2-1.
Example 2-1. Switchport Configuration for Unified AP
Click here to view code image

interface GigabitEthernet0/1description Access Port Connection to LWAPP/CAPWAP APswitchport access vlan 5switchport mode accessno shutdown

Autonomous APs
In autonomous deployment models, you can configure the switchport in access or trunk mode, depending on your needs:
• When using a single SSID/VLAN, configure the switchport connecting to the AP in access mode.
• When using multiple SSIDs/VLANs, configure the switchport connecting to the AP in trunk mode. (See Example 2-2.)
Example 2-2. Switchport Configuration When Using Multiple SSIDs/VLANs

interface GigabitEthernet0/1switchport mode trunkswitchport trunk encapsulation dot1qswitchport trunk native vlan 1switchport trunk allowed vlan 1,5,10no shut

Configure and Troubleshoot PoE
Based on the specific hardware specifications of Cisco switches, WLCs, and APs, various Power over Ethernet (PoE) solutions are available to provide power to access points. Standards include Cisco prestandard power, IEEE 802.3af power, and IEEE 802.3at. Cisco has extended power management to all these standards to further optimize Power Source Equipment (PSE) power management using Cisco Discovery Protocol (CDP). Both the IEEE 802.3af and 802.3at define two methods of delivering PoE to the discovered device requiring power:
• Endpoint PSE, when the AP is connected to a PoE-capable Ethernet switch.
• Midspan PSE. When the AP is connected to a non-PoE-capable Ethernet switch, we need to introduce PoE through a powered Ethernet source, a power injector, or any other PoE mechanism.

Note
The AP tries to negotiate power requirements using CDP. If CDP is disabled on either the switch providing PoE or the AP itself, or if CDP tells the AP that it cannot supply the needed power, the AP shuts down its radio interfaces. CDP is enabled by default on the Ethernet port of the APs.

Configuring PoE
If you use an endpoint PSE and the power specifications of the switch match the requirements of the AP, enable CDP on both the switch and the AP. If you use a midspan PSE, like a power injector, this needs to be configured explicitly.
Cisco Aironet and WLAN Controller Product Power Options: www.cisco.com/en/US/partner/products/hw/wireless/ps430/products_tech_note09186a00800946e7.shtml#
Cisco Aironet Power Over Ethernet Application Note: www.cisco.com/en/US/partner/docs/wireless/technology/poe/technical/reference/Power.html#
Configure and Troubleshoot QoS on the Switching Infrastructure
Typically, networks operate on a best-effort delivery basis, which means that all traffic has equal priority and an equal chance of being delivered in a timely manner. When congestion occurs, all traffic has an equal chance of being dropped. Implementing quality of service (QoS) enables you to control bandwidth allocation to different services available in your network by classifying, policing, marking, and queuing packets. Before implementing QoS, it is crucial that you understand what traffic you are looking at and see how it flows through the network, end to end. Important on the wired side (switch):
• Do not forget to enable QoS globally: mls qos
• On trunks, trust Layer 2 QoS: mls qos trust cos
• On nontrunks, trust Layer 3 QoS: mls qos trust dscp
• Tune default CoS-to-DSCP or DSCP-to-CoS mappings where necessary: mls qos map cos-dscp or mls qos map dscp-cos

Note
The following is the default CoS-to-DSCP map:


• Configure a QoS policy (optional).
• Classify traffic into classes (class-map).
• Configure the policy for each class (policy-map).
• Attach the policy to the interface(s).
Catalyst 3560-E Switch Software Configuration Guide, 12.2(55)SE: www.cisco.com/en/US/docs/switches/lan/catalyst3750x_3560x/software/release/12.2_55_se/configuration/guide/swqos.html
Cisco Unified Wireless IP Phone 7925G Series Deployment Guide: www.cisco.com/en/US/docs/voice_ip_comm/cuipph/7925g/7_0/english/deployment/guide/7925dply.pdf

Note
Important for voice implementations:
Create a QoS policy giving priority to voice (RTP) and call control (SCCP) traffic, and apply that profile to the desired interfaces. Refer to Chapter 1, Table 1-3, "QoS Frame Tagging and Packet Marking."
Be sure that RTP packets have the proper QoS markings and that other protocols are not using the same QoS markings.
Enable Differentiated Services Code Point (DSCP) preservation on the Cisco IOS switch and/or use a QoS policy to set DSCP to EF for RTP traffic (UDP port range 16384-32767) on the Cisco IOS router.

Configure and Troubleshoot Multicast on the Switched Infrastructure
IP multicast allows a host to send packets to a subset of all hosts (group transmission). These hosts are known as group members.
Routers executing a multicast routing protocol, such as Protocol Independent Multicast (PIM), maintain forwarding tables to forward multicast datagrams. Routers use the Internet Group Management Protocol (IGMP) to learn whether members of a group are present on their directly attached subnets. Hosts join multicast groups by sending IGMP report messages.
IP is particularly suited for multimedia applications that involve multiple participants. Issue the following show commands from the CLI to verify multicast configurations on your devices:
Switch# show ip pim rpSwitch# show ip mroute
Configuring IP Multicast Routing: www.cisco.com/en/US/docs/ios/12_2/ip/configuration/guide/1cfmulti.html#wp1000948
Configure and Troubleshoot Basic IPv4 Connectivity
Because wireless networks are built upon existing network infrastructures, it is critical to have a solid understanding of the following topics:
IP Addressing and Subnetting: www.cisco.com/en/US/tech/tk365/technologies_tech_note09186a00800a67f5.shtml#
Configuring Basic OSPF: www.cisco.com/en/US/docs/switches/lan/catalyst3750e_3560e/software/release/12.2_44_se/configuration/guide/swiprout.html#wp1068572
Configuring Basic EIGRP: www.cisco.com/en/US/docs/switches/lan/catalyst3750e_3560e/software/release/12.2_44_se/configuration/guide/swiprout.html#wp1039833

Note
Make sure you understand the OSPF/EIGRP network and passive-interface commands!

Troubleshooting General IP Connectivity
Using ping and traceroute
Both the ping and traceroute commands are irreplaceable when it comes to troubleshooting connectivity issues within your network.
Understanding the Ping and Traceroute Commands: www.cisco.com/en/US/products/sw/iosswrel/ps1831/products_tech_note09186a00800a6057.shtml#
Troubleshooting EIGRP
The most straightforward way to verify and troubleshoot Enhanced IGRP (EIGRP) is to inspect the routing table. Issue the following command:
show ip route eigrp
The following command verifies autonomous systems, timer values, identified networks, and EIGRP neighbors (routing information sources):
show ip protocols eigrp
Use this command to verify that the correct routers are neighbors:
show ip eigrp neighbors
Use this command to show the amount and types of EIGRP messages:
show ip eigrp traffic
The following command lists the interfaces participating in EIGRP and any neighbors found on those interfaces, along with some other statistics:
show ip eigrp interfaces
The following is a useful debug command that shows EIGRP packets, including authentication information that is being sent and received:
debug eigrp packets
Troubleshooting EIGRP: www.cisco.com/en/US/tech/tk365/technologies_tech_note09186a0080094613.shtml
Troubleshooting OSPF
The neighbor initialization process can be viewed using this command:
debug ip ospf adjacencies
The neighbor table can be seen with the following, which also identifies adjacency status and reveals the designated router and backup designated router:
show ip ospf neighbors
Use this command to view all Open Shortest Path First (OSPF) packets in real time:
debug ip ospf packet
Often, the first place that OSPF issues are noticed is when inspecting the routing table:
show ip route
To filter the routing table and show only the routes learned from OSPF, use this command:
show ip route ospf
The following command offers a wealth of information for any routing protocol issue. Use it to verify parameters, timer values, identified networks, and OSPF neighbors (routing information sources):
show ip protocols
Because wildcard masks sometimes incorrectly group interfaces to areas, another good place to check is
show ip ospf interface
This shows the interfaces on which OSPF runs and their current correct assigned area.
Troubleshooting OSPF: www.cisco.com/en/US/tech/tk365/technologies_tech_note09186a00800949f7.shtml
Configure and Troubleshoot Basic IPv6 Connectivity
Because wireless networks are built upon existing network infrastructures, it is necessary to have a basic understanding of the following topics:
• Implementing IPv6 Addressing and Basic Connectivity: www.cisco.com/en/US/docs/ios/ipv6/configuration/guide/ip6-addrg_bsc_con.html
• Implementing Static Routes for IPv6: www.cisco.com/en/US/docs/ios/ipv6/configuration/guide/ip6-stat_routes.html
Configure and Troubleshoot Wired Security
Different solutions are available to protect and manage access to your wired network infrastructure. You must be familiar with L2 and L3 ACLs, port security, and 802.1X port-based authentication.
Access control lists (ACL) provide the ability to filter ingress and egress traffic based on conditions specified in the ACL:
Port ACLs and VLAN ACLs: www.cisco.com/en/US/docs/switches/lan/catalyst3750e_3560e/software/release/12.2_44_se/configuration/guide/swacl.html
Port security can be used with dynamically learned and static MAC addresses to restrict a port's ingress traffic by limiting the MAC addresses that are allowed to send traffic into the port. When you assign secure MAC addresses to a secure port, the port does not forward ingress traffic that has source addresses outside the group of defined addresses. If you limit the number of secure MAC addresses to one and assign a single secure MAC address, the device attached to that port has the full bandwidth of the port. Issue the following commands from the CLI to enable port security:
Click here to view code image
Switch# switchport port-securitySwitch# switchport port-security violation {protect | restrict | shutdown}
Port ACLs and VLAN ACLs: www.cisco.com/en/US/partner/docs/switches/lan/catalyst6500/ios/12.2SX/configuration/guide/vacl.html
Configuring Port Security: www.cisco.com/en/US/partner/docs/switches/lan/catalyst6500/ios/12.2SX/configuration/guide/port_sec.html
IEEE 802.1X Port-Based Authentication: www.cisco.com/en/US/partner/docs/switches/lan/catalyst6500/ios/12.2SX/configuration/guide/dot1x.html







Chapter 3. Configure and Troubleshoot Infrastructure Application Services
This chapter covers concepts on the infrastructure application side that are crucial for successfully implementing an end-to-end enterprise wireless LAN (WLAN) solution. More detailed information about the topics covered in this chapter can be found in the URLs that are provided at the end of each topic.
Configure and Troubleshoot DNS, DHCP, NTP, Syslog, and SNMP
DNS
The Domain Name System (DNS) is a distributed database in which you can map host names to IP addresses through the DNS protocol from a DNS server. Each unique IP address can have an associated host name. The most relevant DNS-related IOS commands can be found in Example 3-1.
Example 3-1. IOS DNS
Click here to view code image

! Enable IP DNS-based hostname-to-address translationip domain lookup! Specifies the address of one or more name servers.ip name-server 192.168.1.111! Define cisco.com as the default domain nameip domain name cisco.com! Define a static hostname-to-address mapping in the hostname cache.ip host cisco-rtp 192.168.0.148

Configuring DNS on Cisco Routers: www.cisco.com/en/US/tech/tk648/tk362/technologies_tech_note09186a00800c525f.shtml#
IOS DHCP Server
The Cisco IOS DHCP Server feature is a full DHCP server implementation that assigns and manages IP addresses from specified address pools within the router to DHCP clients. Figure 3-1 shows the basic steps that occur when a DHCP client requests an IP address from a DHCP server.

Figure 3-1. DHCP Request Process
IOS DHCP Server
Important and frequently used IOS DHCP configuration commands and configurable DHCP options are listed in Example 3-2 and Table 3-1.
Example 3-2. IOS DHCP Commands
Click here to view code image

! Enabling the Cisco IOS DHCP ServerRouter(config)# service dhcp! Disables DHCP address conflict logging.Router(config)# no ip dhcp conflict logging! Specify the IP addresses that the DHCP Server should not assignRouter(config)# ip dhcp excluded-addresslow-address [high-address]! Create a name for the DHCP Server address poolRouter(config)# ip dhcp pool name! Specify the subnet network number and mask of the DHCP address poolRouter(dhcp-config)# network network-number[mask | /prefix-length]! Specify the IP addresses that the DHCP Server should not assignRouter(dhcp-config)# default-router address[address2 ... address8]! Configure DHCP pool optionsRouter(dhcp-config)# option option-number ip hostnameip dhcp excluded-address 192.168.10.0 192.168.10.10ip dhcp pool LWAPP-APs   network 192.168.10.0 255.255.255.0   default-router 192.168.10.1   option 43 hex f108.c0a8.1717.c0a8.1718   option 150 ip 192.168.11.206

Table 3-1. IOS DHCP Options

DHCP Option 43 for Lightweight Cisco Aironet Access Points Configuration Example: www.ciscosystems.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a00808714fe.shtml
Configuring the Cisco IOS DHCP Server: www.cisco.com/en/US/docs/ios/ipaddr/configuration/guide/iad_dhcp_svr_cfg.html#

Tip
With the ip helperaddress interface configuration command, you transform the broadcast request from the client into unicast and forward the request to a DHCP server on a different subnet.

Implement Local DHCP Services for Clients
WLAN controllers contain an internal DHCP server. This server is typically used in branch offices that do not already have a DHCP server. Keep in mind that
• Only lightweight access points are supported.
• When you want to use the internal DHCP server, you must set the management interface IP address of the controller as the DHCP server IP address.
• DHCP option 43 is not supported on the internal server. Therefore, the access point must use an alternative method to locate the management interface IP address of the controller, such as local subnet broadcast, DNS, priming, or over-the-air discovery.
• If the DHCP server is on a different subnet than the AP, use the ip helper-address command.
Internal DHCP Server: http://cisco.com/en/US/products/ps6366/products_tech_note09186a00808f8599.shtml#
(S)NTP
Network Time Protocol (NTP) is a protocol designed to time-synchronize. NTP runs over UDP port 123. Proper time synchronization is crucial when setting up a Unified Wireless Network. In addition, proper time synchronization will help you correlating log files.
NTP uses the concept of a "stratum" to describe how many NTP "hops" away a machine is from an authoritative time source. A "stratum 1" time server typically has a radio or atomic clock directly attached, a "stratum 2" time server receives its time through NTP from a "stratum 1" time server, and so on. A machine running NTP will automatically choose as its time source the machine with the lowest stratum number that it is configured to communicate with through NTP.
The communications between machines running NTP (known as associations) are usually statically configured; each machine is given the IP address of all machines with which it should form associations.
Simple Network Time Protocol (SNTP) is a simplified, client-only version of NTP that is used on autonomous access points. SNTP can only receive the time from NTP servers; it cannot be used to provide time services to other systems. SNTP typically provides time within 100 milliseconds of the accurate time, but it does not provide the complex filtering and statistical mechanisms of NTP.
You can configure SNTP to request and accept packets from configured servers or to accept NTP broadcast packets from any source. When multiple sources are sending NTP packets, the server with the best stratum is selected. The most important (S)NTP configuration commands can be found in Example 3-3.
Example 3-3. Basic (S)NTP Commands
Click here to view code image

! Configure NTP on a routerRouter(config)# ntp server <ip address> version <version number>! UNIFIED Configure NTP on the WLC(WLC) >config time ntp server <index> <ip address>! AUTONOMOUS  Configure SNTP on the APAP(config)# sntp server <ip address> version <version number>ip dhcp excluded-address 192.168.10.0 192.168.10.10ip dhcp pool LWAPP-APs   network 192.168.10.0 255.255.255.0   default-router 192.168.10.1   option 43 hex f108.c0a8.1717.c0a8.1718   option 150 ip 192.168.11.206

Unified, Managing the System Date and Time: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_gettingstarted.html#wp1144340
Autonomous, Configuring SNTP: www.cisco.com/en/US/partner/docs/wireless/access_point/12.4.25d.JA/Configuration/guide/scg12.4.25d.JA-chap5-admin.html#wp1036274
Syslog
Configuring a syslog server is helpful for troubleshooting purposes. Syslog runs on UDP port 514. By default, syslog messages are sent as a local broadcast. If you enable syslog on an AP that is not on same subnet as the syslog server, it is advisable to change to a unicast address in order to be able to collect this information and to reduce the possibility of a broadcast storm caused by syslog messages sent to the local broadcast, in case there is an incident that affects all APs in the same subnetwork.
Example 3-4. Syslog Commands on Wireless Services
Click here to view code image

! UNFIED - Configure Syslog on the WLC(WLC) >config logging syslog host <ip address>(WLC) >config logging syslog level <severity level>(WLC) >config logging syslog facility <facility level>! UNIFIED - Configure a global system logging host for all APs on the WLC(WLC) >config ap syslog host global <ip address>! AUTONOMOUS - Configure Syslog on the WLCAP(config)# logging host <ip address>AP(config)# logging trap <severity level>AP(config)# logging facility <facility level>ip dhcp excluded-address 192.168.10.0 192.168.10.10ip dhcp pool LWAPP-APs   network 192.168.10.0 255.255.255.0   default-router 192.168.10.1   option 43 hex f108.c0a8.1717.c0a8.1718   option 150 ip 192.168.11.206

Cisco Wireless LAN Controller Configuration Guide, Release 7.0.116.0: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_troubleshooting.html#wp1046868
Cisco IOS Software Configuration Guide for Cisco Aironet Access Points for Cisco IOS Releases 12.4(25d)JA: www.cisco.com/en/US/partner/docs/wireless/access_point/12.4.25d.JA/Configuration/guide/scg12.4.25d.JA-chap21-msg-logging.html
SNMP
Simple Network Management Protocol (SNMP) is an application layer protocol that provides a message format for communication between SNMP managers and agents using UDP ports 161 and 162 for sending and receiving SNMP traps. From a security point of view, it is recommended to run SNMPv3 with the default username changed or disabled. Keep in mind that your SNMP settings must match between the controller and the wireless control system (WCS). Also, you should use an encryption and hash keys that match your security policies.
Cisco Wireless LAN Controller Configuration Guide, Release 7.0.116.0: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_controller_setting.html#wp1372609
Cisco IOS Software Configuration Guide for Cisco Aironet Access Points for Cisco IOS Releases 12.4(25d)JA: www.cisco.com/en/US/partner/docs/wireless/access_point/12.4.25d.JA/Configuration/guide/scg12.4.25d.JA-chap18-snmp.html
Implement AAA Server Infrastructure
Because eavesdropping on wireless communications is relatively easy, it is an absolute requirement to secure your network by encrypting/authenticating, authorizing, and accounting traffic/clients.
The Cisco Secure ACS supports the following IEEE 802.1x Extensible Authentication Protocol (EAP) types supported by the Cisco Wireless Security Suite: PEAP, EAP-FAST, EAP-TLS, and LEAP.
The most important topics you should be familiar with are client authentication, management authentication, and basic public key encryption (PKI) for dot1x and webauth.
Managing Network Resources: www.cisco.com/en/US/docs/net_mgmt/cisco_secure_access_control_system/5.2/user/guide/net_resources.html
Managing Users and Identity Stores: www.cisco.com/en/US/docs/net_mgmt/cisco_secure_access_control_system/5.2/user/guide/users_id_stores.html
Managing Policy Elements: www.cisco.com/en/US/docs/net_mgmt/cisco_secure_access_control_system/5.2/user/guide/pol_elem.html
Managing Access Policies: www.cisco.com/en/US/docs/net_mgmt/cisco_secure_access_control_system/5.2/user/guide/access_policies.html
Authentication in ACS 5.2: www.cisco.com/en/US/docs/net_mgmt/cisco_secure_access_control_system/5.2/user/guide/eap_pap_phase.html







Chapter 4. Configure and Troubleshoot Autonomous Deployment Mode
After reading Chapter 1, "Planning and Designing 802.11 Wireless Technologies," you might decide to use the autonomous deployment model. A wireless autonomous access point solution is available for inside and outside installations with various models. Every autonomous access point requires full configuration. The autonomous AP can be configured through CLI using Cisco IOS syntax, as well through GUI using http or https.
In short, you need to be able to
• Configure and troubleshoot autonomous access points in different modes and radio settings
• Configure and troubleshoot autonomous access points with different security levels
• Configure and troubleshoot autonomous access points with quality of service (QoS)
• Configure and troubleshoot autonomous access points with wireless domain service (WDS)
Cisco IOS Software Configuration Guide for Cisco Aironet Access Points, 12.4(10b)JA & 12.3(8)JEC: www.cisco.com/en/US/partner/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b.html
Configuring and Controlling Management Access
General Access Setup
To be able to connect to your autonomous AP using access other than console access, you must assign an IP address to the access point using the bridge virtual interface (BVI). The BVI, which is associated to the subinterface of the native VLAN, links both the radio and the Ethernet interfaces of the AP, as shown in Example 4-1. The network and the VLAN number used must match the native VLAN number configured on the switch.
Example 4-1. BVI Configuration Steps
Click here to view code image

! Configure the bridge group in the wireless interface!AP# configure terminalAP(config)# interface Dot11Radio0.1Ap(config-subif)# encapsulation dot1q 1 nativeAp(config-subif)# bridge group 1! Configure the bridge group with the same bridge group number ("1" in this example) in the Fast Ethernetinterface so that VLAN 1 traffic is passed across the wireless interface to this wired side and vice versa!Ap(config)# interface fastEthernet0.1Ap(config-subif)# encapsulation dot1q 1 nativeAp(config-subif)# bridge group 1! Configure the BVI and assign the correspondent number of the bridge group to the BVI!Ap(configure)# interface BVI 1AP(config-if)# ip address 10.1.1.1 255.255.0.0AP(config-if)# no shut! Enable a BVI to accept and route packets from its correspondent bridge group!Ap(config)# bridge 1 route ip

VLANs on Aironet Access Points Configuration Example: www.cisco.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a0080665ceb.shtml
Accessing Methods
Various options are available to access and administer your AP:
• CLI access with Telnet, Secure Shell (SSH), or console access
• GUI access with HTTP or HTTPS
You have several methods to prevent, protect, and control access or access levels to the AP:
• Configuring a username and password
• Configuring password encryption
• Configuring multiple privilege levels
• Configuring RADIUS/TACACS+ authentication and authorization
• Configuring ACLs
Accessing the CLI: www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap3-cli.html#wp1039178
Using the Web-Browser Interface: www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap2-gui.html
Protecting Access to Privileged EXEC Commands: www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap5-admin.html#wp1034671
Controlling Access with TACACS+: www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap5-admin.html#wp1055471
Controlling Access with RADIUS: www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap5-admin.html#wp1035531
Configuring and Troubleshooting Network Services
To simplify troubleshooting and focus on the time/date, it is easier to have the entire device time-sync using an NTP server. For more details, see the following link:
Understanding Simple Network Time Protocol / Configure SNTP: www.cisco.com/en/US/partner/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap5-admin.html#wp1036313
To get permanent logging, you can use a syslog server to send all the relevant information. You can find out how to configure system message logging at the following link:
www.cisco.com/en/US/partner/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap21-msg-logging.html
An access point can act as a local DHCP server to assign IP address settings to devices on both your wired and wireless LANs for the Layer 3 subnet, which the BVI interface belongs to. Therefore, the local DHCP server can serve only one subnet because the access point has only one BVI interface. In a setup with multiple service set identifiers (SSID), the local DHCP server will provide an IP address only to the STA for the subnet belonging to the BVI interface.
Useful commands to troubleshoot and verify DHCP from the access point are as follows:
# debug ip dhcp server event# show ip dhcp binding# show ip dhcp server statistics
However, those commands won't help you to troubleshoot DHCP problems for an external DHCP server. In this case, it is best to collect sniffer traces on the given VLAN.
Configuring local DHCP services is the same as on any other IOS device, as described in Chapter 3, "Configure and Troubleshoot Infrastructure Application Services."
Configuring and Troubleshooting Different Modes and Roles
Autonomous access points can be used in different modes, for different requirements and design. To change the mode, you need to configure the station role accordingly on the dot11-radio 0 interface or dot11-radio 1 interface. The autonomous AP supports the following station-roles:
• Standalone: Access point is configured with >station-role root<. This is classically support for a wireless station to get network access to certain VLANs based on the SSID in use by the wireless station. The access point is connected with trunk or access mode to the wired network, allowing the VLAN connection. You can configure up to 16 SSIDs on your access point interface dot11-radio. Because you can assign only one SSID to a VLAN, you can support up to 16 client VLANs.
The mapping between SSIDs and VLANs can be overwritten per STA by using RADIUS-based VLAN access control, using 802.1x authentication with Internet Engineering Task Force (IETF) attributes 64/65/81.
Using a RADIUS Server to Assign Users to VLANs: www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap14-vlan.html#wp1038739
A special VLAN is the native VLAN, which is used as a management VLAN. Frames on the native VLAN are always transmitted untagged and are normally received untagged. Interface BVI 1 is associated to the subinterface of the native VLAN. Access point management traffic, such as Telnet/SSH/HTTP/RADIUS/NTP or Syslog, are sent on the native VLAN.
Configuring VLANs: www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap14-vlan.html
• P2P, P2MP bridge: In point-to-point (P2P) connections, we have two access points. One is configured as >station-role root< and the other is configured as >station-role non-root<. If you need a point-to-multipoint connection, we have multiple access points configured as >station-role non-root<. In this mode, we can use the wireless connection like a wired one and therefore extend the wired VLANs between the wireless connection. Make sure that both root and nonroot are configured with the same VLANs.
Line of sight (LOS) and antenna alignment are important to have a stable connection between the two wired LANs. In a P2MP setup, we must consider that the bandwidth of the root AP is shared between all the non-root APs. For troubleshooting, you should make sure to have access on both the root AP and non-root AP at the same time.
Useful commands to evaluate the connection are as follows:
> show dot11 association all-client
> dot11 dot11Radio 0 linktest / show dot11 link
> dot11 dot11Radio 0 carrier busy / show dot11 carrier busy
> debug dot11 dot11radio0 trace print mgmt
• Repeater: The access point is configured with >station-role repeater<. Having the access point act as a repeater is like an extension for the wireless network. The repeater access point forwards packets from a wireless STA to another wireless STA on the same channel. You can even set up a repeater chain. Note that the throughput for the connection is less than 50 percent per repeater because Tx/Rx occurs on the same channel. You must enable Aironet extensions (default is on) on root and repeater access points. Also, the infrastructure SSID must be assigned to the native VLAN.
More details can be found at www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap19-wgb-standby.html#wp1060261.
• Workgroup bridge (WGB): The access point is configured with >station-role workgroup-bridge<. An access point in workgroup bridge mode connects to an access point as a wireless client and provides a network connection for the devices connected to its Ethernet port. The workgroup bridge client should be assigned to a particular VLAN. WGB can also be used to connect to a unified wireless solution.
More details can be found at www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap19-wgb-standby.html#wp1040354.
Configuring and Troubleshooting SSID/MBSSID
The SSID is a unique identifier that an STA uses to establish wireless connectivity. The simplest setup is using one SSID that is mapped to the native VLAN:
dot11 ssid hofberg   authentication open   vlan 1interface dot11Radio 0   ssid hofberg
You can configure different SSIDs on the access point for different Layer 2 connections on the wireless site:
dot11 ssid oelberg   authentication open   vlan 2interface dot11Radio 0   ssid oelberg
The access point is using a 48-bit hex value called the basic service set identifier (BSSID) and is typically the MAC address of the radio interface. If you collect wireless sniffer traces, you can verify the BSSID in every data frame.
To overcome the legacy limitation of one BSSID, access points can now have multiple BSSIDs, which are typically the MAC addresses of the radio interface, with increment +1 of the last 3 bits and therefore supporting up to eight BSSIDs.
Use the following command to verify whether multiple basic service set identifiers (MBSSID) is supported:
show controllers [radio interface]
The following configuration is required on a global level to support MBSSID:
ap (config)# dot11 mbssid
To verify the MBSSID, you can use following command:
show dot11 bssid
In legacy access points, only one SSID can be sent in beacons for the BSS because only one MAC address can be used, so we can configure the guest-mode command only on one SSID:
ap (config-if-ssid)# guest-mode
If you now use an MBSSID, all eight SSIDs can be sent in beacons if you configure it on the SSID:
ap (config-if-ssid)# mbssid guest-mode
Configuring Multiple SSIDs: www.cisco.com/en/US/docs/wireless/access_point/12.4_21a_JA1/configuration/guide/scg12421aJA1-chap7-mbssid.html
Configuring and Troubleshooting Security
Layer 2 Security Policies
Using the autonomous infrastructure, all the Layer 2 security configuration is done on the SSID except for the wireless encryption. The encryption types and modes are configured on the appropriate radio interface with a reference to a wired VLAN, which is also mapped to the SSID. To understand the possible combinations of encryption and other Layer 2 security settings, refer to Chapter 1.
Configuring Layer 2 Security on the SSID
Table 4-1 shows some common SSID configuration examples with corresponding enabled security features and concepts.
Table 4-1. SSID Layer 2 Security Configuration

LARS-02(config)# dot11 ssid L2SECURITY

Note
The "list-name" in this table is the authentication, authorization, and accounting (AAA) method list that points to the AAA configuration. Also see the section "Implement AAA," later in this chapter.

Configuring Layer 2 Encryption on the VLAN
Table 4-2 shows several VLAN configuration examples with corresponding enabled encryption.
Table 4-2. SSID Layer 2 Security Configuration

LARS-02(config)# int dot11Radio 0
Implement AAA
So far, in Table 4-1 and Table 4-2, we have wireless 802.11-specific authentication on the SSID. If we configure EAP, this requires an additional configuration for a AAA RADIUS server. Further configuration steps for AAA are according to Cisco IOS convention, as shown in Example 4-2.
Autonomous AP infrastructures also support a local RADIUS server.
Implement a Centralized AAA Server
In Example 4-2, the list-name to point from the SSID to the corresponding AAA methods in use is AAA_METHOD. Also refer to the section "Layer 2 Security Policies," earlier in this chapter. The AAA server gets referenced by the server-group name RADIUS_ACS.
Example 4-2. Autonomous AAA Configuration Example
Click here to view code image

!aaa new-model!aaa group server radius RADIUS_ACS server 192.168.1.102 auth-port 1812 acct-port 1813!aaa authentication login AAA_METHOD group RADIUS_ACS!dot11 ssid L2SECURITY   authentication open eap AAA_METHOD   authentication key-management wpa version 2!radius-server host 192.168.1.102 auth-port 1812 acct-port 1813 key <radius-key>

Implement Local EAP Authentication
The support of a local RADIUS server allows you to run the autonomous solution standalone. The AAA configuration is the same as shown in Example 4-2, where the RADIUS server IP address is the bridge virtual interface (BVI) of the access point that the RADIUS server is running. An important detail is that the local RADIUS server is listening on the UDP port 1812 for RADIUS authentication/authorization and UDP port 1813 for RADIUS accounting, but the default IOS configuration sends packets to UDP ports 1645 resp. 1646. Make sure that you configure the ports for the first mention, as shown in Example 4-2.
Example 4-3 configures a local RADIUS server with two users, Cisco-1 and Cisco-2, serving the AP with the BVI IP address 192.168.1.102. Consult the configuration guide for the supported EAP types.
Example 4-3. Local Radius Server on Autonomous Infrastructure

radius-server local  nas 192.168.1.102 key <radius-key>  user Cisco-1 password Cisco  user Cisco-2 password Cisco


Note
The local RADIUS server on an access point is using auth-port 1812 and acct-port 1813.

Configuring and Troubleshooting Radio Settings
You will have to think about which radio band your setup will use: 802.11b/g (interface dot11radio 0) and/or 802.11a (interface dot11radio 1):
• Access points such as the 1130 Series or 1240 Series with two antennas by default use diversity antennas. However, you can configure the right or left antenna per your requirements:
interface dot11-radio 0  antenna receive right  antenna transmit right
You can also specify antenna gain; this value won't have any impact on the access point radio interface:
interface dot11-radio 0  antenna gain 2
Gain is only used in the management system Wireless LAN Solution Engine (WLSE):
www.cisco.com/en/US/docs/wireless/wlse/2.15/user/guide/ug.html
www.cisco.com/en/US/docs/wireless/wlse/2.15/device/setup/guide/dev.html
• Packet drop, for example, can be configured per user priority for voice traffic to allow a maximum of three retries and then discard the packet without disconnecting the wireless station if using the drop-packet keyword:
interface dot11radio { 0 | 1 }packet retries [value] drop-packet
Set the maximum data retries. Enter a setting from 1 to 128 for this value.
• Power settings depend on the radio interface (802.11b/g or 802.11a) and the regulatory domain in which the access point will be used. The following command verifies possible power settings in mW:
> show controllers
To configure:
> interface dot11radio { 0 | 1 }> power local
• In a point-to-point (P2P) scenario, it is recommended that you allocate the channel manually. Manual channel allocation prevents the root access point from changing its channel and therefore prevents the non-root APs from being down because dynamic channel scanning takes time.
To configure:
interface dot11radio { 0 | 1 }  channel [channel number]

Note
Manual channel allocation is not possible on every frequency. For example on the 802.11a radio interface you maybe won't be able to configure channels because of Dynamic Frequency Selection (DFS).

Which channels can be used depends on the regulatory domain. To verify which channels you can use, issue the following command:
> show controllers
Before you set the static channel, it is good practice to verify how busy the wireless channels are by performing a carrier busy test:
dot11 [interface-number] carrier busyshow dot11 carrier busy
• The available data rate configurations are according the IEEE standard, which is different between 802.11b (2.4 GHz) and 802.11g (2.4 GHz) and 802.11a (5 GHz).
> interface dot11radio { 0 | 1 }> speed
The following speed options are available for the 802.11b, 2.4-GHz radio:
Click here to view code image
{[1.0] [11.0] [2.0] [5.5] [basic-1.0] [basic-11.0] [basic-2.0] [basic-5.5] }
The following speed options are available for the 802.11g, 2.4-GHz radio:
Click here to view code image
{[1.0] [2.0] [5.5] [6.0] [9.0] [11.0] [12.0] [18.0] [24.0] [36.0] [48.0] [54.0] [basic-1.0][basic-2.0] [basic-5.5] [basic-6.0] [basic-9.0] [basic-11.0] [basic-12.0] [basic-18.0] [basic-24.0][basic-36.0] [basic-48.0] [basic-54.0] }
The following speed options are available for the 5-GHz radio:
Click here to view code image
{[6.0] [9.0] [12.0] [18.0] [24.0] [36.0] [48.0] [54.0] [basic-6.0] [basic-9.0] [basic-12.0][basic-18.0] [basic-24.0] [basic-36.0] [basic-48.0] [basic-54.0] }
• Clear Channel Assessment (CCA) basically is the establishment of a noise floor below which the radio interface ignores RF inputs in search of a good, solid signal. This threshold manipulates the receiver sensitivity. There might be intermittent connectivity losses with wireless bridges if the CCA value is not configured correctly. Make sure that it is set close to the default value of 75, but not 0.
> interface dot11radio { 0 | 1 }> cca 75
Configuring and Troubleshooting IGMP Snooping
Depending on the AP software version, multicast traffic is sent on the highest or lowest basic rate supported by the radio interface. In any case, the AP treats multicast using the "fire and forget" technique, and therefore an STA might not receive frames successfully. You can disable a low basic rate if you require a certain minimum data rate; however, traffic is still unreliable as frames are not retransmitted at the MAC layer.

Note
If there is no multicast router for processing an Internet Group Management Protocol (IGMP) query and response from the host, it is important that no ip igmp snooping be configured on the access point. Otherwise, if no IGMP query or response is detected, all multicast traffic for that group is dropped.

Configuring and Troubleshooting QoS
In the following sections, you learn how to configure the 802.11 quality of service (QoS) parameters in an autonomous AP deployment. It is crucial that you understand the meaning of each parameter and that you select values according to design and deployment guide requirements. Refer to the sections "802.11 Media Access" and "802.11 QoS" in Chapter 1 for more details.
Configuring and Validating QoS Parameters
Table 4-3 lists the different WLAN QoS configuration commands. For simplification, the description of the Feature/Term is aligned with Table 1-2. All those parameters need to be configured for each traffic class under the radio interface:
LARS-02(config-if)# dot11 qos class voiceLARS-02(config-if-qosclass)#
Table 4-3. Configuring QoS Parameters

Because almost all these parameters are configured on the interface, the easiest way to validate (apart from verifying the configuration) is to use the show controller command. Example 4-4 gives a fragment from the output showing the QoS parameters.
Example 4-4. Validation of QoS Parameters
Click here to view code image

LARS-02# show controllers dot11RadioConfigured Cell Access Class Parameters  Back      : cw-min 5 cw-max 10 fixed-slot 7 admission-control Off txop 0  Best      : cw-min 5 cw-max 10 fixed-slot 3 admission-control Off txop 0  Video     : cw-min 4 cw-max 5 fixed-slot 2 admission-control Off txop 6016  Voice     : cw-min 3 cw-max 4 fixed-slot 2 admission-control Off txop 3264

Clear Channel Assessment (CCA)
The same show command also shows the current channel assessment, which is a good indicator of the RF situation of the selected radio interface and a good starting point for troubleshooting RF issues. The same value also gets advertised in the QBSS-Load-Element in the channel utilization field.
The channel utilization field is defined as the percentage of time, normalized to 255. This percentage is computed using the following formula:

A quick filtering using the pipe symbol (|) on the IOS command line presents the channel utilization, as shown in Example 4-5.
Example 4-5. Validation of CCA Value Sent in QBSS Load Element

LARS-02# show controllers dot11Radio 0 | QBSSQBSS Load: 0x1F

Setting Up Correct WLAN QoS Tagging
As shown in Table 1-3, QoS tagging needs to be adopted when changing from wireless to wired medium or vice versa. Although the command line actually allows configuring class maps to match and policy maps to retag the QoS fields in normal IOS manner, an autonomous APs retagging needs to be configured globally with a single command:
dot11 priority-map avvid
Upon adding this command to the AP configuration, Cisco AVVID (Architecture for Voice, Video, and Integrated Data) priority mapping is enabled. AVVID priority mapping maps Ethernet packets tagged as class of service 5 to class of service 6.
Configuring and Troubleshooting WDS (L2)
Wireless domain services (WDS) are used to centralize the authentication in an autonomous infrastructure. That allows exchanging the key material between standalone access points, which is needed for CCKM fast secure roaming to minimize roaming time, for example, in voice deployment.
Step 1
As a first step, the infrastructure AP needs to join the wireless domain by registering on the WDS; see Figure 4-1. To register infrastructure access points with WDS, an 802.1x authentication occurs. You could run a local RADIUS server on WDS for the 802.1x authentication of infrastructure access points or use an external AAA server.

Figure 4-1. WDS Network Setup
WDS and infrastructure access points communicate over a multicast protocol using Wireless LAN Context Control Protocol (WLCCP).
To verify infrastructure access point registration, issue the following commands:
show wlccp wdsshow wlccp wds ap
To have fallback possibility for WDS, you can configure the priority and therefore specify the primary or secondary WDS. Priority is 1-255, where 255 is the highest and therefore the primary WDS.

Note
Depending on whether the WDS access point is using a radio interface to service the wireless STA, the WDS can support 30 (radio interface on) or 60 (radio interface off, also called WDS Only mode) infrastructure access points.

Step 2
In the second step, upon association of the wireless STA, 802.1 x authentications are centralized from the WDS. After successful authentication of the wireless STA, the WDS will provide infrastructure access points with the necessary key material to perform encryption with the wireless STA. Therefore, infrastructure access points do not require any AAA configuration for authentication and authorization. However, should you use accounting, the infrastructure access point needs to be configured for accounting.
To verify that the wireless stations are authenticated through WDS, use the following command:
show wlccp wds mn

Note
You can configure different AAA servers for infrastructure access points and wireless stations, including local RADIUS servers and external RADIUS servers.

To allow wireless STA seamless roaming, it is mandatory that WDS and all infrastructure access points are in the same broadcast domain (Layer 2).
More details can be found at the following link:
www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap12-wdsroam-rm.html#wp1035881
Wireless Domain Services AP as an AAA Server Configuration Example: www.cisco.com/en/US/products/hw/wireless/ps458/products_configuration_example09186a008059a559.shtml.
In an autonomous deployment model, the access point won't have to join and centralize devices because every access point can work for itself. There is one exception with the WDS solution. In this case, WDS is the center for all the authentication/authorization.
Infrastructure Access Points Need to Register on WDS (Only If WDS Is Used)
The following commands will help determine possible problems.
Infrastructure AP:
show wlccp ap
Status about registration:
debug wlccp ap . . .
WDS AP:
show wlccp wds
Information status about WDS:
show wlccp wds ap
Detailed information about infrastructure APs:
show wlccp wds mn
Detailed information about wireless stations:
debug wlccp wds . . .
Keep in mind the limitation of infrastructure APs supported with WDS.
It could happen that authentication is failing during registration. In this case, you will have to troubleshoot authentication and RADIUS on an external or local radius server.
External RADIUS server:
debug radius
Internal RADIUS server:
debug radius local-server . . .
Authentication in both cases is the same:
debug aaa authenticationdebug aaa authorization
Troubleshoot the Autonomous Deployment Model
Autonomous access point models have some LEDs that give information about the Ethernet/radio and operation status based on color code. Further troubleshooting has to be done using the debug and show commands, depending on the problem.
You must understand the setup if standalone, point-to-point, point-to-multipoint, or WDS is used to know which part to troubleshoot. As an example of implementing WDS, if a wireless STA cannot authenticate, you will have to first check whether infrastructure APs are registered on the WDS before starting troubleshooting authentication central on the WDS.
You need to find out whether the problem is related to a wired or wireless issue.
Troubleshoot Client-to-AP Connectivity
Wireless Station Needs to Associate to AP
To verify that the wireless stations are associated, use the following commands:
show dot11 associationsshow dot11 associations all-client
If you have problems getting associations, use the following debug command:
Click here to view code image
debug dot11 dot11Radio [0/1] trace print mgmt clients uplink keys rates
Wireless Station Needs to Do Authentication
Either you are using WDS with CCKM and therefore refer to Step 1 in this part, or you will have to troubleshoot the authentication on a per-AP level; the same commands as WDS are valid.
External RADIUS server:
debug radius
Internal RADIUS server:
debug radius local-server
Authentication in both cases is the same:
debug aaa authenticationdebug aaa authorization
Wireless Client Needs to Get IP Address and Network Connection
This is a tricky part because the AP can act as a DHCP server only for the same subnet BVI belongs to, and for any other subnet (VLAN), the AP is a pure Layer 2 connection device. Therefore, you cannot troubleshoot DHCP. You will have to take a sniffer trace on the VLAN/trunk that is connected to the wired interface of the AP to make sure that DHCP discovery is seen from the client.
If this is a Cisco switch, you can use the monitor session command to set up the sniffing interface.
If you use the DHCP server local on the AP for the BVI subnet, the following commands can help:
show ip dhcp bindingdebug ip dhcp server eventdebug ip dhcp server packet
Upgrade Autonomous to LWAPP/CAPWAP
You can change the functionality from an access point between autonomous access points and a unified access point. You must run Cisco IOS Release 12.3(7)JA or later before you can perform the upgrade from autonomous to unified solution. You can also revert from a unified to an autonomous solution.
To determine which IOS version is running, issue the following command:
show version
The feature set for the IOS autonomous access point version is w7, whereas w8 is for Lightweight Access Point Protocol/Control and Provisioning of Wireless Access Points (LWAPP/CAPWAP).
c1240-k9w7-mx.124-10b.JDA1 -> Autonomous solution
c1240-k9w8-mx.124-10b.JDA1 -> Unified solution
To allow an autonomous access point to join a wireless LAN controller (WLC), you will have to load the software version w8.
Cisco offers an upgrade tool, but you also can upgrade manually using the Mode button and the archive download command:
www.cisco.com/en/US/docs/wireless/access_point/conversion/lwapp/upgrade/guide/lwapnote.html
Because LWAPP/CAPWAP does AES encryption, the access point will have to generate a self-signed certificate (SSC). To trust this SSC, you need to tell the WLC to trust this SSC. Because the certificate is the user, you also need to be careful with system time configured.
You might have to authorize the MAC address and key hash on the WLC; therefore, use the following command to learn about the key hash in use for a certain access point:
debug pm pki enable







Chapter 5. Configure and Troubleshoot the Cisco Unified Wireless Deployment Model
The deployment and management of a wireless network are complex topics. The Cisco Unified Wireless Network architecture provides you with powerful tools and features that allow you to deliver secure, scalable, and high-performance networks with reduced administrative overhead.
The main components of the Cisco Unified Wireless Network architecture are the wireless LAN controller (WLC) and the lightweight access points (LAP). In this deployment model, the LAPs are centrally managed by the WLC, with no need for individual AP configuration.
This chapter covers the concepts behind the communication between the WLC and the managed LAPs, as well as the features used to handle the client traffic, the radio frequency (RF), and the controller redundancy.
Configuring and Controlling Management Access
Accessing WLCs
Various options are available to access the WLC:
• GUI access with HTTP or HTTPS
• CLI access with Telnet, Secure Shell (SSH), or console access
• Access through a service port
Using the Web-Browser and CLI Interfaces: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_gettingstarted.html
Accessing Lightweight APs
In Wireless LAN Controller release 5.0 and later, the controller supports the use of Telnet or SSH protocols to connect to and troubleshoot lightweight access points. You can use these protocols to make debugging easier, especially when the access point is unable to connect to the controller. You can configure Telnet and SSH support only through the controller CLI using the config ap {telnet | ssh} command. The Cisco lightweight access point associates with this Cisco wireless LAN controller for all network operation and in the event of a hardware reset.
Troubleshooting Access Points Using Telnet or SSH: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_troubleshooting.html#wp1043919

Note
Usually, the management interface IP address is used for GUI and CLI access.
The WLC can also be accessed with one of its dynamic interface IP addresses. Use the config network mgmt-via-dynamic-interface command to enable this feature.
Wireless clients can access the WLC only when the option "Enable Controller Management to be Accessible from Wireless Clients" is enabled.
Wireless clients have both CLI and GUI access with the dynamic interface.
Wired computers can have only CLI access with the dynamic interface of the WLC.

Configure and Troubleshoot Interface Settings
To understand how the wireless LAN controller connects to the wired network, you first need to be clear on the following concepts:
• Ports: This name represents the physical interface used to connect the WLC to a neighbor switch. There are two port types: the distribution system port and the service port.
• Interfaces: This name represents the logical interface, which includes several parameters, such as an IP address and default gateway, the primary and secondary physical port mapping, the VLAN identifier, and the DHCP server(s).
Ports
The specifications and number of ports vary across the different controller platforms. Table 5-1 provides a list of ports per controller type.
Table 5-1. Ports per Controller Type

Each distribution system port is always an 802.1q VLAN trunk, whereas the service port must be connected to an access port because it carries no VLAN tags.
Media Type
The 2100 Series controllers have eight Fast Ethernet ports, whereas the WiSM (Cisco Catalyst 6500 Series/7600 Series Wireless Services Module) has no external distribution system ports (internal Gigabit ports connected to the switch backplane). On the other hand, the 4400 and 5500 Series distribution system ports are small form factor plug-in (SFP) modules that accept both fiber and copper physical connectors, such as
• 1000BASE-SX SFP modules, which provide a 1000-Mbps wired connection to a network through an 850-nM (SX) fiber-optic link using an LC physical connector
• 1000BASE-LX SFP modules, which provide a 1000-Mbps wired connection to a network through a 1300-nM (LX/LH) fiber-optic link using an LC physical connector
• 1000BASE-T SFP modules, which provide a 1000-Mbps wired connection to a network through a copper link using an RJ-45 physical connector
Link Aggregation (LAG)
Some controllers support link aggregation (LAG), which bundles all the controller's distribution system ports into a single 802.3ad port channel. Having LAG enabled is the only available option on the Cisco WiSM, whereas the 4400 and 5500 Series controllers can operate both with and without LAG. The 2100 Series WLCs don't support LAG.
You can enable or disable LAG as follows:
• From the GUI: Controller > General > LAG Mode on next reboot
• From the CLI: Type config lag [enable | disable]
When you modify the LAG operation mode, you must save the configuration and reboot the controller for this configuration to become effective. When you enable LAG, all the available distribution ports are bundled into a single port channel. The WLC doesn't perform any kind of channel negotiation, so it doesn't matter whether the neighbor switch is configured for Link Aggregation Control Protocol (LACP) or the Cisco-proprietary Port Aggregation Protocol (PAgP).
You must configure the neighbor switch to use a port channel load-balancing method that terminates all IP datagram fragments on a single controller port; otherwise, the access points might not be able to join the controller. The recommended load-balancing method is src-dst-ip.
LAG is beneficial because it handles both load balancing and failover automatically.
Service Port
Controllers like the 4400 Series, WiSM, and 5500 Series have a service port that is used for out-of-band management. The use of the service port is mandatory only on the WiSM platform because it's used for the internal communication between the controllers and the Supervisor 720 (WCP protocol on UDP/10000).
Consider the following guidelines when using the service port:
• It must be connected to an access-mode port on the neighbor switch.
• It must be configured on a separate IP subnet than any other interface configured on the controller.
• Don't configure wired clients on the same subnet/VLAN as the service port, or you will not be able to access the management interface.
Interfaces
Five types of interfaces are available on the controller:
• Management interface:
• This is mandatory and it's the in-band management interface. It is used for communication with external devices such as the Control and Provisioning of Wireless Access Points (CAPWAP) access points, mobility group peers, and authentication, authorization, and accounting (AAA) servers.
• AP-Manager interface:
• It is optional on the 5500 Series controller because the management interface acts by default as an AP-Manager interface. This interface is used for the APs to establish the CAPWAP tunnels.
• When using LAG, you can configure only one AP-Manager interface; when LAG is disabled, you need to configure an AP-Manager for each physical port.
• Virtual interface:
• It is used to support mobility management, DHCP proxy, and Layer 3 security (such as web authentication).
• This port must be configured with a nonroutable IP address, and it's used only for the communications between the wireless clients and the WLC itself.
• You must configure all the WLCs within a mobility group with the same virtual interface IP address; otherwise, intercontroller roaming will result in client connectivity loss for some time.
• You can assign a Domain Name System (DNS) host name to this interface that is used upon web authentication redirection to the login page. For this feature to work, the clients need to resolve this DNS name to the virtual interface IP address.
• Service-Port interface:
• This interface is statically mapped to the service port. It can obtain an IP address through DHCP or it can be statically assigned. There's no default gateway set on this port, but you can configure static routes for remote access to the service port.
• Be aware that those static routes will affect other traffic to/from the controller.
• Dynamic interface:
• These (optional) interfaces are also referred to as VLAN interfaces and are used to assign wireless users to VLANs on the wired network.
• Each interface must have a static IP address (with subnet mask and default gateway), as well as a VLAN identifier and a primary (and optionally secondary) DHCP server.
VLAN Identifier
Management, AP-Manager, and Dynamic interfaces must be configured with a VLAN identifier; use the value of 0 for an untagged VLAN or a nonzero value for a tagged VLAN.
Backup Port
If you don't use LAG, you must assign Management, AP-Manager, and Dynamic interfaces to a physical port. For failover purposes, you can specify a backup port that is used if the primary physical port fails.
NAT
The 5500 Series WLC enables you to configure a Network Address Translation (NAT) IP address for AP manager interfaces (management interface and/or dynamic AP manager). This setting enables you to deploy a 5500 Series controller behind a NAT device, having the controller advertise the NAT IP address on the discovery responses. When configuring the NAT address, the APs will send join requests to this address, which will cause internal APs to fail the registration process unless the NAT address is also accessible to local/internal APs.
For more information about the ports and interface configuration, refer to the Wireless LAN Controller Configuration Guide at www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_ports_interfaces.html.
Configure and Troubleshoot Lightweight AP
In this section, you will find information about the configuration and management of the lightweight access points (LAP) in the Cisco Unified Wireless Network solution.
The management functions of the Cisco Unified Wireless Network architecture are centralized on the wireless LAN controller, whereas the LAP is the wireless termination point. This means that WLC and LAP cannot operate independently, as the functions of a traditional "fat" access point are in fact split between them. This model is referred to as the split MAC architecture. The LAP is in charge of all the time-sensitive MAC operations, whereas the non-real-time MAC functions are managed by the WLC.
Examples of real-time MAC functions handled on the AP side include
• Beacon generation
• Probe handling
• Control frame processing
• Data traffic encryption
The non-real-time functions handled by the WLC include
• Association and disassociation
• 802.1x authentication
• Key management
• Data frame handling
• RF management
This architecture is meant to bring the same functionality as a traditional AP, adding scalability and ease of management as well as the capability to deliver advanced services.
The CAPWAP/LWAPP Protocol
The LAP and the WLC communicate using LWAPP (Lightweight Access Point Protocol) or, in controller software release 5.2 or later, CAPWAP (Control and Provisioning of Wireless Access Points).
CAPWAP is based on the LWAPP protocol, which is defined in an Internet Engineering Task Force (IETF) RFC draft document, and both protocols define the interaction between the WLC and LAP in terms of
• Data traffic encapsulation: This channel carries the traffic to and from the wireless clients; the LWAPP data channel adds a header of 6 bytes to each 802.11 data packet.
• Control channel: This tunnel carries the management traffic used by the WLC to configure and monitor the operational status of the AP.
The control traffic is identified by the "C" bit set to 1 in the LWAPP header flag field.
The CAPWAP (or LWAPP) tunnel is established between the LAP and the WLC AP-Manager interface IP addresses.
Despite the fact that there are several similarities between CAPWAP and LWAPP, there are some important differences that you should keep in mind. These are summarized in Table 5-2.
Table 5-2. CAPWAP and LWAPP Comparison

Access Point Communication Phases
For the LAP to be able to service data traffic, it needs to go through the following phases:
1. Discovery
2. Join
3. Firmware management
4. Configuration
5. Runtime
Discovery Phase
During this phase, the LAP learns the available controllers using the following methods:
• Layer 3 broadcast: With this method, the LAP sends an LWAPP/CAPWAP discovery request to the local IP subnet broadcast address.
• Over-the-air provisioning (OTAP): This feature is disabled by default. If enabled, a LAP can obtain the WLC IP address by listening to the neighbor messages transmitted by other LAPs.
• Locally stored controller IP address: The LAP keeps a local list of controller IP addresses that is either configured through "priming" or by setting a list of primary, secondary, and tertiary WLCs. This last option is only available when the LAP was already associated to a controller.
• DHCP Option 43: The controller management IP address(es) can be included in the DHCP Option 43. The Cisco Aironet APs use a TLV (type-length-value) format for DHCP Option 43:

In Example 5-1, you can find the configuration of a DHCP pool named LWAPP-AP for the IP network 192.168.10.0/24. The Option 43 includes the IP management addresses of two WLCs, 192.168.30.21 and 192.168.30.23, respectively
Example 5-1. IOS DHCP Server Using Option 43 Sample Configuration

Click here to view code image
ip dhcp excluded-address 192.168.10.0 192.168.10.10ip dhcp pool LWAPP-APs   network 192.168.10.0 255.255.255.0   default-router 192.168.10.1   option 43 hex f108.c0a8.1e15.c0a81e17

• DNS: The LAP will query the configured DNS server for the CISCO-LWAPP-CONTROLLER.localdomain (and CISCO-CAPWAP-CONTROLLER.localdomain) host name.
The localdomain is replaced by the AP with the locally configured domain name, which can be obtained, for example, through DHCP Option 15.
You should configure this record on the DNS server if you plan to use the DNS discovery method.
After the AP has compiled the list of the discovered controller management IP addresses, it will send the CAPWAP discovery request to each of them to gather information about
• AP-Manager IP address(es)
• Load on each AP-Manager interface
• Master Controller mode
Each available WLC will return this information through a CAPWAP discovery response to the LAP.
Join Phase
The LAP will use the information gathered during the discovery phase to select a WLC to join. The join process involves a mutual authentication of the LAP and the WLC through X509 certificates, achieved through a join request sent by the LAP, followed by a join response sent by the WLC. During this phase, the LAP also discovers the maximum transmission unit (MTU) supported by the transport.

Note
Although the discovery and join messages are control frames, they are not encrypted.

Firmware Management
For the LAP to communicate with the WLC, it must run the software that matches the version used on the WLC. If there is a mismatch, the LAP will download the proper software image directly from the controller through CAPWAP.
Configuration Phase
After the LAP joins a WLC, it needs to be provisioned with the configuration. This is achieved by the exchange of config request and config response messages.
Runtime Phase
During runtime operations, the LAP is enabled for operation and the WLC will keep on controlling and monitoring the LAP operating status by issuing commands through the CAPWAP control tunnel, such as config (add, change, delete) and RRM (Radio Resource Management) messages. The LAP and the WLC exchange keepalive messages to maintain the communication channel. This heartbeat mechanism is based on echo requests sent by the AP and echo responses sent by the WLC.
Deploying Cisco 440X Series Wireless LAN Controllers: www.cisco.com/en/US/docs/wireless/technology/controller/deployment/guide/dep.html#wp1156909
Lightweight AP (LAP) Registration to a Wireless LAN Controller (WLC): www.cisco.com/en/US/tech/tk722/tk809/technologies_tech_note09186a00806c9e51.shtml
LWAPP Traffic Study: www.cisco.com/en/US/tech/tk722/tk809/technologies_white_paper09186a0080901caa.shtml
DHCP Option 43 for Lightweight Cisco Aironet Access Points Configuration Example: www.ciscosystems.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a00808714fe.shtml
Microsoft Windows 2003 DNS Server for Wireless LAN Controller (WLC) Discovery Configuration Example: www.cisco.com/en/US/products/ps6366/products_tech_note09186a00809d5097.shtml
Understanding OTAP: www.cisco.com/en/US/products/ps6366/products_tech_note09186a008093d74a.shtml
802.1x Authentication for Access Points
You can enable the 802.1x supplicant on the lightweight APs to authenticate the access on the switchport. The access point supports Extensible Authentication Protocol-Flexible Authentication via Secure Tunneling (EAP-FAST) authentication with anonymous Protected Access Credential (PAC) provisioning.
You can configure the authentication credentials as follows:
• From the AP CLI (if the AP is still running the recovery image): lwapp ap dot1x username <username> password <password>
• From the WLC CLI: config ap dot1xuser add username <user> password <password> [all | Cisco_AP]
• If the config is applied to a single AP, you can revert it to the global config as follows: config ap dot1xuser delete <Cisco_AP>
• From the WLC GUI: Wireless > Access Points > Global Configuration
• Under 802.1x Supplicant Credentials, select the 802.1x Authentication check box and specify the username and password to be inherited by all the APs.
• This setting can be overridden on individual APs as follows: Access Points > All APs. Click the name of the access point for which you want to override the authentication settings and choose the Credentials tab. Under 802.1x Supplicant Credentials, select the Over-ride Global Credentials check box to prevent this access point from inheriting the global authentication username and password from the controller.
For more information about the 802.1x wired supplicant configuration on lightweight APs, refer to the following document:
www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_lwap.html#wp1366812
Locally Significant Certificates
The lightweight APs authenticate to the WLC by default using the Manufacturing Installed Certificate (MIC) or the Self-Signed Certificate (SSC). If you have a Public Key Infrastructure (PKI) to control certificate authorities and policies on the certificate use, you can have these certificates be used by the Cisco lightweight APs to join, authenticate, and derive session keys. These certificates are referred to as Locally Significant Certificates (LSC) and are supported on normal APs as of WLC version 5.2; WLC release 7.0 introduces support for LSCs on mesh APs.
Take into account the following remarks about LSCs:
• The LSC provisioning uses the Simple Certificate Enrollment Protocol (SCEP), which uses HTTP as the transport protocol between the WLC and the certificate authority (CA).
• The WLC performs the request for the root CA and a CA-signed device certificate on behalf of the AP (CA-proxy).
• The AP certificate is provisioned through the CAPWAP tunnel after it joins using the current MIC/SSC (certRequest/certResponse).
• After the LSC is installed, it does not remove any preexisting certificates on the AP.
• When an AP is provisioned with an LSC, it doesn't read the MIC upon boot; changing from LSC to MIC would require the AP to reboot.
• Mesh APs require 802.1x authentication. The CA certificate must be installed and trusted on the AAA server (the WLC itself or an external server, depending on the configuration).
For more information about Locally Significant Certificates, refer to the following documents:
Cisco Wireless LAN Controller 7.0 Configuration Guide: Locally Significant Certificates: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_mesh.html#wp1859571
Locally Significant Certificates Configuration Example: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_mesh.html#wp1859571
Configure AP Modes
In this section, you can find a description of the operational modes that you can configure for a lightweight AP. The available modes are
• Local
• Hybrid Remote Edge Access Point (H-REAP) or FlexConnect
• Office Extend
• Monitor
• Rogue Detector
• Sniffer
• Bridge
The LAP mode is configured as follows:
• From the CLI: config ap mode <mode> <Cisco_AP>
• From the GUI: Wireless > Access Points > All APs > [AP] > General > AP Mode
• You can find the additional options for H-REAP LAPs (for example, VLAN support) under the H-REAP tab.
After you modify the operational mode of a LAP, you must reload it for the change to be applied.
Local Mode
This is the standard operational mode of a LAP to offer service to data clients. A local LAP also goes off-channel for 50 ns, to scan for noise and rogues on all the configured channels. It cycles through each channel, one at a time, for the period specified under the Auto RF configuration.
H-REAP Mode
This mode is the solution for remote office deployments, where the LAP is connected to a WLC through a WAN link. This mode allows the LAPs to still perform authentication of the client and to locally switch the data traffic, even when the connection to the WLC is lost. However, when the LAP is in connected mode (when the connection to the WLC is available), the client traffic can also be centrally switched at the WLC.
The local versus central switching configuration is done on a WLAN basis with this CLI command:
Click here to view code image
config wlan h-reap local-switching <wlan_id> {enable | disable}
When enabling local switching for a specific WLAN, by default the traffic is forwarded on the native VLAN of the switchport to which the H-REAP LAP is connected. The VLAN mode enables the AP to tag the traffic for specific locally switched WLANs through the configuration of WLAN-to-VLAN mappings. When VLAN mode is enabled, the LAP has to be connected to a trunk port; the native VLAN must be defined as it's used by the LAP for the communication with the WLC.
Office Extend
This mode enables you to deploy APs on remote sites with direct connectivity through the Internet, enabling Datagram Transport Layer Security (DTLS) encryption for data encapsulation (central switching) with no need for a dedicated VPN. This mode also allows a user to configure a personal service set identifier (SSID) (local switching) that can be configured directly by the user by accessing the AP GUI.
Office Extend APs can work behind a NAT device, but only a single AP can be deployed behind a single NAT device.
Monitor Mode
This mode allows the AP to scan all configured channels every 12 seconds for about 60 ms. In this mode, the radio is only set in listening mode; however, deauthentication frames can still be transmitted by a monitor mode LAP. The main use of this mode is for location-based services, intrusion detection, and rogue detection. RLDP (Rogue Location Discovery Protocol) can't be used on a monitor mode LAP.
Rogue Detector Mode
In this mode, the LAP listens to wired traffic only, so the radios are disabled. The MAC addresses detected by the rogue detector mode LAP are compared by the WLC with the list of discovered rogue clients and APs to detect what rogue clients or APs are connected to the wired network. This mechanism is based on listening for ARP packets. The rogue detector LAP is usually connected to a trunk port, to be able to listen on multiple VLANs.
Sniffer Mode
In this mode, the LAP acts as a wireless sniffer, capturing and forwarding the traffic to a host running the Airopeek sniffer software.
Bridge Mode
This is the mode used for mesh APs.
Controlling Lightweight Access Points: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_lwap.html
Configuring H-REAP: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_hreap.html
Rogue Detection Under Unified Wireless Network: www.cisco.com/en/US/tech/tk722/tk809/technologies_white_paper-09186a0080722d8c.shtml
Lightweight AP FAQ: www.cisco.com/en/US/products/hw/wireless/ps430/products_qanda_item09186a00806a4da3.shtml
AP Authentication and Authorization
The Cisco Unified Wireless architecture requires the interaction of the wireless LAN controller with the LAPs. To allow a secure communication between these components, the LAP and WLC go through a mutual authentication process, which is carried out during the CAPWAP join phase.
LAP Authentication
The mutual authentication is achieved by means of X509 certificates; the LAP includes this certificate in the join request. This certificate is validated by the WLC that sends its certificate as part of the join response. During this phase, the LAP and the WLC also derive the key that will be used for the control tunnel encryption.
The certificate used by the LAP can be either a MIC (Manufacturing Installed Certificate) or an SSC (Self-Signed Certificate). The latter is required for Aironet APs shipped before July 18, 2005 because they do not have MICs. On these APs, the SSC is generated by the Cisco Upgrade Tool during the conversion from autonomous mode to lightweight.
If the LAP is equipped with a MIC, the WLC can validate this certificate with no additional configuration. However, if you need to operate LAPs with SSCs, you must make sure that the following conditions are met:
• The controller is configured to accept SSC.
• The key hash for each LAP is added to the WLC authorization list.
These steps can be completed as follows:
• From the GUI:
• Choose Security > AAA > AP Policies.
• Select Enabled on Accept Self-Signed Certificate.
• Click Add to specify the AP MAC address, the certificate type as SSC, and the key hash value.
• Click Apply to commit the changes.
• From the CLI:
config auth-list ap-policy ssc enableconfig auth-list add ssc <AP_MAC> <Key_Hash>
The SSC key hash can be retrieved from the CSV file produced by the Upgrade Tool. If this file is not available, you can enable the debug pm pki enable command on the WLC while the AP is trying to authenticate.
Self-Signed Certificate Manual Addition to the Controller for Lightweight Converted APs: www.cisco.com/en/US/products/ps6366/products_configuration_example09186a00806a426c.shtml
Lightweight Upgrade Tool Troubleshooting Tips: www.cisco.com/en/US/tech/tk722/tk809/technologies_tech_note09186a008072d9a1.shtml
LAP Authorization
After the LAP is authenticated, you can enable AP authorization to control what APs are allowed to join the controller. A WLC with the default configuration will accept any MIC LAPs, whereas for the SSC LAPs, you will need to add the MAC address and key hash as previously explained. If you need to authorize LAPs using MICs, you can either add the MAC addresses to the local authorization list or you can configure the WLC to use an external AAA (RADIUS) server.
When using a RADIUS server for LAP authorization, the controller uses the AP MAC as both the username and password. This phase doesn't require strong authentication as the LAP at this point has already been authenticated using the MIC, which is a strong authentication.
To enable AP authorization, follow these steps:
• From the GUI:
• www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_lwap.html#wp1239085
• From the CLI:
• Configure the access point authorization policy: config auth-list ap-policy {authorize-ap {enable | disable} | ssc {enable | disable}}
• Add an access point to the authorization list: config auth-list add {mic | ssc} ap_mac [ap_key]
To verify the configured entries on the authorization list, use the following command at the CLI:
show auth-list
Authorizing Access Points: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_lwap.html#wp1198207
Lightweight Access Point (LAP) Authorization in a Cisco Unified Wireless Network Configuration Example: www.cisco.com/en/US/products/ps6366/products_configuration_example09186a00808c7234.shtml

Note
The LAP entries on the local authorization list are added on the local user database (DB). Make sure that the DB size is sufficient to store all the needed entries. The default size is 512, and it can be increased to 2048 entries (Security > General page). This DB is used to store local management users (including lobby ambassadors), net users (including guest users), MAC filter entries, and disabled clients. Together these cannot exceed the configured database size. For more information, visit www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_security_sol.html#wp1919050.

High Availability
You can decrease the time that it takes for an AP to move to a backup controller after a controller goes down. This can be achieved by configuring the high-availability features that have been introduced as of version 5.0 of the WLC:
• Configure the heartbeat interval between the controller and access point with a smaller timeout value.
• In addition to the option to configure primary, secondary, and tertiary controllers for a specific access point, you can now also configure primary and secondary backup controllers for a specific controller.
The AP chooses an available controller from the backup controller list in this order:
• Primary
• Secondary
• Tertiary
• Primary backup
• Secondary backup
• The access point maintains a list of backup controllers and periodically sends primary discovery requests to each entry on the list.
You can configure a primary discovery request timer to specify the amount of time that a controller has to respond to the discovery request of the access point before the access point assumes that the controller cannot be joined and waits for a discovery response from the next controller in the list.
You can also configure the failover priority on the APs, which allows you to control which APs should have precedence in joining the WLC in case there are more join requests than the available AP capacity on the WLCs in case of a failure. To configure this feature, first you must enable it globally; then assign priorities to the individual access points.
For more information about the high-availability configuration, refer to the following documents:
High Availability Enhancements in Wireless LAN Controller Software Release 5.0: www.cisco.com/en/US/products/ps6366/products_tech_note09186a00809a3f5d.shtml
Configuring Failover Priority for Access Points: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_lwap.html#wp1424902
Logging
The lightweight APs are by default configured to send syslog messages to the  IP broadcast address. You can override this setting by selecting a syslog server, which can be configured through the WLC CLI as a global or individual AP setting:
• Configure a syslog server for all the APs on a WLC: config ap syslog host global <syslog_server_IP_address>
• Configure a syslog server for a specific AP: config ap syslog host specific <Cisco_AP> <syslog_server_IP_address>
For more information about logging on the lightweight APs, refer to the following guide:
Wireless LAN Controller Configuration Guide: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_lwap.html#wp1226578
Troubleshoot the Lightweight AP Infrastructure
A unified deployment with WLCs and LAPs is called the split MAC architecture because Layer 2 tasks are split between the WLC and LAP. The LAPs handle only real-time MAC functionality, leaving all the non-real-time MAC functionality to be processed by the WLC. Therefore, we have different devices to troubleshoot.
LAP-level troubleshooting can be done using a console cable to the LAP. However, you can also use remote debugging from the WLC to the LAP and execute the same commands from the WLC console after the LAP has joined the WLC.
LAP Needs to Join WLC
You can retrieve valuable information about what is going wrong when you console or telnet/SSH into the WLC and LAP to run debugs. Each time the LAP reboots, it initiates the WLC discovery sequence and tries to locate the LAP:
• Is the switch configured correctly? Are VLANs allowed? Is Spanning Tree Protocol (STP) not blocking packets?
• Does the LAP have an IP address assigned either statically or through DHCP to communicate with the WLC?
• Can you ping the LAP from the WLC?
• Does the LAP have at least one method to discover at least a single WLC?
The following debug commands on the WLC will help you determine why the LAP does not join the WLC to verify the discovery and join process.
The following limits the debugging to a certain device, where xx is the MAC address of "radio int if the IOS LAP 11XX, 12XX" and "eth int if the LWAPP AP 10XX."
Click here to view code image
debug mac addr [ap-mac-addr in xx:xx:xx:xx:xx:xx]
The following gives you the state machine status:
debug lwapp/capwap event enable
The following gives you the error if LWAPP/CAPWAP fails:
debug lwapp/capwap error enable
The following provides you the SSC key hash for authorizing LAPs to WLC:
debug pm pki enable
If you are running WLC > version 5.2, we have CAPWAP and require one more useful debug command:
debug dtls event enable
After the debug, you stop with
debug disable-all
On the LAP, you should get console output. The LAP first needs to learn the IP address from the management interface of the WLC. To learn the management IP address, you can use over-the-air provisioning, DNS, DHCP, Option 43, or Broadcast, as discussed in Chapter 3, "Configure and Troubleshoot Infrastructure Application Services."
The following LAP debug command can help you to determine DHCP Option 43 details:
debug dhcp detail
After getting the IP address of the access point, the LAP will send CAPWAP discovery to the WLC management interface. The CAPWAP events for the LAP can be troubleshot using the following:
debug capwap client event
At the end, issuing undebug all will turn off the entire LAP debug.
You can verify the LAPs joined to the WLC using following show commands:
show ap summaryshow ap config general [ap name]
The show ap summary command output includes two different uptime values, the AP uptime (time since the last AP reloaded) and the CAPWAP uptime (duration of the current CAPWAP session). Those values are useful for troubleshooting a flapping AP because it allows it to distinguish between an AP reloading versus an AP losing its connectivity to the wireless LAN controller.
For more details, see the following link:
Troubleshoot a Lightweight Access Point Not Joining a Wireless LAN Controller: www.cisco.com/en/US/products/ps6366/products_tech_note09186a00808f8599.shtml
In case of WLC version > 5.2, access points use CAPWAP. For more details, refer to the following link:
Controlling Lightweight Access Points: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_lwap.html
Configure and Troubleshoot AP Groups
In large WLAN deployments, you might want to reduce the number of users connecting on each VLAN or to control what WLANs are advertised by APs based on the AP location. This is achieved by grouping APs into AP groups.
The AP group configuration allows you to override the default WLAN to a dynamic interface, as well as to select what specific WLANs are enabled on each AP that belongs to the group. The WLAN selection allows you to restrict the WLANs advertised on each AP, but it is crucial when more than 16 WLANs are configured on the WLC.
Although the WLC can handle up to 512 WLANs (except the 2100 Series WLCs that support only up to 16 WLANs), up to 16 can be published to each AP. The default AP group will include the WLANs with IDs 1 to 16, but if you need to advertise an SSID with a higher WLAN ID, you have to configure an AP group and include the needed WLANs.
For more details, see the following links:
AP Group VLANs with Wireless LAN Controllers Configuration Example: www.cisco.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a008073c723.shtml
Configuring Access Point Groups: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_wlan.html#wpxref94800
Configure and Troubleshoot WLANs
While configuring the WLAN, the connection between the wireless and wired network gets built by mapping the SSID to a dynamic interface (VLAN). We can configure WLANs in two different ways using the CLI or GUI.
If you are using the CLI, you are forced to disable the WLAN ID before you can make any changes:
config wlan disable <wlan id>
Although you don't need to explicitly disable the WLAN when making changes through the GUI, you will get a pop-up message warning that clients will be disconnected because the WLAN must be temporarily disabled to apply the requested changes.
The GUI (WLANs > Edit) has four different tabs: General, Security, QoS, and Advanced (see Figure 5-1).

Figure 5-1. WLAN Tabs
General Tab
The Status Enabled check box must be selected if you want to enable the SSID. Also, it is here that you do the Layer 2 mapping between the wireless SSID and the dynamic (wired) interface. You can also select a radio policy to specify certain 802.11 a/b/g.
Security Tab
Layer 2 security exists for all the different key management and encryption combinations, as required by the wireless station.
Layer 3 security or web authentication can be done on an internal or external web server. If you use an external web server, you will have to configure a preauthentication access list on the WLC to allow traffic to the external web server, depending on the WLC model.
A AAA server can specify up to three RADIUS servers for fallback, possibly doing authentication and accounting. In addition, you can configure the WLC for local EAP authentication.
QoS Tab
QoS is important if you use a WLAN (SSID) for voice wireless clients to specify how the WLC and LAP treat the class of service/Differentiated Services Code Point (CoS/DSCP) and Call Admission Control (CAC).
Advanced Tab
Allow AAA Override is used in 802.1x authentication, where you can, for example, do a VLAN assignment (the AAA server sends IETF attributes 64/65/81 in the authentication accept).
H-REAP Local Switching is used for a fallback possibility if an access point is running H-REAP mode and the WLC cannot be reached.
Enable Session Timeout is like IETF attribute 27 and would trigger a new 802.1x authentication.
Enable Aironet IE for all the specific information elements. Depending on the wireless station, this Aironet IE might need to be disabled.
The Peer to Peer Blocking feature enables you to control the traffic forwarding between wireless stations by allowing it, dropping it, or fowarding the traffic to an upstream device.
If you have a wireless station doing an intensive probe request, you can block this station's MAC address as long as the Client Exclusion is enabled and the timeout value is greater than zero (the default value is 60 seconds).
To force a wireless station for DHCP, you can configure DHCP Addr. Assignment Required.
To encrypt the 802.11 management frames, you can configure MFP (Management Frame Protection).
Configure and Troubleshoot Hybrid REAP
Hybrid Remote Edge Access Point, or H-REAP (now called FlexConnect), is the feature that allows you to deploy APs across WAN links so that the AP can fall back to standalone mode if the connectivity with the WLC is lost and perform local switching of the client traffic to give direct access to local resources to remote WLAN clients where the tunneling to the central site is not desired.
More information about the FlexConnect/H-REAP feature can be found in the following documents:
H-Reap Design and Deployment Guide: www.cisco.com/en/US/products/ps10315/products_tech_note09186a0080736123.shtml
Configuring Hybrid REAP: www.cisco.com/en/US/partner/docs/wireless/controller/7.0/configuration/guide/c70hreap.html
Hybrid Remote Edge Access Point (H-REAP) Basic Troubleshooting: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_hreap.html
H-REAP Modes of Operation Configuration Example: www.cisco.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a00807cc3b8.shtml
H-REAP Feature Matrix: www.cisco.com/en/US/products/ps6366/products_tech_note09186a0080b3690b.shtml
Local Authentication
You can configure the controller to allow a Hybrid-REAP access point in standalone mode to perform LEAP or EAP-FAST authentication for up to 100 statically configured users. The controller sends the static list of usernames and passwords to each Hybrid-REAP access point when it joins the controller. Each access point in the group authenticates only its own associated clients.
For the H-REAP APs configured for central authentication, you can configure the controller to allow a Hybrid-REAP access point in standalone mode to perform full 802.1X authentication to a backup RADIUS server. As of version 7.0.116.0, the H-REAP APs can perform 802.1X authentication, even in connected mode.
The Local Authentication feature applies to locally switched SSIDs only. When it is not enabled, the authentication and reauthentication of the clients are always managed by the WLC (central authentication).
H-REAP Groups and Local Authentication: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_hreap.html#wp1203876
H-REAP Groups
You can organize FlexConnect or H-REAP APs in groups (H-REAP groups) to facilitate the configuration of similar APs for common settings like the backup RADIUS server. H-REAP groups are required to support fast-secure roaming across H-REAP APs using Cisco Centralized Key Management (CCKM) and Opportunistic Key Caching (OKC).

Note
CCKM roaming between local and H-REAP APs or between H-REAP APs registered on different WLCs (even if they're part of the same H-REAP group) is not supported.

H-Reap Groups: www.cisco.com/en/US/products/ps10315/products_tech_note09186a0080736123.shtml#HREAPGROUPS
Configuring Hybrid-REAP Groups: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_hreap.html#wp1199191
H-REAP Local Switching
The Local Switching feature of the Hybrid-REAP AP mode enables you to switch data packets locally, to allow the access to local resources with no CAPWAP data encapsulation toward the WLC. This feature is enabled on a WLAN basis, which means that the same lightweight AP in H-REAP mode can serve simultaneously locally and centrally switched SSIDs. A typical use case is to have a locally switched data WLAN and a centrally switched guest WLAN.
Although H-REAP APs serving local switching WLANs by default use an access link, having the CAPWAP messaging and client data for all the locally switched SSIDs on the same VLAN (untagged), it's possible to configure the VLAN support to separate the CAPWAP messaging (on the native VLAN) and the traffic for each SSID. In this case, the APs have to be connected to an 802.1Q trunk link.
Address Learning
Even when using H-REAP local switching, the WLC requires by default to learn the IP address of the client. In situations where this is not feasible, you can disable the address learning with the following command:
config wlan h-reap learn-ipaddr wlan_id disable
Configure and Troubleshoot Radio Settings
Although all the radio settings are configured directly on the WLC, some are globally applied to all the LAPs joined to the controller, whereas other settings are configured on an AP basis. In both cases, there are separate configurations for the 802.11b/g/n (2.4-GHz) and 802.11a/n (5-GHz) bands.
The global settings available for both bands are
• Band enabled: This configuration enables you to globally enable or disable the band.
• Data rates: Here, you can select what data rates are enabled for each band. For each data rate, you can select the following options:
• Mandatory: Clients must support this data rate to associate to an access point on the controller.
• Supported: Clients are not required to be able to use this rate to associate. However, the associated clients that support this data rate can communicate with the access point using that rate.
• Disabled: Clients are not allowed to use that data rate.
• Beacon period: This value must be specified in milliseconds.
• DTPC support: This command enables support for DTPC (Dynamic Transmit Power Control).
• Fragmentation threshold: This value must be specified in bytes.
The following global settings are only available for the 802.11b/g/n band:
• Short preamble: Use this flag to enable or disable support for the short preamble. This is enabled by default, and it's recommended to use it as it improves throughput performance. However, it can be disabled in order to improve the interoperability with certain devices that can only work with long preambles.
• 802.11g support: This setting is enabled by default. If you disable it, the 2.4-GHz band is enabled without 802.11g support.
• These settings can be configured from the GUI at Wireless > [802.11a/n | 802.11b/g/n] > Network.
• You can also verify the global band configuration from the CLI: show {802.11a|802.11b}.
Otherwise, LAP-specific settings are as follows:
• Radio admin status: You can enable or disable the radio of a specific LAP. If it's set to enable, the radio is active only if the corresponding band is also globally enabled. If the band is globally enabled, you can override this setting by disabling the local radio by setting the admin status to "disable."
• Antenna type: Here, you can select what antenna is to be used, only for LAPs that allow both internal and external antennas.
• Diversity: This setting is enabled by default. If you don't want to use diversity, you can select here if you are using the right or the left antenna.
• Channel assignment: By default, the LAP is configured to get the channel automatically assigned by Auto-RF (RRM/Dynamic Channel Assignment [DCA]). You can override the RRM channel assignment by statically setting the channel here with the option "custom."
• Transmit power: By default, the LAP is configured to get the transmit power automatically assigned by Auto-RF (RRM/Transmit Power Control [TPC]). You can override the RRM transmit power assignment by statically setting the power here with the option "custom." The transmit power level setting of 1 represents the maximum conducted power setting for the access point. Each subsequent controller power level (such as 2, 3, 4, and so on) represents approximately a 3-dBm reduction in transmit power from the previous power level. The actual supported transmit power and power levels can vary depending on the AP model. Refer to the following "Channels and Maximum Power Settings for Cisco Aironet Lightweight Access Points" document for more details about each specific AP model.
• Antenna gain: The antenna gain setting must reflect the actual installed antenna. The value is expressed in 0.5-dBi units (for example, 2.5 dBi = 5). This value is used for power calculations, so as to not exceed the maximum equivalent isotropically radiated power (EIRP) value defined by the local regulatory domain (configured through the WLC country code), as well as for coverage and location calculations.
• Sniffer IP address: This option is only available if the LAP is in sniffer mode and it defines the IP address of the host running Airopeek that is listening for the traffic captured and forwarded by the LAP.
Configuring 802.11 Bands (global settings): www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_controller_setting.html#wp1920765
Channels and Maximum Power Settings for Cisco Aironet Lightweight Access Points: www.cisco.com/en/US/docs/wireless/access_point/channels/lwapp/reference/guide/lw_chp2.html
ClientLink
The Cisco ClientLink technology uses a transmit beam-forming technique aimed at improving the wireless network performance where a mix of older 802.11a/g and newer 802.11n clients coexist and where the presence of legacy clients would otherwise decrease the overall performance. The ClientLink technology determines the optimum way to send packets to a client, based on the analysis of the signal received from the client. This technology has no requirements on the client side as it's fully implemented on the AP side; hence, it's compatible with any 802.11a/g clients.
For more information, refer to the following documents:
Cisco ClientLink: Optimized Device Performance with 802.11n: www.cisco.com/en/US/prod/collateral/wireless/ps5678/ps10092/white_paper_c11-516389.html
ClientLink Technology: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_mesh.html#wp1851666
CleanAir
The Cisco CleanAir solution brings the Spectrum Intelligence (SI) technology directly into the APs, adding the capability to identify non-802.11 interference sources. Having visibility on the Layer 1 RF spectrum allows you to identify, locate, and optimize the system performance by being able to avoid interference otherwise not detectable with standard Wi-Fi chipsets. A CleanAir-enabled AP can perform the spectrum analysis with no disruption to the client traffic.
The CleanAir solution is based on the following components:
• CleanAir-capable APs (Aironet 3500 Series)
• Cisco Wireless LAN Controller running version 7.0.98.0 or greater
• Cisco Wireless Control System running version 7.0.164.0 or greater
• Cisco Mobility Services Engine running version 7.0 or greater
A non-802.11 interferer signature is first detected by one or more CleanAir-enabled APs that process and forward this information to the wireless LAN controller. The WLC collects and processes this information, which is provided to the Wireless Control System (WCS) and/or the Mobility Services Engine (MSE). The WLC is able to show basic spectrum information through its GUI and CLI. However, the full benefit from this solution comes when both the WCS and MSE are part of the solution.
The WCS provides an advanced GUI, centralized configuration, consolidated information, and reporting capabilities. The MSE adds the capability to locate and keep historical data about the interferers, as well as consolidate interference reports from multiple WLCs.
In addition to this, an AP can be configured in Spectrum Expert (SE) mode. In this case, no wireless clients can associate to it, and the AP is used as a dedicated remote spectrum analyzer, sending data across the network to a receiving workstation running the Cisco Spectrum Expert software.
The communication between those components works as follows:
• CleanAir AP and WLC: Standard CAPWAP (UDP/5246-5247)
• WLC and WCS: Simple Network Managent Protocol (SNMP) (UDP/161-162)
• WLC and MSE: Network Mobility Service Protocol (NMSP) (TCP/16113)
• WCS and MSE: Simple Object Access Protocol (SOAP) (TCP/443)
• SE-Mode CleanAir AP and Spectrum Expert workstation: AP listens on TCP/37540-37550
ED-RRM
Event-Driven RRM (ED-RRM) is a new generation of the Radio Resources Management algorithm that leverages the CleanAir RF visibility to quickly react upon a classified interferer that causes a crisis condition at a specific AP. The crisis condition is defined when the interferer blocks the clear channel assessment (CCA) mechanism, preventing any clients or APs from using the current channel.
When ED-RRM is used, the system reacts very quickly (within 30 seconds) after a non-802.11 interferer is detected and identified on a given channel, with no need to wait for the next Dynamic Channel Assignment (DCA) pass to take action.
Air Quality
Air Quality (AQ) reporting is a metric (expressed in percentage, with 100% representing Good) about the available spectrum and provides information on the quality of the Wi-Fi channels. Each AP reports AQ metrics for each individual radio.
For more information about the CleanAir solution, refer to the following documents:
Cisco CleanAir - Cisco Unified Wireless Network Design Guide: www.cisco.com/en/US/products/ps10315/products_tech_note09186a0080b4bdc1.shtml
Configuring Cisco CleanAir (WLC): www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_cleanair.html
CleanAir Reports (WCS): www.cisco.com/en/US/docs/wireless/wcs/7.0/configuration/guide/7_0reps.html#wp1230387
Monitoring CleanAir Security Alarms (WCS): www.cisco.com/en/US/docs/wireless/wcs/7.0/configuration/guide/7_0event.html#wp1255015
Monitoring CleanAir Air Quality Events (WCS): www.cisco.com/en/US/docs/wireless/wcs/7.0/configuration/guide/7_0event.html#wp1255232
Troubleshoot RF on Cisco Unified Wireless Solution
From wireless LAN controllers, you can obtain the most useful information about the RF environment by looking at the neighbor list of your access points through this command:
show ap auto-rf {802.11a | 802.11b} {AP name}
This will allow you to monitor the signal strength with which access points are hearing each other so that you can identify potential adjacent channel and cochannel interferences.
The following is one more helpful command, with which you could highlight Ready to Send/Clear to Send (RTS/CTS) counters, retransmissions, and Frame Check Sequence (FCS) errors:
show ap stats {AP name}
The next step might be to further investigate these issues with a protocol analyzer and eventually with a spectrum analyzer.
Configure and Troubleshoot Radio Resource Management
A dynamic media, such as the RF used for WLAN transmissions, combined with complex deployments with multiple cells and a limited number of nonoverlapping channels, requires a constant fine-tuning of the RF configuration to adapt to the changing conditions of the media, caused, for example, by interference, noise, and load.
The Radio Resource Management (RRM) or Auto-RF is a set of complex algorithms embedded in the Cisco Unified Wireless Solution that allows continuous analysis of the RF conditions to automatically adjust the channel and transmit power settings on the managed lightweight APs, aimed to deliver the best performance in terms of throughput and capacity by reducing cochannel interference, avoiding noise sources, and correcting coverage holes.
Multiple WLCs whose APs can hear each other are grouped together to have consolidated RF calculations. This is achieved by configuring on all the controllers the same RF group name, that is, an ASCII string used by the APs to identify other neighbor APs belonging to the same group. The APs send periodic neighbor messages, including information about themselves and the address of the WLC they are connected to and including a hash value calculated with the RF group name value. This information is sent every 60 seconds, at the lowest data rate and at the highest power level, on all the configured channels.
After an AP receives a neighbor message, it first authenticates this message based on the RF group name-based hash. If the message is sent by an AP that is part of the same RF group, it forwards this information back to the WLC it's joined to. Thanks to this method, all the WLCs that are part of the same RF group learn the other member controllers' addresses. If the received neighbor message is undecipherable (because of the use of different RF group names), the sender AP is classified as a rogue AP.
In an RF group comprised of multiple controllers, the RF calculations are performed by only a single WLC, elected as the RF group leader.

Note
Although both the RF groups and the mobility groups are identified by ASCII strings, those are very different features and concepts.

The exchange of neighbor messages among the APs allows the RF group leader to further group the APs in RF subgroups, comprised of APs that can actually hear each other. Separate RRM calculations are performed for each RF subgroup and for each radio type. Each WLC in an RF group locally stores the APs RF measurements. The group leader polls the member controllers every 10 minutes to collect this information.
The RRM functionality is mainly built around the following concepts:
• DCA (Dynamic Channel Assignment): Used to determine the optimal AP channel based on parameters such as
• Load: Percentage of time spent transmitting 802.11 frames
• Noise: Measurement of non-802.11 signals on every serviced channel
• Interference: Percentage of radio time used by neighbor 802.11 transmissions
• Signal strength: Received signal strength indication (RSSI) measurement of the received neighbor messages
The DCA calculations will result in an actual modified channel assignment if the new schema can deliver significant performance improvements.

Note
At first boot, the APs transmit on the first nonoverlapping channel of each band, which means channel 1 for 802.11b/g and channel 36 for 802.11a. The following channel configurations are stored locally and are retained upon following reboots.

• TPC (Transmit Power Control): This algorithm is responsible for reducing the power level on the APs to reduce excessive cell overlap and cochannel interference. Any increase of transmission power is determined by the Coverage Hole Detection algorithm. TPC uses the RSSI calculations for the neighbor APs, and it determines effective changes only if there are more than three neighbor APs.
The final purpose of the algorithm is to make sure that the third-loudest neighbor AP is heard at a signal level lower than the configured threshold (-70 dBm by default).
• Coverage hole detection: The algorithm runs independently on each WLC as it's based on client statistics, and it's responsible for increasing the transmit power of an AP where the coverage hole conditions are detected.
• A coverage hole is detected when the signal-to-noise ratio (SNR) for the clients associated to a specific AP drops below a configured SNR threshold.

Note
Any channel change results in a radio reset that disconnects any associated clients. To limit the impact of this, it's advisable to set the DCA interval and anchor time accordingly. These parameters are configured on the CLI as follows:
config advanced [802.11b | 802.11a] channel dca interval <value in hours>
config advanced [802.11b | 802.11a] channel dca anchortime <value - hour of the day>

For more details about the RRM protocol, see the following link:
Radio Resource Management Under Unified Wireless Networks: www.cisco.com/en/US/tech/tk722/tk809/technologies_tech_note09186a008072c759.shtml
Configure and Troubleshoot Security Settings
Implement Layer 2 Security Policies
Layer 2 security configuration is done per WLAN on the Security tab. Although at first it looks quite simple, it is crucial to understand the different concepts behind it to successfully deploy security in the network. Refer to Chapter 1, "Planning and Designing 802.11 Wireless Technologies," for more details.

Note
At first boot, the APs transmit at maximum power. The following power configurations are stored locally and are retained upon following reboots.

Selecting the Layer 2 Security
The unified wireless infrastructure groups Layer 2 security configurations into the following configuring templates sets, as shown in Table 5-3. This is the first selection that needs to be made on the WLAN configuration Layer 2 Security tab.
Table 5-3. Layer 2 Security Configuration Template

WPA + WPA2 Layer 2 Security
Given the feature set of the WPA + WPA2 Layer 2 security configuration template, it is a given that this template is the most used; other templates are used only for backward compatibility. The following section lists the configuration combinations of the WPA + WPA2 Layer 2 security configuration template and the actual features and concepts that are enabled based on that configuration.
Table 5-4. WPA + WPA2 Layer 2 Security Configuration Template


Implement AAA
Implement a Centralized AAA Server
WLC supports the RADIUS and TACACS+ protocols. The AAA servers need to be configured on the Security tab as shown on Figure 5-2: Security > AAA > RADIUS/TACACS+ > Authentication/Accounting.

Figure 5-2. Security AAA Servers
You can have multiple AAA servers configured.
After selecting RADIUS > Authentication, you can use the RADIUS server for network user and/or management authentication. If you select Network User, this means that all the wireless STAs associate to certain SSIDs, unless the WLAN configuration requires authentication. If you select Management, this means that all the administrators logging in to the WLC will be authenticated.
Upon selecting TACACS+ > Authentication, you have management authentication but no network user authentication.
Implement AAA Server per WLAN
WLC allows you to have specified per WLAN which AAA server to use in case multiple global AAA servers are defined, as shown on Figure 5-3:
WLAN > [WLAN ID] > Security > AAA Servers

Figure 5-3. AAA Servers per WLAN
Implement Local EAP Authentication
Local EAP is an authentication method that allows wireless stations to be authenticated locally. It is designed as a fallback solution in case the backend system becomes disrupted or the external authentication server goes down. If any RADIUS server is configured on the WLC, the WLC tries to authenticate the wireless station using the RADIUS server first. Local EAP is attempted only if no RADIUS server is found, either because the RADIUS server timed out or because no RADIUS server has been configured.
To verify certificates on the WLC, use the CLI: show local-auth certificates.
When you use Local EAP with authentication methods based on a username and password, you can store the user credentials on the local user database on the WLC. From the GUI, choose Security > Local Net Users > New; enter the username, password, guest user, WLAN ID, and description; and click Apply.
From the CLI, you can use the config netuser add <username> <password> <WLAN id> <description> command. You also will have to specify the priority order.
From the GUI, choose Security > Local EAP > Authentication Priority. Then select LDAP, click the < button and click Apply. This puts the user credentials in the local database first.

Note
A Self-Signed Certificate (SSC) on the WLC cannot be used for EAP-TLS (Extensible Authentication Protocol - Transport Layer Security) on the local EAP feature. The SSC can be used for PEAP (Protected Extensible Authentication Protocol) on the local EAP feature. Hence, for EAP-TLS, you will have to upload a valid root and identity certificate in PEM format to the WLC. Openssl would be able to convert the certificate into a different format. You will have to reboot the WLC to use the new certificates.

From the CLI, select (Cisco Controller) > config local-auth user-credentials local.
You could also have an external database with Lightweight Directory Access Protocol (LDAP) as the backend database. This is supported with EAP methods such as EAP-TLS, EAP-FAST, and PEAP using EAP-GTC (Extensible Authentication Protocol - Generic Token Card) as the inner method. LEAP, EAP-FAST, and PEAP using MSCHAPv2 (Microsoft Challenge-Handshake Authentication Protocol version 2) as the inner method can be used only if the LDAP backend is set up to return a clear-text password.
Peer-to-Peer Blocking
The peer-to-peer (P2P) feature on the WLC enables you to control the traffic from wireless client to wireless client on the same VLAN by bridging, dropping, or forcing the traffic to be forwarded through the upstream VLAN. If you choose to forward the traffic to the upstream VLAN, the decision about the packets will be made by the device above the controller. Although you might want to enable the P2P blocking feature in an environment where you need to have full control over the traffic exchanged between the wireless clients, even on the same VLAN, this feature should be avoided on a Voice over WLAN (VoWLAN) deployment because it will prevent two wireless phones from being able to call each other.
The P2P blocking doesn't apply to multicast traffic, and it can't be used on locally switched H-REAP WLANs or on H-REAP APs in standalone mode.
The P2P blocking is a setting that is applied on a WLAN basis and can be configured both through the GUI and the CLI as follows:
• From the GUI:
• Click WLANs, and then click the profile name of the desired WLAN.
• Click the Advanced tab.
• Choose an option from the P2P Blocking drop-down box: Disabled, Drop, or Forward-UpStream.
• From the CLI: Type config wlan peer-blocking {disable | drop | forward-upstream} wlan_id
You can find further information about the specific configuration steps at the following link:
Cisco Wireless LAN Controller Configuration Guide: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_wlan.html#wp1209597
Implement Layer 3 Security Policies
In addition to the previously discussed Layer 2 security policies, the WLC allows configuring Layer 3 policy on a WLAN basis. Although the Layer 3 policies can be applied on top of Layer 2 security on the same WLAN, restrictions apply and are described in more details in the following sections.
The supported L3 policies are
• VPN Pass-through
• Web Authentication
VPN Pass-through
The security policy of a WLAN can be configured to restrict access to a Virtual Private Network (VPN) gateway. In this way, you can force the wireless clients to establish a VPN tunnel to the designated gateway to get access to the network resources. The configuration of the VPN Pass-through is similar to an access control list (ACL) applied to the WLAN.
You can configure the VPN Pass-through as follows:
• From the GUI:
• Click WLANs, and then click the profile name of the desired WLAN.
• Select the Security and Layer 3 tabs.
• Choose VPN Pass-through from the Layer 3 Security drop-down menu.
• Specify the IP address of the VPN gateway in the VPN Gateway address field.
• From the CLI: Use the following command to enable or disable the VPN Pass-through on a specific WLAN: config wlan security passthru {enable | disable} wlan-id gateway
Web Authentication
The Web Authentication feature on the WLC allows the users to get authenticated through a web browser on the wireless client. This is especially useful to manage access for guest users, where it's necessary to have the most basic configuration on the client side. Despite the ease of configuration on the client side, the web authentication doesn't provide any encryption for the data traffic. Given this, if you configure web authentication as the only security policy on a WLAN, you will get no traffic encryption. To overcome this limitation, you can enable the following L2 security policies together with web authentication:
• Open Authentication + WEP
• WPA-PSK
Web authentication is not supported for use together with a 802.1x security policy.
Depending on the specific scenario, you need to use web authentication and you can select the actual login page to be used by choosing among the following types:
• Internal: The page is hosted directly on the WLC and it's a predefined page.
• Customized: The page is hosted directly on the WLC but the actual page is customized, starting from a template that can be downloaded from the Cisco Wireless Control System (WCS) GUI and then uploaded to the WLC.
• External: The page is hosted on an external web server. On the 2100 Series WLC, make sure that you configure a preauthentication ACL that allows the client to contact this server address.
The web authentication type is part of the WLC global configuration and can be selected as follows:
• From the GUI:
• Choose Security > Web Auth > Web Login Page.
• Select the preferred option from the Web Authentication Type drop-down menu.
• From the CLI: Type config custom-web webauth-type {internal | customized | external}
When using the External Web Auth type, you can configure the server URL as follows:
• From the GUI:
• Choose Security > Web Auth > Web Login Page.
• Enter the login page address in the External Webauth URL field.
• From the CLI: Type config custom-web ext-webauth-url <URL>
Refer to the following configuration guide for more information:
Wireless LAN controller configuration guide - Managing User Accounts - Web Authentication Process: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_user_accts.html#wp1120909
The same settings as described previously can be overridden on a WLAN basis, as described in the following configuration guide:
Wireless LAN controller configuration guide - Configuring WLANs - Web Authentication Process: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_wlan.html#wp1126583
How Web Redirection Works
Web authentication is a Layer 3 security method; hence, it takes place after the Layer 2 authentication and association have completed. In the first place, the client gets an IP address, and it's assigned the WEBAUTH_REQD policy manager state.
While the client is in the WEBAUTH_REQD state, all traffic except DNS and DHCP will be denied, unless you configure a preauthentication ACL, where you specify what additional network resources will be allowed access to before the authentication phase is complete. For more details about the access control list (ACL), refer to the "ACL Interface CPU/WLAN" section, later in this chapter.

Note
The policy manager state for a client can be verified anytime through the GUI with Monitor > Clients > <client_MAC> or through the CLI with the show client detail <MAC> command.

To load the authentication page, the user should simply point the browser to any HTTP URL that can be resolved through DNS. It's crucial for DNS to work properly in this phase; otherwise, the client will not be able to send an HTTP request to the IP address of the selected web server. The WLC then intercepts the HTTP request sent by the client, and it sends a reply containing a web redirection directive to the login page by spoofing the IP address of the web server. The controller supports the web redirection only to HTTP servers and not HTTPS.
The specific URL included in the redirection directive depends on the web authentication type in use. If you're using internal web authentication, the client is redirected to the HTTPS web server running on the WLC, listening on the WLC virtual interface IP address. The URL looks like this: https://<Virtual_IP>/login.html?redirect=<URL>
The redirect variable contains the URL originally typed by the user to trigger the web redirection, and it's used to redirect the browser to the originally requested page after the authentication is complete.
The standard SSL certificate installed on the controller is a self-signed certificate issued to the virtual interface IP address. This configuration is likely to lead to a security alert on the browser upon redirection, as the SSL certificate won't be trusted by the clients. To resolve this problem, you can install a certificate authority (CA) signed certificate, issued by a CA trusted by the clients.
Most of the public CAs do not allow issuing a certificate to an IP address. If this is the case for your CA and you need to specify a fully qualified domain name, this host name must also be configured under the virtual interface configuration on the WLC:
• From the GUI:
• Choose Interfaces > Edit for the virtual interface.
• Specify the host name in the DNS Host Name field.
• From the CLI: Type config interface hostname virtual <DNS Host Name>

Note
You need to reboot the controller for the changes to the virtual interface to take effect. Make sure to save the configuration before doing so.

The previous configuration to the virtual interface modifies the URL that the client browser is redirected to:
Click here to view code image
https://<Virtual_IP_DNS_Name>/login.html?redirect=<URL>
With this configuration, for the redirection to work correctly without triggering a security alert on the client, you need to verify that the following conditions are met:
• The virtual interface DNS host name has to be successfully resolved by the clients to the virtual interface IP address of the controller; if the name cannot be resolved, the redirect will fail.
• The DNS host name specified in the virtual interface configuration has to match the SSL certificate common name (CN). A mismatch here will the cause the client to trigger a security alert  as the web server name would not match the entity that the SSL cert is issued to.
• The certificate authority that issued the WLC web-auth certificate must be trusted by the clients; otherwise, a security alert will be triggered (the entity that signed the web server certificate is not trusted).
For more information about the CA-signed SSL certificate configuration for the WLC web authentication, refer to the following link:
Generate CSR for Third-Party Certificates and Download Unchained Certificates to the WLC: www.cisco.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a00806e367a.shtml
If you're using external web authentication, the client is first redirected to the internal WLC login page HTTPS and then to the URL specified in either the global or WLAN configuration. The final URL will include specific information about the client session, such as
• The WLC internal login page URL
• The AP MAC address
• The WLAN name
• The URL initially specified by the user

Tip
When testing web authentication in a lab environment where the test client is concurrently connected to the wireless and wired network, it's advisable to add a static route to make sure that the traffic directed to the WLC virtual IP address is correctly routed through the client wireless interface. This can be achieved in the Windows operating system through the following CLI command: route -p ADD <WLC Virtual IP> MASK 255.255.255.255 <Web auth WLAN GW>.

Web Redirection Configuration with an HTTP Proxy Server
The web authentication method can also be used in case the clients are configured to use an HTTP proxy server. In this scenario, you need to make sure that the following conditions are met:
• The client has direct access through the WLC virtual IP address, not through the proxy server. You can achieve this with manual configuration on the client or by adding the virtual IP address to the exclusion list on the automatic proxy configuration; for example, Web Proxy Autodiscovery Protocol (WPAD).
• If you are using automatic proxy configuration, the client should be able to download the proxy config file before the authentication takes place, and this is done through a preauthentication ACL.
• The proxy server is not configured to use port 53.
• The controller listens for HTTP traffic on the port of the proxy server. You can achieve this with the following CLI command: config network web-auth-port <port>.
User Credentials Configuration for Web Authentication
After the user is presented with the login page, he must enter valid credentials to get access to the network. The user accounts can be configured directly on the WLC internal database, or they can be authenticated through an external RADIUS server. You can specify which order the WLC will follow to look for a valid account matching the information provided by the user, defining the priority between the Local DB, RADIUS, and LDAP on the Security\AAA Servers configuration tab of the WLAN configuration.

Note
You need to reboot the controller for the changes to the virtual interface to take effect. Make sure to save the configuration before doing so.

With regard to the RADIUS servers, the WLC will follow the following order:
1. WLAN-configured RADIUS server(s) (AAA Servers tab).
2. Globally configured RADIUS server(s), where the network user option is checked.
The WLC can authenticate web users to a RADIUS server using either Password Authentication Protocol (PAP), Challenge-Handshake Authentication Protocol (CHAP), or Message Digest 5 (MD5-CHAP). This configuration is performed on the global controller configuration:
• Through the GUI, choose Controller > General and select the authentication method from the Web Radius Authentication drop-down menu.
• Through the CLI, type config custom-web radiusauth {pap | chap | md5chap}
For more information about managing user accounts on the internal controller database, see the section "Configure and Troubleshoot Wired and Wireless Guest Access," later in this chapter.
The steps on how to configure the external AAA server can also be found in the section "Implement AAA," earlier in this chapter.
Web Pass-through
The web pass-through Layer 3 policy is similar to the web authentication method that has just been described. Even in this case, the user will be redirected to a web page before granting access to the network; however, there will be no real authentication taking place. This method is used to present the user with a page where you can include any useful information, for example, the usage policy or who to contact for assistance, before the user is allowed to access the network.
The web pass-through is configured on the Security > Layer 3 tab of the WLAN configuration, or through the CLI with the following command:
Click here to view code image
config wlan security web-passthrough enable <WLAN ID>
Even if there's no authentication taking place, you can request the user to type his e-mail address. This is configured by selecting the Email Input option on the Security > Layer 3 tab of the WLAN configuration or through the CLI with the following command:
Click here to view code image
config wlan security web-passthrough email-input enable <WLAN ID>
Conditional Web Redirect
This Layer 3 policy is used with an 802.1x Layer 2 policy and allows the user to be redirected to a web page upon successful 802.1x authentication. The conditions for when the redirect happens must be defined on the RADIUS server. When those conditions are matched, the RADIUS server must return the Cisco AV-pair "url-redirect," specifying the URL that the user will be redirected to upon opening a browser.
The RADIUS server can also include the Cisco AV-pair "url-redirect-acl"; in this case, the ACL is used as a preauthentication ACL for this client.
For the client to get full network access, it must first address the reasons why it matched the conditional web redirect and then reauthenticate. It will get full network access upon authentication when the RADIUS server doesn't return a "url-redirect" Cisco AV-pair.
For more information about the conditional web redirect, see the following link:
WLC Configuration Guide: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_wlan.html#wp1518251
Wireless Protection System (WPS)
Wireless protection comes in the form of different policies that can be enabled for trusted and rogue access points, as well as for wireless clients:
• Trusted AP policies: The enforced AP policies (encryption, preamble, and radio type) are used to validate that wireless LAN (WLAN) networks served by APs are configured with specific settings.
Also, alarms can be generated when a rogue service set identifier (SSID) matches a trusted one or, as the option itself says, when a trusted AP goes missing.
• Rogue policies: These are self-explanatory from the WLC graphical interface (refer to the next section for the Rogue Discovery Location Protocol).
• Standard and custom signatures: You can register controllers with intrusion detection system (IDS) sensors so that these sensors can instruct the controller to shun clients that violate certain conditions and that are seen as attackers. Suspicious clients are detected through the triggering of IDS signatures, some of which are already preconfigured on the controllers in the Standard Signatures list of the Wireless Protection Policies menu.
IDS sensors can be added to the WLC and tracked under the CIDS options of the Advanced menu on the Security configuration page.

Note
A shunned client entry is distributed across all the controllers in the same mobility group as the detecting WLC.

• Client exclusion policies: These are also self-explanatory, but particular attention should be paid to the recurrence of the corresponding events before a client is added to the exclusion list.
In this regard, all the specifications about when a client is added to the exclusion list based on the corresponding violation are listed in Chapter 6, "Configuring Security Solutions," in the following guide:
Cisco Wireless LAN Controller Configuration Guide: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_security_sol.html#wp1267788
• AP authentication policy: This setting concerns the option to enable either Management Frame Protection (MFP) or rogue AP reporting when access points receive RRM neighbor packets with a different RF network name from the one configured on the WLC (AP authentication must be selected as the authentication type).
• Management Frame Protection: For this feature, see the section "Management Frame Protection," later in this chapter.
Rogue Location Discovery Protocol (RLDP)
A rogue device is an unknown device that is not part of your infrastructure. As such, a rogue access point (AP) is an AP that is not registered to your controller(s). When a rogue AP is detected by a registered AP, you might also want to determine whether such rogue AP can reach your infrastructure over the wired network. This could in fact mean that the rogue AP could also allow rogue wireless clients to reach your wired infrastructure.
The Rogue Location Discovery Protocol (RLDP) is used for active detection of rogue APs on the wired network, and it is run by APs configured in local mode only. For passive detection, see the "Security Management" section of Chapter 6, "Configure and Troubleshoot WCS."
When an AP is marked as rogue, RLDP instructs a detecting AP configured in local mode to try to associate to the rogue AP, obtain an IP address, and send a user datagram protocol (UDP) packet on port 6352 to the controller's management IP. This UDP packet contains data on both the local AP and the rogue APs. If such an operation succeeds, the rogue AP is classified as detected on the network. Even if RLDP eventually fails with secure rogue wireless networks, the main advantage of this mechanism is that it allows you to discover rogue APs on the wired network, even across Layer 3 boundaries.
All the practical details on RLDP configuration can be found in Chapter 6, "Configuring Security Solutions," in the following guide:
Cisco Wireless LAN Controller Configuration Guide: www.cisco.com/en/US/docs/wireless/controller/7.0/configuration/guide/c70sol.html#wp1698835
ACL Interface CPU/WLAN
An access control list (ACL) on a WLC is a set of rules that restrict traffic on certain wired and/or wireless interfaces. We can define up to 64 ACLs, each with up to 64 different rules (or filters). Every access list entry is based on a sequence number between 1 and 64 to determine the order of this rule in relation to any other rules defined for this access list. ACLs on the WLC are done in software and therefore impact the throughput performance.

Note
The WLC applies ACLs in both directions, inbound and outbound. Inbound means packets coming into the WLC, and outbound means packets exiting the WLC.

The configuration of ACLs involves two steps:
Step 1. Configure rules for the ACL. You can configure an ACL through the CLI or GUI: Security > Access Control List > Access Control Lists > New.
Step 2. Apply the ACL name on the WLC to a dynamic interface or WLAN or CPU. To apply the access list to a certain wired dynamic interface, you must configure the access list name on the dynamic interface.
From the GUI, choose Controller > Interfaces > Access Control List > Select ACL name > Apply.
To apply the access list to a certain wireless interface, you must configure the access list name on the WLAN.
From the GUI, choose WLANs > Edit > Advanced > Override Interface ACL > Apply.
To apply the access list to the CPU, you must configure the access list name on the CPU's access control lists. ACL to CPU means traffic to the management/ap-management interface of the WLC.
From the GUI, choose Security > CPU Access Control Lists > Enable CPU ACL > ACL Name > CPU ACL Mode > Apply.
Management Frame Protection
Management Frame Protection (MFP) is a method used to increase the security of the 802.11 management frames that are otherwise unencrypted. By adding protection to the 802.11 management frames, the impact of the common attacks causing denial of service is reduced to just a performance degradation.
The WLC supports two different kinds of MFP:
• Infrastructure MFP: This MFP protects the Class 1 and 2 management frames originated by the access points. It adds Message Integrity Check Information Elements (MIC-IE) to the management frames that are then validated by other APs in the network.
Any attempt to spoof the management frames sent by the AP will invalidate the MIC IEs, hence triggering an alert on the APs receiving this altered frame.
Although Infrastructure MFP cannot stop an attack, you can use it to promptly detect an attempt for intrusion, and this doesn't require specific features to be supported on the client side.
The LAP can perform Infrastructure MFP validation when in local and monitor modes. H-REAP mode is also supported, but only when the AP is connected to the WLC.
• Client MFP: This MFP reduces the impact of the Class 1, 2, and 3 802.11 management-driven attacks, such as deauthentication floods, by means of encrypting the management frames exchanged between the APs and Cisco Compatible Extensions version 5 (CCXv5)-compliant clients.
As the Client MFP operates in regard to the Class 3 management frames, this applies to the traffic exchanged between an AP and a client that is already associated and authenticated.
Specifically, the following types of unicast management frames are encrypted when using Client MFP: disassociation, deauthentication, and 802.11e actions.
With Client MFP, the encryption method used to protect the management frames is the same as used for the client session data frames.
Client MFP is only supported by CCXv5 clients using WPA2 key management with either TKIP or AES-CCMP.
The LAP supports Client MFP in local, H-REAP, and bridge modes.
The two MFP implementations are not redundant, and you can in fact use them together because although Client MFP provides enhanced security for the compatible clients after they are already associated and authenticated, Infrastructure MFP will still report invalid management traffic sent to clients that are not Client MFP compliant, as well as the Class 1 and 2 management traffic.
MFP Configuration
To benefit from MFP, you must first enable MFP support on the global WLC configuration:
• From the GUI: Choose Security > Wireless Protection Policies > AP Authentication. Select Management Frame Protection from the Protection Type drop-down menu.
• From the CLI: Type config wps mfp infrastructure {enable | disable}
After MFP is globally enabled on the WLC config, you can enable Infrastructure MFP on a WLAN or AP basis:
• From the GUI:
• Click WLANs, and then click the profile name of the desired WLAN.
• Click the Advanced tab.
• Infrastructure MFP protection is enabled by default on the WLAN configuration. You can disable it by deselecting its check box.
• From the CLI:
• Use the following command for Infrastructure MFP: config wlan mfp infrastructure protection {enable | disable} wlan_id
• Use the following command to control the Infrastructure MFP validation on an AP: config ap mfp infrastructure validation {enable | disable} Cisco_AP
You can control the Client MFP settings on a WLAN basis as follows:
• From the GUI:
• Click WLANs, and then click the profile name of the desired WLAN.
• Click the Advanced tab.
• The Client MFP drop-down menu allows you to choose among the following options: Disabled, Optional, or Required.
• The Client MFP is enabled by default on the WPA2 WLANs, and the default value is Optional.
• From the CLI: Type config wlan mfp client {enable | disable} wlan_id [required]

Note
If you select Required for Client MFP, only the CCXv5 clients configured for WPA2 will be allowed to associate to this WLAN.

To verify the status of the MFP configuration, use the following CLI commands:
show wps summary
This command shows the summary of the current WPS configuration on the WLC that also includes the global MFP status.
show wps mfp summary
With this command, you get a detailed MFP status, including the global and WLAN settings.
show wlan wlan_id
This command shows a specific WLAN configuration, including the MFP settings.
You can find further information about the specific configuration steps at the following link:
Cisco Wireless LAN Controller Configuration Guide: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_security_sol.html#wp1071665
Configure and Troubleshoot Mobility
The concept of mobility with respect to the WLC is a way to have a group of controllers sharing information about the end clients. This allows seamless roaming across APs joined to different controllers. In some way, it's like having a group of controllers acting as a single WLC.
When a client associates to an AP, the controller adds information about this client in its client database. The entry for any given client includes, among others, details such as the client MAC and IP addresses, the security context, the QoS context, the WLAN, and the AP the client is associated to. The client can seamlessly roam to an AP managed by the same controller, as the WLC updates the traffic flow and the client database entry as soon as the roaming process is complete, to reflect the fact that the client is now associated to a new AP. The roaming among APs joined to the same controller is called intracontroller roaming.
On the other hand, when the roaming happens between two APs joined to different controllers, the seamless roaming event can only occur if the two WLCs can share information about the client.
Intercontroller mobility communication is achieved through a mesh of tunnels; each WLC will establish a control and data tunnel with all the other member controllers. The control tunnel is established over port UDP/16666 (or UDP/16667 for mobility control encrypted traffic), whereas the data tunnel uses IP protocol 97 (Ethernet over IP, or EoIP). The mobility group is identified by a mobility group name that has to be consistent across the mobility group members.

Note
The concept of mobility is often confused with the feature used for the WLCs to share information about the RF environment (RF group). The mobility and the RF group are very different with respect to the concept, purpose, and way of operation; thus they are two distinct features. For more information about Radio Resource Management and the RF groups, see the section "Configure and Troubleshoot Radio Resource Management" earlier in this chapter.

Layer 2 Versus Layer 3 Roaming Scenarios
When a client roams to an AP joined to a WLC that is part of the same mobility group, the client association entry is moved to the new controller, and the new traffic path will go through the new WLC. This happens if the WLAN configuration is identical across the involved controllers, including the VLAN assigned to a specific interface; this scenario is called Layer 2 intercontroller roaming, or simply intercontroller roaming.
If the WLAN configuration is consistent across the controllers but the VLAN assigned to the corresponding interfaces on the member WLCs are different, the clients' seamless roaming is still possible, but there are additional considerations to be made in this case, which is called Layer 3 intercontroller roaming, or intersubnet roaming.
When Layer 3 roaming event occurs, the client entry is not moved from one controller to the other but is actually copied, having the entry marked as "anchor" on the original controller and as "foreign" on the new controller. This allows the WLC to handle the traffic forwarding across the different subnets. The traffic toward the client keeps on arriving at the anchor controller that will tunnel it through the data tunnel (EoIP) to the foreign controller. The traffic originated by the wireless client can either be forwarded directly at the foreign WLC, thus creating an asymmetric traffic path, or it can be tunneled back from the foreign to the anchor controller, thus maintaining a symmetric traffic path.
Configuration Details
The configuration of mobility on a Cisco Wireless LAN Controller can be carried out through the GUI, CLI, or WCS. For mobility to work, make sure that the following prerequisites are met:
• There is IP connectivity among the management interfaces of all the members.
• All the controllers must be running a compatible software version, as indicated in the Inter-Release Controller Mobility (ICRM) documentation.
• The virtual interface IP address is the same across all the member WLCs.
When configuring a mobility group, you need to gather both the IP address and the MAC address of all the controllers. A mobility group can contain up to 24 members.
For more information about the mobility configuration, refer to the following link:
WLC Configuration Guide: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_mobility.html
Multicast Optimization
The standard mobility unicast messaging requires sending a copy of the messages to every mobility member. This behavior is not efficient because many are meant for all members in the group. In controller software release 5.0 or later, the controller can be configured to use multicast to send the mobile announce messages. This behavior allows the controller to send only one copy of the message to the network, which destines it to the multicast group that contains all the mobility members.
Please refer to the following document for more information:
Cisco Wireless LAN Controller Configuration guide - Messaging Among Mobility Groups: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_mobility.html#wp1136694
Mobility Group Scaling
The Wireless LAN Controller on software release 5.1 or later has the following scaling limitations in regard to the mobility group configuration:
• Up to 24 controllers in a single mobility group.
• Up to 72 controllers in a controller's mobility list and seamless roaming across multiple mobility groups.
• The number of supported access points in a mobility group is bound by the number of controllers and controller type.

Note
CCKM and PKC are supported only for intermobility group roaming. When a client crosses a mobility group boundary during a roam, the client is fully authenticated, but the IP address is maintained.

Inter-release Controller Mobility Groups
As of version 4.2 of the Wireless LAN Controller, the strict requirement of having the same version of the software running on all the mobility group members has been relaxed.
The following table specifies the Inter-release Controller Mobility (IRCM) compatibility matrix: www.cisco.com/en/US/docs/wireless/controller/5500/tech_notes/Wireless_Software_Compatibility_Matrix.html#wp80877
Configure and Troubleshoot WLC Redundancy
Without any additional configuration, a lightweight AP will select the controllers to join based on the result of the CAPWAP discovery, and it will select the least-loaded WLC. The AP will also learn the management IP addresses of the controllers on the same mobility group, and it will be able to fall back to one of these WLCs if it loses connectivity to the current controller.
If you need to make the WLC selection process more predictable, you can specify for each AP a primary, secondary, and tertiary WLC. This configuration requires you to specify the controllers using the system names. As of version 4.2, it's possible to also specify an IP address in addition to the system name to allow the APs to join WLCs outside the local mobility group.
Cisco WLC Configuration Guide: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_lwap.html#wp1916411
The AP Fallback feature enables you to have the AP join the primary controller after it comes back online.
Controller Redundancy Configuration Example: www.cisco.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a008064a294.shtml
Configure and Troubleshoot Wired and Wireless Guest Access
Because web authentication was thoroughly explained in the previous sections, in the following sections, you will first learn how to configure wired guest access and then apply both wireless and wired guests with a mobility anchor deployment.
Wired Guest Access
The key principle of wired guest client is to keep a wired client on a guest LAN while switching its traffic through another trusted dynamic interface only after a successful authentication.
To achieve this goal, the following requirements should be met:
• The access VLAN on which the wired client connects must be correctly trunked through Layer 2 to the WLC. This is also the same VLAN assigned to the ingress dynamic interface of the guest LAN.
• The VLAN of the ingress dynamic interface (that is, the access VLAN configured on the wired client switchport) must not be routed anywhere in the network. There must be no Layer 3 switched virtual interface (SVI) for this VLAN.
• The VLAN of the egress dynamic interface is the actual VLAN where the wired guest client will obtain an IP address and on which the wired client's traffic will be switched after a successful web login authentication.
• When you configure wired guest access with a mobility anchor, the ingress dynamic interface on the foreign WLC is the one you need to assign to the access switchport of the wired guest client, while the egress dynamic interface on the anchor WLC is the one out of which the wired client's traffic will flow after a successful web login authentication.
Following this logic, you might want to configure the egress dynamic interface on the foreign WLC and the ingress dynamic interface on the anchor WLC to some bogus networks. In this way, should the Ethernet over IP (EoIP) tunnel fail between foreign and anchor, the wired guest client's traffic will be black-holed at the foreign WLC.
The complete steps for configuring wired guest access, with and without a mobility anchor, can be found at the following link:
Wired Guest Access Using Cisco WLAN Controllers Configuration Example: www.cisco.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a00808ed026.shtml
Wireless Guest Access
Wireless guest access with web authentication is similar to the wired guest access, except for the fact that you do not need to distinguish and configure ingress and egress dynamic interfaces.
The main differences and key concepts can be summarized as follows:
• While with wired guest access there is no concept of Layer 2 (L2) security, with wireless guest access you can enforce L2 security before the L3 web authentication.
• L2 security for a guest WLAN is supported only with passphrase or pre-shared key (PSK) key management methods (that is, static WEP or WPA/WPA2 PSK).
• There are no ingress and egress dynamic interfaces. After successful L2 authentication, the wireless guest client will obtain an IP address through DHCP on the dynamic interface linked to the guest WLAN.
• If you configure a mobility anchor, L2 security is implemented at the foreign WLC. After successful L2 authentication, the client is put in the DHCP_REQD state and all the traffic is tunneled through EoIP to the anchor WLC. Through the anchor WLC, the client will obtain an IP address through DHCP, and it will be authenticated through the web login.
As with wired guest access, you might want to configure the dynamic interface on the foreign WLC to some bogus networks. In this way, should the EoIP tunnel fail between foreign and anchor, the wireless guest client's traffic will be black-holed at the foreign WLC.
You can find all the details for configuring web authentication options at the following link:
Guest WLAN and Internal WLAN Using WLCs Configuration Example: www.cisco.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a008070ba8f.shtml
Guest Access with Mobility Anchor
This section is intended to highlight some further guidelines that are fundamental to implement either wired or wireless guest access. Maybe the most important key concept is the fact that, up to the successful completion of L2 authentication, the guest client's traffic is managed by the foreign WLC. After L2 authentication, as the client is put in the DHCP_REQD state, all the guest client's traffic is tunneled to the anchor WLC through EoIP and managed by the anchor WLC.
In terms of configuration, you should also make sure to verify the following steps:
• Guest LANs/WLANs can differ only for what concerns their index and the dynamic interfaces linked to them. All the other parameters (for example, name, L2/L3 security, QoS, advanced options, and so on) must match both in the foreign WLC's and in the anchor WLC's configuration.
• Coming after L2 authentication and IP address assignment through DHCP, L3 web authentication is performed at the anchor WLC.
As a consequence, the method to verify a guest user's credentials is chosen at the anchor WLC. First the local net users' database is checked and, if no entries are found for the specific username and guest LAN/WLAN, the RADIUS servers are attempted (if none are specified under the guest LAN/WLAN, global ones will be checked). To this last regard, be aware that RADIUS PAP authentication will be used as a default.
• The EoIP tunnel is transported through IP protocol 97. If any firewalls are deployed between the foreign and the anchor WLC, be sure that IP protocol 97 is allowed.
• Two useful commands to test the EoIP connectivity between the foreign and the anchor WLC are eping {foreign/anchor management IP} and mping {foreign/anchor management IP}. The first will verify the data packet communication, and the second will verify the mobility UDP control packet communication.
• When exchanging mobility messages for a guest client and its LAN/WLAN, the foreign WLC will communicate the guest LAN/WLAN settings to the anchor WLC by sending a hash that summarizes these settings. If the hash calculated at the anchor does not match, the anchor WLC will reject the guest client's connection.
• The foreign WLC will have no knowledge of the IP address assigned to the guest client and of its username. Therefore, in the output of the show client detail {client MAC address} command, the client's IP address and username will show as Unknown.
Also, after successful L2 authentication, the client will be placed in the Run state in the foreign WLC.
• The anchor WLC will have no knowledge of the access point (AP) through which the guest client is associated. In the output of the show client detail {client MAC address} command, the AP MAC address will show as Unknown.
Only after successful L3 web authentication will the client be put in the Run state on the anchor WLC as well.
Further details on the configuration and the behavior of guest access with mobility anchors can be found at this link:
Cisco Unified Wireless Guest Access Services of the Enterprise Mobility 4.1 Design Guide: www.cisco.com/en/US/docs/solutions/Enterprise/Mobility/emob41dg/ch10GuAc.html
Configure and Troubleshoot Multicast
With the Cisco Unified Wireless architecture, the forwarding of multicast traffic poses a challenge in regard to how the traffic is distributed from the controller to the lightweight APs.
There are two methods to achieve this:
• Multicast-Multicast: This mode requires the network infrastructure to be configured for multicast on all routers between the controllers and the APs.
In this scenario, each multicast frame received by the controller is encapsulated in CAPWAP and sent to the multicast group configured on the controller for the APs.
The LAP gets the multicast group address during the normal join process. Then the AP issues an Internet Group Management Protocol (IGMP) request to join the controller multicast group.

Note
The source IP address for the multicast group is the controller management interface IP address, not the AP-manager.

• Multicast-Unicast: Although this method can be used where the wired network infrastructure doesn't support multicast, it's inefficient and causes high CPU load on the controller.
In this scenario, the controller copies the multicast traffic to each AP, encapsulating this data over the CAPWAP data tunnel.

Note
2100 Series controllers do not support multicast-unicast mode. They do, however, support multicast-multicast mode, except when access points are connected directly to the local port of a 2100 Series controller.

The multicast mode is configured as follows:
• Through the GUI: Controller > General > Ethernet Multicast Mode
• Through the CLI:
config network multicast global [enable | disable]
config network multicast mode [multicast | unicast] {mcast address}
The selected multicast group must not match another address in use on your network. For example, 224.0.0.251 cannot be used as it's used by mDNS (Multicast DNS). It's also recommended to use an address in the private range (239.0.0.0-239.255.255.255, which does not include 239.0.0.x and 239.128.0.x.).
The controller supports the forwarding of multicast traffic originated from both the wired and wireless side:
• Source is wired: The WLC receives the multicast packet on the client VLANs and forwards it through the management interface. The multicast-enabled network delivers this packet to all the registered APs.
• Source is wireless: The multicast packet is first unicast from the AP servicing the wireless client to the controller, as for a usual data packet.
The WLC receives this packet and makes two copies of it, one sent directly to the client's VLAN on the wired side and one sent to the AP multicast group.

Note
The controller configuration allows enabling broadcast forwarding (config network broadcast enable). This feature uses the same forwarding mode configured for the multicast traffic.

Wireless Multicast Roaming
If a wireless client roams between APs, there can be disruptions to the received multicast stream. With regard to the multicast session, the client will maintain the multicast session upon L2 roaming if the foreign AP is configured on the same multicast group; in this case, the traffic is not tunneled through an anchor controller.
In the case of L3 roaming, the behavior changes depending on what tunneling mode is configured on the WLCs.
In the case of asymmetric mobility tunneling (that is, the default configuration), the client is queried for its multicast group memberships by the foreign WLC and sends out an IGMP group membership report. This is forwarded out the foreign WLC dynamic interface assigned to the VLAN, and the client rejoins the multicast stream through the foreign subnet, which will cause a slight disruption in the multicast session.
If symmetric mobility tunneling is used, both inbound and outbound traffic is tunneled to the anchor controller.
Wireless Multicast On-Air
The multicast traffic is treated in the same way as broadcast traffic when it is transmitted on the air. Given this, there is neither acknowledge nor retransmission of a multicast frame after it has been transmitted by the AP. This means that a common data rate has to suit all the clients serviced by an AP, and a STA might not receive frames successfully. The AP transmits the multicast/broadcast traffic at the highest common mandatory rate of all associated clients. For this reason, it's important to configure the data rates on the RF band considering that too-high rates can prevent the clients from receiving the traffic, but too-low rates might not allow sufficient throughput for the multicast application.
Multicast with Wireless LAN Controllers (WLC) and Lightweight Access Points (LAP) Configuration Example: www.cisco.com/en/US/tech/tk722/tk809/technologies_configuration_example09186a00807cc10d.shtml
Enterprise Mobility 4.1 Design Guide, "Cisco Unified Wireless Multicast Design": www.cisco.com/en/US/docs/solutions/Enterprise/Mobility/emob41dg/ch6_Mcst.html
Configure and Troubleshoot QoS
In the following sections, you learn how to configure the 802.11 QoS parameters in a Unified Wireless deployment. It is crucial to understand the meaning of each parameter and to select values according to design and deployment guide requirements.
Configuring and Validating QoS Parameters
At the beginning of the section "802.11 QoS" in Chapter 1, you learned about the QoS standard history. On the WLC GUI, you will therefore find a couple of non-802.11 naming conventions.
HCF Contention-Based Channel Access (EDCA)
EDCA gets enabled on the WLAN > QoS tab listed as WMM Policy. It offers the following three possibilities:
• WMM disabled: EDCA is turned off.
• WMM allowed: EDCA is turned on but optional for STAs.
• WMM required: EDCA is turned on and also mandatory for STAs. Otherwise, the association request of an STA gets rejected.
All the different EDCA parameters, such as TXOP, AIFSN, CWmin, and CWmax, are predefined in EDCA profiles that can be selected on the radio interface configuration. Figure 5-4 lists the available profiles.

Figure 5-4. EDCA Profiles
EDCA Admission Control
Admission Control Mandatory (ACM) also needs to be enabled under the appropriate radio setting in the Voice Parameters section. Figure 5-5 shows the GUI configuration. In the same section, you can also configure how much bandwidth you would like to allocate for admission control.

Figure 5-5. Enabling EDCA Admission Control Mandatory
Configuring QBSS-Load-Element
The configuration of the quality of service basic service set (QBSS) version advertised is done on the QoS tab of the WLAN settings and is not directly visible from the GUI description:
• To enable a QBSSv1 advertisement, 7920 Client CAC needs to be enabled, as shown in Figure 5-6.

Figure 5-6. Enabling QBSS Version 1
• QBSSv2 is automatically advertised when the WMM Policy (EDCA) is enabled (allowed or required).
• QBSSv3 gets advertised if 7920 AP CAC is enabled, as shown in Figure 5-7.

Figure 5-7. Enabling QBSS Version 3

Note
Even if a QBSS version with CCA support is advertised, it doesn't necessary include the actual channel utilization. This is configured under the appropriate radio setting in the Voice Parameters section. Figure 5-8 shows the GUI configuration and how to enable the channel utilization value advertisement.

Figure 5-8. Enabling Advertisement of Channel Utilization in QBSS

Setting Up Correct WLAN QoS Tagging
In addition to the QoS tagging conversion on the AP (see the section "WLAN QoS Tagging" in Chapter 1), the Unified Wireless infrastructure also needs special attention on the QoS tagging for the CAPWAP traffic between the WLC and the APs.
QoS Tagging Conversion on the APs
The WLC contains four predefined QoS profiles (Bronze, Silver, Gold, and Platinum) that can be selected for a given WLAN using the QoS tab; there is a controller-wide option to change the characteristics of that profile. In that profile, the QoS tagging needs to be configured according to Table 1-3 (QoS Frame Tagging and Packet Marking). The key point is when configuring the QoS profile, you should always think in terms of IEEE 802.11e classifications. The controller then adjusts the class of service (CoS) to be compliant with Cisco QoS baseline recommendations. Figure 5-9 shows the correct configuration for voice traffic.

Figure 5-9. WLC Edit QoS Profile
QoS Frame Tagging and Packet Marking for CAPWAP Traffic
There are a couple of important points to know that QoS tagging is working correctly for CAPWAP traffic:
• Wired frames sent by the AP are not having a Layer 2 tag containing CoS information; hence, the AP will not simply copy 802.11e UP to 802.1p UP.
• The WLC only sets the Layer 2 tag if the interface is in tagged mode.
• The AP sends CAPWAP-Control traffic with DSCP = 46.
• The WLC sends CAPWAP-Control traffic with DSCP = 46 and, if the interface is in tagging mode, with an 802.1p UP = 7
Because on wired side, the actual data packets are encapsulated and transported within CAPWAP-Data packets, the QoS tagging for CAPWAP-Data also needs to be correct. Figures 5-10 and 5-11 show the marking and mapping for upstream and downstream traffic.

Figure 5-10. Unified Wireless QoS Tagging for Upstream (Wireless to Wired) Traffic

Figure 5-11. Unified Wireless QoS Tagging for Downstream (Wired to Wireless) Traffic
Configure and Troubleshoot Mesh
You can deploy wireless access where APs cannot have wired connectivity to the controller by having the APs establish a mesh topology using the 5-GHz radio as the backhaul.
The Cisco Wireless Mesh solution is suitable both for outdoor (1500 Series AP) and indoor (Cisco Aironet 1040, 1130, 1140, 1240, 1250, 1260, and 3500 Series access points) deployments. The mesh APs can be used both to serve wireless clients and to bridge Ethernet traffic. Access points within a mesh network operate as either a root access point (RAP) or a mesh access point (MAP).
RAPs have wired connections to their controller, and MAPs have wireless connections to their controller. MAPs communicate among themselves and back to the RAP using wireless connections over the 802.11a radio backhaul. MAPs use the Cisco Adaptive Wireless Path Protocol (AWPP) to determine the best path through the other mesh access points to the controller.
After a MAP establishes the AWPP backhaul connection, it joins the WLC similarly to a normal lightweight AP. The wireless client traffic for a MAP is encapsulated over CAPWAP and switched at the WLC side.
AP Authorization
You must authorize mesh APs before they can join a mesh network. This is done by adding the MAC address of the mesh AP to the MAC filter. This MAC address to be configured is the BVI MAC address for outdoor mesh APs and the Ethernet MAC address for indoor mesh APs.
It's possible to authorize mesh APs using an external AAA server and EAP authentication. The mesh APs use EAP-FAST authentication using the MIC or LSC certificates. If you use the MIC for EAP authentication, you need to import and trust the Cisco Manufacturing CA chain on the RADIUS server. If you use LSC, you need to import and trust the issuing CA certificate chain on the RADIUS server.
You also need to add to the following users to the RADIUS server in the following format:
• Add the device MAC address to the user list.
• In addition to adding the MAC address to the user list, you need to enter the platform_name_string-Ethernet_MAC_address string to the user list (for example, c1240-001122334455). The password must match the username (for example, c1240-001122334455).
The controller first sends the MAC address as the username. If this first attempt fails, the controller sends the platform_name_string-Ethernet_MAC_address string as the username.
Ethernet Bridging
You can use the mesh APs as wireless bridges to allow connecting any Ethernet device on the MAP using its Ethernet port (for example, a video camera). Unlike the traffic for wireless clients on the MAP (which is terminated on the WLC), the Ethernet traffic terminates on the Ethernet ports of the mesh APs (MAP and RAP, respectively). By default, only untagged traffic is transported, but you can enable VLAN tagging support (trunk mode) across the mesh APs.
The guidelines to configure Ethernet bridging with VLAN tagging are as follows:
• For security reasons, Ethernet bridging is disabled by default on the mesh APs; you need to explicitly enable it on each MAP.
• VLAN mode must be set as nontransparent; this is a global mesh parameter configured on the WLC.
• VLAN tagging is configured only on the Ethernet interfaces; the configuration applies only to interfaces not used as backhaul (secondary port).
• The trunk native VLAN must be VLAN 1 on the RAP trunk, and it can be configured in the range 2-4095 on the MAP side.
• The RAP will use VLAN 1 for CAPWAP communication with the WLC, and it will tag traffic using the VLAN IDs from the registered MAPs.
• The VLANs tagged on the RAP trunk side are automatically configured following a registration process (depending on what is configured on the MAP side).
• Each mesh sector supports tagging for up to 16 VLANs.
• Ethernet bridging with VLAN tagging is effective only when the MAP is in the CAPWAP Run state and the VLAN mode is set to nontransparent.
Serial Backhaul
Regular mesh APs operate with two or three radios, with the backhaul (5-GHz), the client access (2.4-GHz), and the public safety (4.9-GHz) band on selected models (for example, AP1524PS).
Having a single backhaul interface means that all the APs in a given mesh sector share the same channel, causing hidden node interference, and the performance drops proportionally to the number of hops between the MAP and the RAP. You can mitigate this problem by implementing the serial backhaul, which requires using APs with two separate radios for backhaul (for example, AP1524SB), thus separating the uplink and downlink on separate channels.
The mesh APs perform automatic channel assignment. However, you can restrict the selection for serial-backhaul mesh APs to the DCA channels with the following command:
config mesh backhaul dca-channels enable
This option applies only to serial-backhaul mesh APs and not to other APs.
The downlink radio of a specific mesh AP can also be assigned with a custom channel with the following command:
Click here to view code image
config slot <slot number> channel ap <ap-name> <channel number>
• <slot number> refers to the slot of the downlink radio to which the channel is assigned.
• <ap-name> refers to the name of the access point on which the channel is configured.
• <channel number> refers to the channel that is assigned to a slot on the access point.
Bridge Group Name (BGN)
You can segment the mesh network by configuring the bridge group names (BGN). Mesh access points can be placed in similar bridge groups to manage membership or to provide network segmentation. If the preferred parent is in the same BGN, the mesh AP can join it and start operations. If the configured preferred parent is not in the same BGN and no other parent is available, the child joins the parent AP using the default BGN, which allows controlling the mesh AP from the WLC, but it doesn't service clients while in this state.
More information on the Cisco Unified Wireless Mesh solution can be found in the following documents:
Cisco Mesh Access Points, Design and Deployment Guide, Release 7.0: www.cisco.com/en/US/docs/wireless/technology/mesh/7.0/design/guide/MeshAP_70.html
Controlling Mesh Access Points: www.cisco.com/en/US/docs/wireless/controller/7.0MR1/configuration/guide/cg_mesh.html
Troubleshoot the Unified Deployment Model
Lightweight access points also have LEDs that give information about the Ethernet/radio and operation status based on color code. Additional troubleshooting has to be done using the debug and show commands, depending on the problem. Because the unified deployment is a centralized system, most debugging needs to be done on the WLC and only partially on the LAPs.
The show run-config command output from the WLC CLI is a must to have a snapshot of the running configuration and the RF status of the APs registered to a specific WLC at the time the output is collected. This output can be easily analyzed using the WLC Configuration Analyzer (WLCCA) tool that is especially useful when you need to consolidate the show run-config output from multiple WLCs.
The tool can be downloaded from https://supportforums.cisco.com/docs/DOC-1373.
Having trouble downloading a file? Please email wlc-conf-app-dev@cisco.com.
Figures 5-12 and 5-13 illustrate the AP neighbor graphs and the configuration analysis report as seen on the WLCCA graphical user interface.

Figure 5-12. WLC Configuration Analyzer

Figure 5-13. WLC Configuration Analyzer - Report
Troubleshoot Client-to-AP Connectivity
The easiest way to troubleshoot client-to-AP connectivity is to do system troubleshooting based on the OSI layer.
The physical Layer 1 should be okay if the site survey is done correctly and carefully, following deployment guide requirements. Additional APs should have network connectivity and are up and running, as discussed in Chapter 7, "Configure and Troubleshoot WLAN Services." Therefore, we start on Layer 2, which belongs to 802.11 with all six frames to get the 802.11 associations. In addition, we can perform 802.1x authentication. After the encryption keys are derived, the first IP packet on Layer 3 would be a DHCP discovery request from the wireless station (if no static IP address is used). If this works, we know that the network connection is established.
Unified Deployment Model
Wireless Station Needs to Associate to LAP
We are now on to the 802.11 troubleshooting. The following debug command will help you to determine possible problems during association, authentication, key management, and IP address assignment:
Click here to view code image
debug client [mac-addr-client in xx:xx:xx:xx:xx:xx format]
If you have several WLCs running in a mobility group, you need to troubleshoot the roaming behavior use in addition:
debug mobility handoff enable
If you need to debug on the LAP, you can now use the remote debug command from the WLC.
On the WLC, the following enables remote debugging of the AP named X:
debug ap enable X
The following command will execute sh run on the AP, and the output goes to the WLC. (The remote AP debug command enables you to issue any valid IOS commands to the AP and get the output on the WLC CLI.)
debug ap command "sh run" X
At the end, disable the remote debugging with the following command:
debug ap disable X
Wireless Station Needs to Do Authentication
If you are using 802.1x authentication with a AAA server, you will probably use the following two debug commands:
debug aaa event enabledebug aaa packet enable
These commands will enable you to see RADIUS packets between the WLC and the AAA server you have configured per WLAN or global level.
However, if you use local EAP, the following debug commands should be used to help determine the problem. Do not turn all the debugging on; this would overload the debug logger and provide corrupt and missing information.
debug aaa local-auth eap method all enabledebug aaa local-auth eap framework all enable
Wireless Client Needs to Get IP Address and Network Connection
On the WLC, execute the following debug commands:
debug dhcp event enabledebug dhcp error enable
After the wireless station gets the IP address, the client status changes to Run, if no further Layer 3 security is configured. However, if you have web authentication configured, the following debug commands can help you determine the problem:
debug pm ssh-appgw enableddebug pm ssh-tcp enabled
At the end, you can verify that the wireless station is associated correctly to the WLC solution by using following show commands:
Click here to view code image
show client summaryshow client detail [mac-addr-client in xx:xx:xx:xx:xx:xx format]
Further details on client debugging can be found at the following link:
Understanding Debug Client on Wireless LAN Controllers (WLC): www.cisco.com/en/US/products/hw/wireless/ps430/products_tech_note09186a008091b08b.shtml







Chapter 6. Configure and Troubleshoot WCS
The Cisco Wireless Control System (WCS) is sometimes underestimated and classified as a monitoring interface, to manage controllers through the same software. However, WCS is a powerful tool to assign access rights to administrator and lobby ambassador users for managing guest networks, to push at once common configuration settings to a large number of devices, and to classify and control security events in the wireless networks across different campuses. WCS also finds its ultimate usage with the location server and Mobility Services Engine (MSE), to track wireless clients, tags, and rogue access points on floor plans. Last but not least, WCS is one of the keys for the success in the CCIE Wireless lab exam, being one of most efficient ways to save time when configuring multiple controllers at once.
Configure and Troubleshoot Management Access
After the initial setup for the default root user, you can configure additional users and privileges on WCS either through the local database or with user authentication and authorization through TACACS+ or RADIUS against an external authentication, authorization, and accounting (AAA) server.
WCS Internal User Access
Under the Administration and AAA settings of WCS, you have the option to create users stored in the internal database and to assign them to groups, restricting access to specific sets of options and pages.
User groups are predefined, and they cannot be added or deleted. However, the list of specific tasks is customizable for each group. According to which tasks are selected, the user will log in and be able to have access to certain sets of WCS pages.
WCS User Access Through AAA
A more decentralized option to manage user access is the one that takes advantage of user authentication and authorization against AAA servers.
Based on which tasks you configure for each user group, a corresponding set of TACACS+ and RADIUS custom attributes will be available on the WCS Groups page. These attributes can be imported into the AAA server configuration, to be passed back to WCS upon successful user authentication. According to the customized attributes sent by the AAA server to WCS, the user will gain access to specific WCS pages and options.

Note
User authentication through TACACS+ or RADIUS can be implemented either with Password Authentication Protocol (PAP) or with Challenge Handshake Authentication Protocol (CHAP). This should be carefully taken into account when using an external database in the AAA server. The Cisco Secure Access Control Server (ACS), for example, does not support CHAP authentication against Windows Active Directory (AD) and generic Lightweight Directory Access Protocol (LDAP) databases.

WCS Virtual Domains
Cisco WCS virtual domains provide organizations with the flexibility to define the areas of the wireless network that individual IT administrators (users) can manage. These virtual domains can be organized by geographical regions, buildings, campuses, or other customized parameters (for example, controllers, APs, and so on). The domains allow you to maintain tight control of who manages which area of the wireless network infrastructure.
Assigning a Virtual Domain: www.cisco.com/en/US/customer/docs/wireless/wcs/7.0MR1/configuration/guide/manag.html#wp1223986
Configure and Troubleshoot NTP
Network Time Protocol (NTP) is another fundamental protocol used across all the Unified Wireless components (controllers, WCS, and location/MSE) to ensure the correct location of client, tags, and rogue access points on maps. The WCS clock configuration is based on the clock of the operating system hosting the WCS itself.
Further details on the NTP configuration for all the components of the Unified Wireless solution can be found at the following link:
NTP Configuration and Synchronization for Unified Wireless Network Devices: www.cisco.com/en/US/products/ps6366/products_configuration_example09186a0080811274.shtml
Performing Basic Operations
The following sections consider as already acquired all the initial steps to perform the installation of the WCS software and leave the installation procedure up to the steps described in the Getting Started section of the official Cisco Wireless Control System Configuration Guide, available on Cisco.com.
Create and Deploy Templates and Template Groups
WCS allows creating four main types of templates: controller, lightweight access point (LAP), autonomous access point, and migration templates.
The main concept about controller and LAP templates is that you can use them to push any configuration settings that can be common to many controllers or access points at the same time. As an example, the same RADIUS server can be created on more than one controller, and we can push this setting to all our controllers through a single template. On the other side, controllers cannot share interface IP addresses, and for such a reason, you don't have any template to configure interfaces.
Few words should be spent on the autonomous access point templates. These are in fact command-line interface (CLI) templates. You are pushing a set of line commands, so there are no predefined templates for service set identifier (SSID), RADIUS servers, radio settings, and so on. Such commands are pushed by WCS to the autonomous access point through the Simple Network Management Protocol (SNMP) settings specified because the autonomous AP was added to WCS. Because there are no "safety checks" on the commands configured through such templates, you need to pay particular attention in not setting common parameters that could create conflicts, such as, for example, the same bridge virtual interface (BVI) IP address.
Using Templates: www.cisco.com/en/US/customer/docs/wireless/wcs/7.0MR1/configuration/guide/temp.html
Create a Floor Coverage Proposal
When talking about RF coverage, you need to remember that on one side, the WCS heat maps are a prediction of the radio signals. However, on the other side, you can also take advantage of such a predictive tool when creating proposals for coverage.
The map editor is the starting point from where you can create obstacles on floor maps, which will be taken into account for the calculation of heat maps to help build a preliminary site survey.
Two other features allow you to perform a predictive design without the need to deploy physical access points: the Planning Mode and the Location Readiness tool.
Using Planning Mode: www.cisco.com/en/US/customer/docs/wireless/wcs/7.0MR1/configuration/guide/maps.html#wp1179446
Prepare the Building and Floor Map
When preparing maps, the more accurate you are, the closer to the real scenario your predictive design will be. For this simple reason, it is important to accurately maintain the scale of campuses, buildings, and floors.
To achieve an accurate calculation of distances, you can rely on tools such as AutoCAD to design your floor and then import the map into WCS in the AutoCAD-compatible format. Alternatively, you can use the built-in map editor of WCS to measure distances.
Implement Controllers to WCS
All the communications between WCS and the controllers are based on SNMP. This means that configuration settings are polled and pushed by WCS to the WLC through SNMP get and set operations.
As a consequence, when adding the WLC itself, the SNMP settings on the WLC and on the WCS must match. To let WCS poll the information on the CPU utilization of a WLC, you need, for example, to configure a matching v1 and/or v2 SNMP community string between the WLC and WCS.
On the other side, the controllers are also actively notifying the WCS of events through SNMP traps. This is the case, for example, when the interface of an AP goes down.
Adding Controllers: www.cisco.com/en/US/customer/docs/wireless/wcs/7.0MR1/configuration/guide/ctrlcfg.html#wp1095063
The WCS software makes use of several protocols for user access, to communicate with controllers and the MSE, and to perform maintenance operations. The following is a list of the most important protocols used by WCS to integrate its services with the Unified Wireless infrastructure:
• Hypertext Transfer Protocol Secure (HTTPS): This must be allowed to and from the WCS, for the simple reason that without HTTPS, user access to the graphical interface of WCS is not possible.
• File Transfer Protocol (FTP) and Trivial File Transfer Protocol (TFTP): These should also be allowed in case the WCS is used as an FTP/TFTP server for maintenance operations with controllers, such as for configuration backups and code upgrades. The FTP and TFTP services are configured during the initial installation of the WCS software.
• Simple Network Management Protocol (SNMP) and Simple Object Access Protocol/Extensible Markup Language (SOAP/XML): These are the fundamental protocols used for the communication of WCS with controllers and location/MSE, respectively. WCS also uses SNMP and SOAP to send event notifications. The SNMP version used by the WCS with each individual controller is selected when adding the controller to the WCS for the first time.
• Syslog and Simple Mail Transfer Protocol (SMTP): These are two other protocols used by WCS to send event notifications, and SMTP can also be called into play when working with reports.
A common tool used to verify the processes protocol ports on which a Windows server is listening is the netstat -ano command, which also enables you to track the identifier of the process using that specific port. You could start from this command when troubleshooting common service availability issues.
High Availability
High availability can be configured for failover scenarios where you need a secondary WCS to take over from a failure of the primary WCS. Both automatic and manual failover is supported, given that the network infrastructure is properly configured.
When a failover to the secondary WCS occurs, the secondary WCS takes care of updating all the controllers automatically with its own IP address as the new SNMP trap receiver.
If an MSE is in use, the secondary WCS automatically updates the MSE too, so that all location operations can continue as normal. All protocols and ports between the primary WCS and other devices (for example, WLC, MSE, other PCs, and so on) should be allowed for the secondary WCS as well. Also, between the primary and secondary WCS, traffic on port 8012, for Apache Tomcat, and on ports 1315 and 1319, for the solid database exchange, needs to be allowed.
For all the details on configuring high availability, refer to the following link:
WCS Configuration Guide, Chapter 16: www.cisco.com/en/US/docs/wireless/wcs/7.0MR1/configuration/guide/admin.html#wp1131792
Understanding License Managing
WCS supports two types of licenses: base and plus.
The base license gives you access to all the management, configuration, and monitoring services of WCS. The limit of both the base and plus license is counted against the number of APs (not controllers) in your deployment.
The plus license enables all the capabilities for the Mobility Services Engine (MSE) and WCS high availability. When adding an MSE, a license specific for that MSE needs to be imported, in addition to the WCS base and plus licenses. This MSE license is counted against the number of tracked devices, tags, or wireless intrusion prevention system (wIPS) access points, if any are being deployed.
For more details, refer to the following link:
WCS Configuration Guide, Appendix B: www.cisco.com/en/US/customer/docs/wireless/wcs/7.0MR1/configuration/guide/warr.html
Mesh Monitoring
Mesh link details are accessible through the Mesh tab on the WCS home page, under Mesh > Monitor > Access Points > Mesh links > Details. The following information can be retrieved:
• SNR Graph
• Links Metrics Graph
• Packet Error Rate Graph
• Link Events
• Mesh Worst SNR Links
• AP Uptime
• LWAPP Join Taken Time
• Location Links
In addition, you can use WCS maps to monitor mesh health, including link statistics, access points, and access point neighbors.
Monitoring Mesh Networks Using Maps: www.cisco.com/en/US/customer/docs/wireless/wcs/7.0MR1/configuration/guide/maps.html#wp1177819
Audits
To track any possible discrepancy between the configuration on the controllers and the configurations stored in WCS, you can audit your wireless network using basic auditing or template-based auditing. Basic auditing has been a native feature since the day WCS came out. Starting from version 5.1, you have the option to include all or only selected configuration parameters in a template-based audit.
Configuring an Audit: www.cisco.com/en/US/customer/docs/wireless/wcs/7.0MR1/configuration/guide/admin.html#wp1128577
Configuring Audit Parameters: www.cisco.com/en/US/customer/docs/wireless/wcs/7.0MR1/configuration/guide/admin.html#wp1128601
Perform Maintenance Operations
All maintenance operations on WCS include data backup, restore, upgrades, services start and stop, and so on. For the purposes of this guide, all maintenance operations will be left to Chapter 4 of the official configuration guide:
WCS Configuration Guide, Chapter 4: www.cisco.com/en/US/customer/docs/wireless/wcs/7.0MR1/configuration/guide/tasks.html
As a side note, WCS allows you to perform maintenance operations such as software downloads and upgrades for controllers, the MSE, and access points. All the information on these maintenance tasks are detailed in the corresponding sections of the official guide to configure controllers, APs, and the MSE.
Client Troubleshooting
WCS supports several functions to give you a detailed troubleshooting of wireless clients.
The first and most accessible one is the dashboard of the home page, from where you can already collect data on the general health of wireless clients. When needing to go deeper in the troubleshooting procedure, however, you might want to consider the advanced search field in the upper-right corner of the graphical interface, to jump directly to a specific wireless client, or also the page under Monitor > Clients.
As you browse the client's details page, you can benefit from several parameters to investigate connectivity issues. Some of the most useful could be, for example, the 802.11 state, the authentication status, the Received Signal Strength Identifier (RSSI) and signal-to-noise ratio (SNR), and the map location.
Other effective information can be seen in the client association history, which gives you a view on roaming events as well.
By combining data from different resources of the client-monitoring pages, you can achieve a first isolation of the issue that can be completed if needed with dedicated debugs on the controller, for example.
In addition to all these examples, WCS provides you with an automated troubleshooting option to collect many of the aforementioned data at once through few clicks:
WCS Configuration Guide, Chapter 11: www.cisco.com/en/US/docs/wireless/wcs/7.0/configuration/guide/7_0clientmgmt.html#wp1107455
AP Conversion
To help you migrate previously existing autonomous APs to a centralized solution, WCS includes a specific migration template that can be applied to autonomous APs. This template can either be launched on the fly or it can be scheduled. It instructs the autonomous AP(s) to download an LWAPP recovery image and then contact a WLC through several options, such as static management IP configuration or DHCP Option 43.
The details for configuring an autonomous AP migration template can be found at the following link:
WCS Configuration Guide, Chapter 11: www.cisco.com/en/US/docs/wireless/wcs/7.0MR1/configuration/guide/temp.html#wpxref26263
Logging
All logging operations on WCS include debugs, SNMP, and syslog. For the purposes of this guide, such operations will be left to Chapter 16 of the official configuration guide:
WCS Configuration Guide, Chapter 16: www.cisco.com/en/US/docs/wireless/wcs/7.0MR1/configuration/guide/admin.html#wp1249595
Running Reports
Through the reports of WCS, you can generate charts, lists, and graphs for specific diagnostic summaries.
WCS polls the data used to run reports from the controllers through SNMP at the iteration of the corresponding background tasks.
Reports can either be locally stored on the WCS server, in CSV or PDF format, or also directly emailed.
Security Management
Rogue Detection, Classification, and Management
Rogue Detection
A device is classified as rogue when it is not known by a controller. So the rogue detection is accomplished through registered APs, thanks to which a wireless LAN controller (WLC) can observe APs and wireless clients that are not part of the wireless infrastructure. To be classified as such, a rogue AP or client needs to be detected twice.
To detect a rogue AP or client, an AP in local mode needs to cease serving clients and listen for noise on its channel for 50 milliseconds. You can configure the frequency and channels on which APs in local mode will scan for rogue beacons and off-channel noise in the Auto Radio Frequency (RF) and Dynamic Channel Assignment (DCA) menus of the controller, under the 802.11a/n and 802.11b/g/n radio settings. You also need to configure the registered AP either in local mode or in monitor mode, to be able to scan for rogue beacons.
The information collected by the controller on rogue devices includes
• Rogue AP MAC address and name
• Rogue connected client's MAC addresses
• Whether frames are protected with WEP or WPA
• Preamble, SNR, and RSSI
After a rogue AP or client is detected, the controller can also try to determine whether such a rogue AP or client also has access to the wired network. Such a goal is accomplished either with passive or active rogue detection on the network.
With passive detection, following from the rogue AP or client detection, the rogue MAC is passed to registered access points configured as rogue detectors. These APs will exclusively listen on the wired side for Address Resolution Protocol (ARP) packets from the rogue MAC, and if any are found, the rogue AP will be classified as detected on the network, which is by default a critical alarm on WCS. Such a passive method is of course limited to Layer 2 boundaries.
Active rogue detection is accomplished through the Rogue Location Discovery Protocol (RLDP), which instructs a detecting AP configured in local mode to try to associate to the rogue AP, obtain an IP address, and send a user datagram protocol (UDP) packet on port 6352 to the controller's management IP address. This UDP packet contains data on both the local and the rogue APs. If such an operation succeeds, the rogue AP is classified as detected on the network. The main advantage of this mechanism is that it allows you to discover rogue APs on the network across Layer 3 boundaries.
Rogue Management
WCS reports rogue access point alarms under the security alarms or events. You can check and modify the severity level of each rogue alarm (detected, detected contained, detected on network, and so on) under the corresponding Severity Configuration drop-down menu on the Rogue AP Alarms summary page.
Data for rogue access point events is sent by the controllers through the corresponding SNMP trap rogue AP, which you configure on the Trap Control menu of every controller. Alternatively, information on rogue access points can be polled by the WCS from the controllers at the iteration of the background task called Rogue A. Data collected through this task is also used for reports on rogue APs.

Note
A tricky situation can be observed when you have multiple controllers, because each controller could report other controllers' access points as rogues. To avoid this, you should configure the controllers with the same RF group name so that thanks to neighbor messages, access points can recognize one another as belonging to the same wireless infrastructure.

When rogue APs are detected and an alarm is triggered, you could either take a passive action on that specific alarm (acknowledge, clear, delete, and so on) or you could tell the controller to actively contain the rogue AP. If you mark the rogue AP to be contained, the controller will instruct APs in local or monitor mode detecting the rogue AP to send deauthentication frames to the corresponding rogue clients. You can easily distinguish such deauthentication frames over the air as they are characterized by sequentially (not randomly) increasing sequence numbers.
As a final note, you can also display rogue APs on maps. Without location/MSE, you can track only one rogue AP at a time, whereas with location/MSE, you can track all the rogue APs simultaneously.
Alarms and Events
Even though they might look similar through the WCS web interface, events and alarms are different.
An event is triggered following the occurrence or detection of a specific condition, such as radio interference above a certain threshold or a rogue AP, and it is generated by the controller. However, for some events, a specific condition or pattern must repeat a certain number of times before the event itself is generated; this is the case, for example, with signature attacks. The controller notifies WCS of a specific event through the SNMP traps configured on the SNMP Trap Controls menu.
An alarm is generated by WCS itself as a response to one or more events correlated together. Some intrusion detection system (IDS) events, for example, which are considered as network-wide, can all be mapped to a single alarm. Other events, such as IDS client-related ones, are mapped to a single alarm each. This is why WCS sometimes reports the same message in both the events and alarms sections.
IDS/WIPS
Intrusion Detection Systems (IDS)
WCS reports IDS attacks upon notification from the controller, where the main part of the process takes place.
You can register controllers with IDS sensors so that such IDS sensors can instruct the controller to shun clients that violate certain conditions and that are seen as attackers.
Suspicious clients are detected through the triggering of IDS signatures, some of which are already preconfigured on the controllers in the Standard Signatures list of the Wireless Protection Policies menu.
A shunned client entry is distributed across all the controllers in the same mobility group as the detecting WLC.
Wireless Intrusion Prevention System (wIPS)
wIPS is a system that enables you to perform detection and mitigation for rogue access points, rogue clients, and ad-hoc connections. It gives you the tools to monitor wireless hacking attacks and threats too.
wIPS is a mode that you can configure on a lightweight access point to start detecting wireless threats according to specific signatures and patterns. All the information about these menaces are then aggregated at the Mobility Services Engine (MSE) and monitored through WCS.
An in-depth description of wIPS is beyond the scope of this chapter. For all technical details about the implementation of wIPS with Cisco Unified Wireless Networks, please refer to the official design guide:
Cisco Adaptive Wireless Intrusion Prevention System Configuration Guide Release 7.0.201.0: www.cisco.com/en/US/customer/docs/wireless/mse/3350/7.0MR1/wIPS/configuration/guide/wIPS_70MR1.html
RF Management
As previously detailed throughout this book, Radio Resource Management (RRM) is the RF management system of a WLC that automatically adjusts the radios of nearby APs to help you achieve optimal connectivity for your wireless clients.
WCS implements a snapshot view of RRM statistics to facilitate identifying possible areas at risk (cochannel interference, coverage holes, and so on) and to provide you with an easy and immediate RF troubleshooting tool. The page can be accessed under Monitor > Radio Resource Management. Here different dashlets provide information on radio performances, reasons for channel changes, RF management configuration mismatches, and so on.
Further details on the RRM dashboard can be found at the following link:
WCS Configuration Guide, Chapter 6: www.cisco.com/en/US/docs/wireless/wcs/7.0/configuration/guide/7_0mon.html#wp1182816
Cisco CleanAir on WCS
Among all RF management advantages provided by Cisco Unified Wireless Networks, one of the most innovating and revolutionary is Cisco CleanAir.
Cisco CleanAir is a system that measures the air quality and reports and mitigates non-Wi-Fi interferences. As part of this system, WCS also includes a dedicated session for managing and monitoring Cisco CleanAir.
In the Cisco CleanAir system, APs integrating such a technology process all the data on non-Wi-Fi interferences and forward them to the WLC. Two main categories of data are collected: air quality index (AQI) and interference device report (IDR). The former is generated every 15 seconds, and it represents a rolling average on the impact of the classified interferers on a theoretically perfect spectrum. The latter is generated in real time for every newly classified interferer, and updates on previously classified interferers are sent every 90 seconds.
The WLC receives both these types of data and merges them together so that IDRs from different APs for the same interferer are correctly integrated as belonging to the same classification of a non-Wi-Fi interference device.
Starting from here, the WLC will then send AQI data to the WCS through SNMP and send IDR data to the MSE through Network Mobility Service Protocol (NMSP). This is a key concept in understanding why without MSE you cannot have interferers' location tracking and history.
Air quality reports contain information on the type of detected interferer and on its severity index, so WCS can definitely alert you when your Wi-Fi degrades below a certain threshold, for example.
However, only MSE has the knowledge and the capacity to merge interference device reports from multiple controllers and to synchronize such data with the WCS through SOAP, so that WCS can display the interferers' location on a map or provide you with the history of the interferers located so far.
Also, keep in mind that an interferer counts toward the MSE location tracking license in the same way as a standard Wi-Fi client: In some busy environments, you might then want to limit the number of tracked interferers so that too many interferers won't consume all your location tracking license counts.
Configuring Cisco CleanAir through WCS for a WLC is the same as configuring any other WLC's parameter through WCS. All the Cisco CleanAir options for a specific controller can be enabled starting from the Configure > Controllers menu.
Tracking and history parameters for interferers are available under the MSE configuration options for Context Aware Service > Administration > Tracking Parameters and History Parameters. All the detailed configuration steps, along with a deeper description of all Cisco CleanAir operations, can be found at the following link:
Cisco CleanAir - Cisco Unified Wireless Network Design Guide: www.cisco.com/en/US/customer/products/ps10315/products_tech_note09186a0080b4bdc1.shtml
For monitoring Cisco CleanAir, WCS implements a dedicated section starting from the home page, under the CleanAir tab. As seen through this paragraph, the history about all interferers is collected only when MSE is part of the Cisco CleanAir system. For the same reason, the dashlets for the worst interferers under the CleanAir tab will display some data if MSE is configured.
Among the new Cisco CleanAir features, the following reports have been added to WCS:
• Air Quality Versus Time
• Security Risk Interferers
• Worst Air Quality APs
• Worst Interferers
Implement Mobility Services Engine (MSE)
After you specify the MAC address of the desired device, WCS standalone can track one device at a time among wireless clients, active radio frequency identifier (RFID) tags, and rogue devices (APs and clients).
However, to track multiple devices at once on a map, you need to integrate WCS with a location server or, more recently starting from release 5.1 of WLC and WCS, with MSE. Moreover, the MSE also allows you to store the history of device locations and to configure chokepoints in your wireless infrastructure.
To dive into the details of deployments for device tracking, first a brief introduction is needed on the concepts and theory behind location systems.
Lateration, Triangulation, and RF Fingerprinting
Lateration is the principle according to which you calculate the distance of a wireless device from an access point. Different methods can be used to obtain such a distance, but the main one is based on the RSSI. For all the details on the mathematics behind lateration techniques, refer to the following link:
Location Tracking Approaches of the Wi-Fi Location-Based Services 4.1 Design Guide: www.cisco.com/en/US/docs/solutions/Enterprise/Mobility/wifich2.html
However, after you know the distance of a device from an AP, the only location you will be able to determine can be shown in terms of a circle around that AP. This of course is not enough to display the precise placement of your device, which could be located on any point of such a circle.
To determine a single point where your device could be located, you need what is called triangulation, also referred to as trilateration. By iterating the RSSI lateration technique for at least three access points, you can end up with an intersection of three different circles, as shown in Figure 6-1. A precise intersection can be obtained only in an ideal scenario, but the goal here is to highlight the main principle behind how a device location is obtained on a map.

Figure 6-1. RSSI Lateration Example for Three Access Points
In addition to lateration and triangulation, the Cisco location-based services (LBS) are adding RF fingerprinting. RF fingerprinting is the technique that instructs the WCS and the MSE about the specific RF environment where your wireless devices are operating, so that several variables are taken into account when performing the device location tracking on maps.
WCS comes with precanned RF models that you can apply to floor maps to suggest the expected RF environment of an area. However, more accurate data can be fed into WCS through the so-called RF calibration; this is extensively explained in the following link:
Best Practice of the Wi-Fi Location-Based Services 4.1 Design Guide: www.cisco.com/en/US/docs/solutions/Enterprise/Mobility/wifich5.html#wp1052635
With RF fingerprinting, you commonly refer to the ultimate location tracking mechanism in Cisco location-based services (LBS).
Location Readiness, Best Practices, and RF Design Considerations
Now that the main concepts have been presented on how a device location is determined, the following key points ensure accurate device tracking:
• Location accuracy is 90 percent within 10 meters and 50 percent within 5 meters. In other words, you have a 90 percent probability that a client is tracked within 10 meters of its real position and a 50 percent probability that a client is tracked within 5 meters of its real position.
• To be correctly tracked, a device has to be heard with a signal strength greater than -75 dBm by at least three APs. The latter comes directly from the triangulation principle. The former -75 dBm threshold is the default value and can be changed through the WCS, under the MSE server options Advanced > Location Parameters > RSSI Cutoff.
• Access points should be located within 50 to 70 feet of each other and placed first at the perimeter of the map, then in the interior area. Also, at any point in the map, wireless devices should always be within 70 feet from three APs, each one located at one of the three different quadrants drawn by the axis with the client as the origin point. You can find a more detailed visual explanation of this recommendation at the following link:
Best Practice of the Wi-Fi Location-Based Services 4.1 Design Guide: www.cisco.com/en/US/docs/solutions/Enterprise/Mobility/wifich5.html
• WCS, WLCs, and the MSE should be synchronized through NTP. If NTP services are not available in your network, you should at least make sure that the WLC's clock is slightly ahead of the MSE's clock.
After the APs are known by the WCS through the WLC, a very powerful predictive tool to understand how to deploy the APs to achieve accurate device location tracking is the location readiness inspection, configurable in WCS under Monitor > Maps > floor map name > Inspect Location Readiness.
MSE Communication
The MSE installation and configuration are extensively explained in the Cisco 335x Mobility Services Engine Getting Started Guide. Throughout this section, more focus will be placed on understanding the communication between the MSE and the WCS and WLC.
The communication between WCS and the MSE is done through SOAP/XML, which also allows you to define customized sets of the Application Programmable Interface (API) through third-party tools to query the MSE database.
Regarding communication with the wireless infrastructure itself, the MSE never communicates with access points directly. All the data collected from the APs are gathered by the WLC and then passed to the MSE. Up to release 4.1 of the Cisco Unified Wireless Network (CUWN), the communication between the WLC and the location appliance was based on SNMP and on the Location Control Protocol (LOCP). Starting from release 4.2, the LOCP and SNMP operations have been integrated into the Network Mobility Service Protocol (NMSP).
The NMSP communication is initiated by the MSE when synchronization with the WLC is launched through the WCS. NMSP runs on TCP port 16113 toward the WLC, and it is based on HTTPS, which needs a certificate exchange between the MSE and the WLC. As such, the correct installation of the SSL keys can be verified on the WLC with the show auth-list command. The MSE certificate key hash will be the one corresponding to the LBS-SSC entry in the Cert Type column of the table. Correspondingly, on the MSE shell command (reachable with the cmdshell command), the sequence show server-auth-info allows you to verify the key hash on the location appliance itself.

Note
After being synchronized, the WLC and the MSE keep communicating, even if WCS is removed from the picture. However, you will of course not be able to apply any further location-related configuration changes on the MSE itself.

MSE Setup and Configuration
Because no added value would be given by this document in repeating what is already explained in the official guides, all the steps for deploying and configuring the MSE can be found at this link:
Cisco Context-Aware Service Configuration Guide: www.cisco.com/en/US/docs/wireless/mse/3350/7.0/CAS/configuration/guide/CAS_70.html
Also, more insights on the protocols and mathematics behind the topics covered in this section can be found at the following link:
Wi-Fi Location-Based Services 4.1 Design Guide: www.cisco.com/en/US/docs/solutions/Enterprise/Mobility/WiFiLBS-DG.html
Notifications
The MSE can send notifications for a specific event related to a specific client, such as entering a specific area on a map, going missing from the map, or moving beyond a specific point, for example.
MSE does not store such notifications, but when configuring WCS as a destination for these notification events, you can store them and group them into several categories:
• Absence (Missing)
• In/Out Area (Containment)
• Movement from Marker (Movement/Distance)
• Location Changes
• Battery Level
• Emergency
• Chokepoint Notifications
In addition, you can also choose to send event notifications to other destinations such as a syslog server.
All the detailed steps for configuring event notifications are available at the following link:
Cisco Context-Aware Service Configuration Guide, Chapter 6: www.cisco.com/en/US/docs/wireless/mse/3350/7.0/CAS/configuration/guide/msecg_ch6_CAS.html







Chapter 7. Configure and Troubleshoot WLAN Services
Voice for Autonomous and Unified Deployment
Cisco currently provides two wireless IP phone models—C7921 and C7925—as well two wireless network infrastructure solutions, the Cisco Unified Wireless LAN Controller (min. 4.0.217.0, enable Auto RF to manage the channel and transmit power settings; use version 4.1.185.0 or later, although version 5.2.193.0 or later is recommended) and the Cisco Autonomous Access Points (min. 12.3(8)JEA2, although version 12.4(10b)JA3 or later is recommended to support voice service in your wireless network.
In short, you must be able to
• Understand Voice over Wireless LAN (VoWLAN) design recommendations and requirements, including the validation of radio frequency (RF) parameters for a voice readiness network.
• Understand quality of service (QoS) settings on wired and wireless networks.
Everything you know about wireless data clients is true for wireless IP phones as well. Also, there are some more requirements for your wireless network because voice traffic is more sensitive to latency and jitter than data traffic.
A site survey done for a data WLAN might not be sufficient and needs to be verified if the wireless network is VoWLAN ready, to make sure that you get satisfactory voice quality.
RF Design Considerations
You can use the 802.11a (5-GHz) or the 802.11b/g (2.4-GHz) band with the C7921 or C7925. Make sure that a site survey is done and validated on the band you plan to use, because the coverage area changes based on the frequency and different access point (AP) models.
Also, the C7925 supports Bluetooth, which uses the 2.4-GHz frequency just like 802.11b/g; therefore, it can potentially interfere with 802.11b/g. Typically, there is less interference in the 802.11a 5-GHz band. 802.11a has more non-overlapping channels, whereas the UNII-2 band (channel 52-64) needs to follow dynamic frequency selection (DFS), which would automatically switch the access point to a "clean" channel if radar is detected.
However, make sure to use a 12-channel set for the 802.11a 5-GHz band to avoid delayed discovery for new access points.
RF validation and voice readiness parameters are as follows:
• Signal: The cell edge should be designed to -67 dBm, where there is a 20-30 percent overlap of adjacent access points.
• Channel utilization levels should be kept below 50 percent.
• Noise levels should not exceed -92 dBm, which allows a signal-to-noise ratio (SNR) of 25 dB, where a -67 dBm signal should be maintained.
• The Packet Error Rate (PER) should not exceed 1 percent packet loss.
• Jitter should be kept at a minimum (<100 ms).
• 802.11 retransmissions should be less than 20 percent.
• To avoid one-way voice because of different power settings between the IP phone and access point, you should configure World mode (802.11d). The 7921G will always give precedence to 802.11d (World mode) to determine which channels and power to use.
World mode is enabled automatically for the Cisco Unified Wireless LAN Controller (WLC). World mode must be enabled manually for Cisco autonomous access points using the following commands:
Interface dot11radio X   world-mode dot11d country CH both
• If 802.11d information is not available, the 7921G will fall back using the local configured regulatory domain (A/E/P/W).
• Dynamic Transmit Power Control (DTPC) is by default enabled on Wireless LAN Controllers and needs to be configured on the standalone APs. DTPC will allow you to negotiate the transmit power between the AP and IP phone to avoid one-way voice.
• To make sure that the access point has sufficient bandwidth for voice calls, enable TSPEC - Call Admission Control (CAC). Use the following code to enable CAC on the autonomous access point:
dot11 ssid voice   admit-traffic
• Set the maximum RF bandwidth for voice traffic (default = 75 percent).
• Set the bandwidth that is reserved for roaming clients (default = 6 percent).
• If there is not sufficient performance on the access point for a voice call, the phone will display "Network Busy."
• As a rule of thumb, you should enable data rates >= 11 Mbps to maintain good voice quality.
• If you are using the WLC, you must disable aggressive load balancing, enabling symmetric tunneling for L3 mobility.

Note
The Cisco Spectrum Expert can be used to evaluate some of the previous items. The 7921/7925G can be used to verify coverage by using the Neighbor List menu. Choose Settings > Status > Neighbor List.

Implement the Network Infrastructure to Support the Voice over Wireless Solution
VoWLAN Design Recommendations
There are a lot of parameters that make up good VoWLAN design. A key for successful deployment is the RF and site survey mentioned in Chapter 1, "Planning and Designing 802.11 Wireless Technologies." Start the site survey with the required access point type using accordingly diverse antennas and decide about the density and position of the access points. Minimize jitter and delay on the VoWLAN. Also, select the right IEEE standards for 802.11b/g or 802.11a, because this has an impact on call capacity (concurrent phone calls) and on the cell edge design—and therefore on the transmit power you have to use.
For more information about these topics, refer to the following links:
Enterprise Mobility Design Guide: www.cisco.com/en/US/docs/solutions/Enterprise/Mobility/emob41dg/ch9_Voic.pdf
7921 IP Phone Deployment Guide: www.cisco.com/en/US/docs/voice_ip_comm/cuipph/7921g/6_0/english/deployment/guide/7921dply.pdf
7925 IP Phone Deployment Guide: www.cisco.com/en/US/docs/voice_ip_comm/cuipph/7925g/7_0/english/deployment/guide/7925dply.pdf
There are also a lot of parameters to be configured in the WLC. To simplify the validation of a WLC configuration requirement, you can download a configuration analyzing tool from the following link (requires a Cisco.com account):
https://upload.cisco.com/cgi-bin/swc/fileexg/main.cgi?CONTYPES=wlc-conf-app-dev
Having trouble downloading a file? Please email wlc-conf-app-dev@cisco.com.
To use the configuration analyzer issue the show run-config command on the WLC and save the output in a file. That file can be loaded to the configuration analyzer, which will point you to possible configuration errors with regard to configuration requirements in the error message, such as code 40001 to 40043.
The following error message is an example:
Click here to view code image
40009, Voice: DTIM value should be 2, currently it is %DTIM value%, check in %band% ConfigurationFor optimal battery life and performance, we recommend setting the DTIM period to 2. Reference: Cisco UnifiedWireless IP Phone 7921G Deployment Guide.
Although this error message gives some indication of the configuration problem, the following link provides to the different error messages the needed WLC CLI commands to correct the configuration problem: https://supportforums.cisco.com/docs/DOC-13644.
VoWLAN QoS
Make sure that the wired switch infrastructure also supports QoS using the correct Differentiated Services Code Point (DSCP) values whenever Real-time Transport Protocol/Skinny Client Control Protocol (RTP/SCCP) packets are sent. Therefore, you need to verify the switch configuration on the wired infrastructure.
For additional information about QoS, refer to the following link:
Cisco IOS Software Configuration Guide for Cisco Autonomous Access Points: www.cisco.com/en/US/docs/wireless/access_point/12.4_10b_JA/configuration/guide/scg12410b-chap15-qos.html
General Configuration Settings
IP Phone 792x
The Cisco IP Phone 792x uses two protocols:
• SCCP TCP 2000 (signaling) between the phone and CallManager
• RTP UDP 16384-32767 (actual voice traffic between phones)
They support different authentication and encryption types. If you configure the 802.1x authentication type, make sure to use Cisco Centralized Key Management (CCKM) to enable fast secure roaming, because roaming time must be less than 100 ms. With IOS standalone access points, configure Wireless Domain Services (WDS) to achieve CCKM for infrastructure access points.
Since IP Phone Release 1.3(4), the C792x supports CCKM with Wi-Fi Protected Access 2 (WPA2), Advanced Encryption Standard (AES) or Temporal Key Integrity Protocol (TKIP), WPA (TKIP or AES), and 802.1x Wired Equivalent Privacy (WEP) authentication.
To save battery life on the IP phone, the access point needs to support Cisco Compatible Extensions (CCX), or proxy Address Resolution Protocol (ARP) has to be enabled. Furthermore, they will use Unscheduled Automatic Power Save Delivery (U-APSD) for power savings when in idle mode or when a phone call is active if Wi-Fi Multimedia (WMM) is enabled. Increasing the delivery traffic indication message (DTIM) period can also increase the battery life. We recommend setting the DTIM period to 2 with a beacon period of 100 ms. If there are power save enabled clients associated with the access points, the broadcast and multicast traffic will be queued and send at the DTIM interval.
Configuration
The C792x can be configured through one of two methods: manually or through the GUI.

Note
After a wireless connection is established, the IP phone will have to learn the IP address from a Trivial File Transfer Protocol (TFTP) server to download the configuration. Therefore, the Dynamic Host Configuration Protocol (DHCP) option 150 is used to point the IP phone toward the TFTP server's IP address.

Manual Configuration of the Phone
To configure the phone manually, you will have to unlock it using the keypad on the phone (**#). After unlocking the phone you will get access to the settings menu, as shown in the Figure 7-1.

Figure 7-1. C7921 Setup Menu
The menu settings are self-explanatory.
GUI Configuration of the Phone
If the phone has an HTTPS-enabled interface, you can access the phone through a USB connection on the wire or through a radio interface through wireless, if the IP phone is associated to the wireless network. If you use USB, you first need to download and install the software to get the USB network interface card (NIC) on your workstation connected to the C7921.
The Cisco.com download is Wireless > Cisco Unified Wireless IP Phone 7921G > IP Phone Tools and Utilities > 1.0(2a) > USB-Install-7921-7925.1-0-2a.exe.
The installation readme file can be found at the following link: www.cisco.com/web/software/282074239/24333/USB-Install-7921-7925.1-0-2a-Readme.pdf
Execute the 7921G USB installation package and the InstallShield wizard will begin.
USB cable part number: CP-CAB-USB-7921G=
You also need to statically set the IP address on your PC for the default subnet 192.168.1.x/24, because the 7921G is using the default subnet 192.168.1.100.
To access the phone GUI (through the web interface) you must enable the webAccess feature in the CallManager and establish IP connectivity to the phone. IP connectivity can be established either through USB or radio interface.
Configure the following:
config ttelephony-sservice phone webAccess 0create cnf-file

Note
The default username and password for the web interface are as follows:
username = admin
password = Cisco

You now have to reset the 7921G.
Now you should be able to see the C7921 web interface, as shown in Figure 7-2.

Figure 7-2. Example from Web Interface on C7921
For configuration, select Setup. Similar to the manual configuration, the GUI configuration is self-explanatory.
Cisco Unified Wireless IP Phone 7921G
The following Cisco.com links provide configuration details:
Data sheet: www.cisco.com/en/US/prod/collateral/voicesw/ps6788/phones/ps379/product_data_sheet0900aecd805e315d.html
Administration Guide: www.cisco.com/en/US/docs/voice_ip_comm/cuipph/7921g/6_0/english/administration/guide/21adm60.htm
User Guide: www.cisco.com/en/US/docs/voice_ip_comm/cuipph/7921g/6_0/english/user/guide/21enu60.pdf
Cisco Unified Wireless IP Phone 7925G
The following Cisco.com links provide configuration details:
Data sheet: www.cisco.com/en/US/prod/collateral/voicesw/ps6788/phones/ps379/ps9900/data_sheet_c78-504890.html
Administration Guide: www.cisco.com/en/US/docs/voice_ip_comm/cuipph/7925g/7_0/english/administration/guide/25ag701.html
User Guide: www.cisco.com/en/US/docs/voice_ip_comm/cuipph/7925g/6_0/english/user/guide/25enu60.pdf
Troubleshoot Voice over Wireless Issues
To collect phone logs, you must access the phone via the GUI. Although GUI access can be established using USB or a radio interface, the phone logs must be collected using a USB interface. Because the internal phone log buffer is too small, you must install a syslog server and send the phone logs to the syslog server. Make sure you set the log level to debug for the modules you like to troubleshoot. For wireless connectivity problems, you typically need the following two modules on the debug level: Wireless LAN Driver/Wireless LAN Manager.
Make sure that syslog messages are marked with the IP address running on the USB NIC of the IP phone so that you are sure that syslog is not sending over the wireless NIC, which would have an impact on voice quality.
When troubleshooting IP phone issues, try to understand whether the problem is with the wireless network connection or is a voice problem. Therefore, make sure that the symptoms are clearly identified with all the details.
To troubleshoot a wireless infrastructure network connection, the IP phone can be treated as any other wireless client.
To troubleshoot voice problems, you need to understand voice quality problems, such as robotic voice, voice gaps, and one-way voice during roaming. For good voice quality, a low data rate below 11 Mbps needs to be disabled.
To simplify the setup, it also helps to use only one wireless IP phone and one wired IP phone for troubleshooting voice problems. In this case, you avoid troubleshooting two wireless IP phones as well as avoid troubleshooting the voice gateway to the outside of the network.
Wireshark is a good tool to help analyze an RTP voice stream in the case of jitter, sequence number (packet loss), and delay. You must collect wired sniffer traces on an AP level to be able to decode the RTP stream. It is crucial that the RTP packets are marked with the correct QoS settings. Make sure the COS (class of service) field is set to UP6 (user priority 6) and the Differentiated Services Code Point (DSCP) field is set to EF (Expedited Forwarding). Also, check whether the QoS and stream statistics on the IP phone GUI displays Receiver DSCP = EF,EF.
Make sure that the wired switch infrastructure also supports QoS using the correct DSCP values whenever RTP/SCCP packets are sent. Furthermore, the 792x allows you to use Site Survey mode to display all the neighbor access point channels and RSSI values and spot possible coverage problems.
In a Unified Wireless Solution, you should also issue the show run-config command from the WLC using the Config Analyzer tool mentioned earlier in this chapter.
Video
Video service on a wireless setup is as difficult as voice service. It also requires careful RF design. Compared to voice, video service is not critical about round trip time but video requires much more throughput (bandwidth). For the unified deployment model, the QoS profile must be set to Gold for video, whereas for DSCP, the video value is AF41. AF41 translates to the corresponding 802.1p value 4. For more information, refer to the following links:
QoS on Wireless LAN Controllers and Lightweight APs Configuration Example: www.cisco.com/en/US/partner/tech/tk722/tk809/technologies_configuration_example09186a00807e9717.shtml
Configuring Voice and Video Parameters: www.cisco.com/en/US/partner/docs/wireless/controller/7.0/configuration/guide/c70ccfg.html#wp1254489

Note
Band selection-enabled WLANs do not support time-sensitive applications such as voice and video because of roaming delays. You must enable admission control (ACM) for CCXv4 clients that have WMM enabled. Otherwise, the bandwidth-based Call Admission Control (CAC) does not work properly.

Context-Aware Services
Typically, this is about location services, which also require careful RF design and planning, especially at the corner of a coverage area, to get accurate location tracking results doing location-ready design.
Cisco Mobility Services Engine - Context Aware Mobility Solution Deployment Guide: www.cisco.com/en/US/products/ps9742/products_tech_note09186a00809d1529.shtml
Note that device tracking requires an extra license for the Mobility Services Engine (MSE). For more details, refer to the following link:
Cisco Context-Aware Service Configuration Guide Release 7.0: www.cisco.com/en/US/docs/wireless/mse/3350/7.0/CAS/configuration/guide/CAS_70.html

Note
As a rule for proper device tracking, the device must be detected at a signal level greater than -75dBm by at least three APs on the same floor.








Appendix A. RF Troubleshooting
This appendix covers important topics that will help you understand your wireless network better, covering the most important tools you can use for troubleshooting purposes.
Understand Wireless Sniffer Traces
There are a variety of wireless LAN (WLAN) sniffer products available with different capabilities. For example, a lightweight access point (LAP) that operates in Sniffer mode functions as a sniffer and captures and forwards all the packets on a particular channel to a remote machine that runs Airopeek. Some products enable you to capture data on several channels in parallel and display it synchronized within the same trace that simplifies analyzing traces if an STA roams between APs.
A couple of normal LAN sniffers also allow capturing traffic on a WLAN adapter/interface. The main problem here is that it doesn't capture and display the 802.11 layer information, so important information is lost. Another important detail is that normally wireless networks are encrypted. Encryption prevents us from seeing the data content, which makes traffic analysis difficult. However, in an encrypted wireless network the MAC addresses, 802.11 associations, and key handshakes are in clear (not encrypted) format. In such scenarios, it is helpful to take a trace on the wireless side and on the wired side of the AP and then synchronize (correlate) the two sniffer traces for example, based on the 802.11 association frames. The correlation will let us know which data is in the encrypted packet.
It is crucial to be familiar with the WLAN sniffer and with analyzing the data. Figures A-1 through A-5 show some examples of the powerful possibilities of sniffer traces.

Figure A-1. Wi-Fi Multimedia (WMM) Parameter Element with Admission Control Mandatory (ACM) for Voice Traffic

Figure A-2. Beacon with Quality of Service Basic Service Set Version 1 (QBSS v1) and QBSS v3 (AKA 2+) Information Elements

Figure A-3. Traffic Specification (TSPEC) Within an Add Traffic Stream (ADDTS) Request Used in Enhanced Distributed Channel Access (EDCA) Admission Control

Figure A-4. Cisco Centralized Key Management (CCKM) Fast Secure Roaming with CCKM Reassociation Request Element

Figure A-5. Robust Security Network Information Element (RSN IE) with 802.1x, CCKM, Advanced Encryption Standard (AES), and Temporal Key Integrity Protocol (TKIP) Encryption
Troubleshoot RF (Layer 1)
Troubleshoot RF Using Analyzing Tools
RF Spectrum Analyzer
To identify narrow-band interference, you need to use a spectrum analyzer to measure the amount of RF energy at different frequencies in a certain area. Therefore, an RF spectrum analyzer should be portable and cover the 2.4 to 2.5-GHz and 5 to 6-GHz frequencies to make sure that the 802.11a/b/g bands are covered.
Cisco Spectrum Expert
Cisco Spectrum Expert (CSE) is especially designed for the RF spectrum in the bands used by the 802.11a/b/g technology. Make sure that a laptop running the CSE sensor card does not have its Wi-Fi card turned on. CSE will display any underlying physical layer RF activity, including microwave ovens, Bluetooth, cameras, cordless phones, and so on. An example display is shown on Figure A-6.

Figure A-6. CSE Example
The sensor card has two LEDs indicating the operational status. CSE can help you find "clean" channels that the network devices can use. CSE also helps you to identify the types of devices that produce RF interference.


































